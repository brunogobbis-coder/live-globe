<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuvemshop Live | E-commerce do Brasil ao Vivo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Nimbus Design System - Nuvemshop Colors */
            --primary-interactive: #0059d5;
            --primary-hover: #00429f;
            --primary-pressed: #00347d;
            --primary-surface: #eef5ff;
            --primary-light: #4d8fe8;
            --primary-glow: rgba(0, 89, 213, 0.6);
            
            --secondary: #7c3aed;
            --secondary-light: #a78bfa;
            
            --neutral-background: #ffffff;
            --neutral-surface: #f6f6f6;
            --neutral-text-high: #0a0a0a;
            --neutral-text-low: #5d5d5d;
            
            --success: #36b37e;
            --success-light: #57d9a3;
            --warning: #ffab00;
            --danger: #de350b;
            --danger-light: #ff6b4a;
            
            /* Segment Colors */
            --segment-moda: #e91e63;
            --segment-eletronicos: #2196f3;
            --segment-casa: #ff9800;
            --segment-beleza: #9c27b0;
            --segment-alimentos: #4caf50;
            --segment-esportes: #00bcd4;
            --segment-pets: #795548;
            --segment-livros: #607d8b;
            
            /* Dark theme */
            --dark-bg: #0a0a14;
            --dark-surface: #12121f;
            --dark-surface-2: #1a1a2e;
            --dark-border: #1e1e2d;
            --dark-border-light: #2a2a3e;
            
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            
            /* Gaming colors */
            --game-gold: #ffd700;
            --game-silver: #c0c0c0;
            --game-bronze: #cd7f32;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: var(--font-family);
            background: var(--dark-bg);
            color: var(--neutral-background);
        }

        /* ============================================
           MAIN CONTAINER & NAVIGATION
           ============================================ */
        .app-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: rgba(10, 10, 20, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--dark-border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .logo-icon {
            width: 44px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg,
        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .navbar-logo {
            filter: brightness(0) invert(1);
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-text span {
            color: var(--primary-light);
        }

        /* Main Navigation */
        .main-nav {
            display: flex;
            gap: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--neutral-text-low);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            background: var(--dark-surface);
            color: var(--neutral-background);
        }

        .nav-item.active {
            background: var(--primary-interactive);
            color: white;
        }

        .nav-item svg {
            width: 18px;
            height: 18px;
        }

        .nav-badge {
            padding: 2px 6px;
            background: var(--danger);
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        /* Header Right */
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(54, 179, 126, 0.15);
            border: 1px solid rgba(54, 179, 126, 0.3);
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            color: var(--success);
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(54, 179, 126, 0.7); }
            50% { opacity: 0.8; box-shadow: 0 0 0 6px rgba(54, 179, 126, 0); }
        }

        .header-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            color: var(--neutral-text-low);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .header-cta {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary-interactive), var(--primary-hover));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 89, 213, 0.3);
        }

        .header-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 89, 213, 0.4);
        }

        .header-cta svg {
            width: 16px;
            height: 16px;
        }

        .header-btn:hover {
            background: var(--dark-surface-2);
            color: var(--neutral-background);
        }

        .header-btn.active {
            background: var(--primary-interactive);
            border-color: var(--primary-interactive);
            color: white;
        }

        .header-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Share Button - Brand & Emotion */
        .share-btn {
            position: relative;
        }

        .share-btn.shared {
            background: var(--success) !important;
            border-color: var(--success) !important;
            animation: sharePulse 0.6s ease-out;
        }

        .share-btn.shared::after {
            content: '✓';
            position: absolute;
            font-size: 16px;
            color: white;
        }

        @keyframes sharePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* ============================================
           VIEWS/PAGES
           ============================================ */
        .view {
            display: none;
            position: absolute;
            top: 69px;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }

        .view.active {
            display: block;
        }

        /* ============================================
           BRAZIL MAP VIEW (Interactive 2D)
           ============================================ */
        .globe-view {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: 
                radial-gradient(ellipse at 50% 50%, rgba(0, 89, 213, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 30% 70%, rgba(124, 58, 237, 0.03) 0%, transparent 40%),
                linear-gradient(180deg, #050510 0%, #0a0a1a 50%, #050510 100%);
        }
        
        /* Animated Grid Background */
        .globe-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 89, 213, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 89, 213, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            opacity: 0.5;
        }

        #globe-canvas {
            display: none;
        }
        
        .brazil-map-container {
            position: relative;
            width: 100%;
            max-width: 520px;
            height: calc(100vh - 100px);
            max-height: 580px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: -60px;
        }
        
        .brazil-map-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 30px rgba(0, 89, 213, 0.2));
            overflow: visible;
        }
        
        /* Heatmap Colors by Region */
        .brazil-map-svg .state-path {
            stroke: rgba(255, 255, 255, 0.3);
            stroke-width: 0.5;
            cursor: pointer;
            transition: all 0.4s ease;
        }
        
        /* Norte - Verde/Cyan */
        .brazil-map-svg .state-path[data-state="AM"],
        .brazil-map-svg .state-path[data-state="PA"],
        .brazil-map-svg .state-path[data-state="AC"],
        .brazil-map-svg .state-path[data-state="RO"],
        .brazil-map-svg .state-path[data-state="RR"],
        .brazil-map-svg .state-path[data-state="AP"],
        .brazil-map-svg .state-path[data-state="TO"] {
            fill: rgba(6, 182, 212, 0.4);
        }
        
        /* Nordeste - Laranja/Amber */
        .brazil-map-svg .state-path[data-state="MA"],
        .brazil-map-svg .state-path[data-state="PI"],
        .brazil-map-svg .state-path[data-state="CE"],
        .brazil-map-svg .state-path[data-state="RN"],
        .brazil-map-svg .state-path[data-state="PB"],
        .brazil-map-svg .state-path[data-state="PE"],
        .brazil-map-svg .state-path[data-state="AL"],
        .brazil-map-svg .state-path[data-state="SE"],
        .brazil-map-svg .state-path[data-state="BA"] {
            fill: rgba(249, 115, 22, 0.4);
        }
        
        /* Centro-Oeste - Amarelo */
        .brazil-map-svg .state-path[data-state="MT"],
        .brazil-map-svg .state-path[data-state="GO"],
        .brazil-map-svg .state-path[data-state="MS"],
        .brazil-map-svg .state-path[data-state="DF"] {
            fill: rgba(234, 179, 8, 0.4);
        }
        
        /* Sudeste - Azul (mais forte = mais vendas) */
        .brazil-map-svg .state-path[data-state="SP"] {
            fill: rgba(0, 89, 213, 0.7);
        }
        .brazil-map-svg .state-path[data-state="RJ"] {
            fill: rgba(0, 89, 213, 0.6);
        }
        .brazil-map-svg .state-path[data-state="MG"] {
            fill: rgba(0, 89, 213, 0.55);
        }
        .brazil-map-svg .state-path[data-state="ES"] {
            fill: rgba(0, 89, 213, 0.45);
        }
        
        /* Sul - Roxo */
        .brazil-map-svg .state-path[data-state="PR"],
        .brazil-map-svg .state-path[data-state="SC"],
        .brazil-map-svg .state-path[data-state="RS"] {
            fill: rgba(124, 58, 237, 0.5);
        }
        
        /* Hover Effect - Neon Glow */
        .brazil-map-svg .state-path:hover {
            filter: brightness(1.4) drop-shadow(0 0 15px currentColor);
            stroke: rgba(255, 255, 255, 0.8);
            stroke-width: 1.5;
            transform: scale(1.02);
            transform-origin: center;
        }
        
        /* Active State */
        .brazil-map-svg .state-path.active {
            filter: brightness(1.5) drop-shadow(0 0 20px rgba(0, 200, 255, 0.8));
            stroke: #00d4ff;
            stroke-width: 2;
            animation: stateGlow 2s ease-in-out infinite;
        }
        
        @keyframes stateGlow {
            0%, 100% { filter: brightness(1.5) drop-shadow(0 0 15px rgba(0, 200, 255, 0.6)); }
            50% { filter: brightness(1.7) drop-shadow(0 0 25px rgba(0, 200, 255, 0.9)); }
        }
        
        /* Sale Pulse Animation */
        .brazil-map-svg .state-path.sale-pulse {
            animation: salePulse 0.6s ease-out;
        }
        
        @keyframes salePulse {
            0% { filter: brightness(1); }
            50% { filter: brightness(2) drop-shadow(0 0 30px rgba(54, 179, 126, 0.9)); }
            100% { filter: brightness(1); }
        }
        
        /* City Markers - Radar Style */
        .city-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffffff 0%, #4d8fe8 100%);
            border: none;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        /* Radar Pulse Effect */
        .city-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: transparent;
            border: 2px solid rgba(77, 143, 232, 0.6);
            transform: translate(-50%, -50%);
            animation: radarPulse 2s ease-out infinite;
        }
        
        .city-dot::after {
            content: attr(data-city);
            position: absolute;
            top: -28px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: all 0.2s ease;
        }
        
        @keyframes radarPulse {
            0% { 
                width: 100%; 
                height: 100%; 
                opacity: 1;
            }
            100% { 
                width: 300%; 
                height: 300%; 
                opacity: 0;
            }
        }
        
        /* Capital Cities - Larger with Gold */
        .city-dot.capital {
            width: 14px;
            height: 14px;
            background: radial-gradient(circle, #ffffff 0%, #ffd700 50%, #f59e0b 100%);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .city-dot.capital::before {
            border-color: rgba(255, 215, 0, 0.5);
            animation: radarPulseGold 2s ease-out infinite;
        }
        
        @keyframes radarPulseGold {
            0% { 
                width: 100%; 
                height: 100%; 
                opacity: 1;
                border-color: rgba(255, 215, 0, 0.6);
            }
            100% { 
                width: 350%; 
                height: 350%; 
                opacity: 0;
                border-color: rgba(255, 215, 0, 0);
            }
        }
        
        /* Size based on sales volume */
        .city-dot.size-lg { width: 16px; height: 16px; }
        .city-dot.size-md { width: 12px; height: 12px; }
        .city-dot.size-sm { width: 8px; height: 8px; }
        
        .city-dot:hover {
            transform: translate(-50%, -50%) scale(1.8);
            z-index: 20;
            box-shadow: 0 0 25px rgba(77, 143, 232, 0.8);
        }
        
        .city-dot:hover::after {
            transform: translateX(-50%) scale(1);
            opacity: 1;
        }
        
        /* Map Ambient Glow */
        .map-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 60% 70%, rgba(0, 89, 213, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 30%, rgba(6, 182, 212, 0.1) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 40%, rgba(249, 115, 22, 0.08) 0%, transparent 35%);
            pointer-events: none;
            animation: ambientGlow 8s ease-in-out infinite alternate;
        }
        
        @keyframes ambientGlow {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Connection Lines (for future live sales) */
        .sale-connection {
            position: absolute;
            pointer-events: none;
            stroke: rgba(54, 179, 126, 0.6);
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 5, 5;
            animation: connectionFlow 1s linear infinite;
        }
        
        @keyframes connectionFlow {
            0% { stroke-dashoffset: 10; }
            100% { stroke-dashoffset: 0; }
        }
        
        /* ============================================
           DELIVERY & PAYMENT ANIMATIONS (Emotional)
           ============================================ */
        
        /* Delivery Animation - Truck/Package */
        .delivery-animation {
            position: absolute;
            pointer-events: none;
            z-index: 150;
            font-size: 24px;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.5));
        }
        
        .delivery-truck {
            animation: driveDelivery 2.5s ease-in-out forwards;
        }
        
        .delivery-package {
            animation: floatPackage 2s ease-out forwards;
        }
        
        @keyframes driveDelivery {
            0% { 
                transform: translate(0, 0) scale(0.5) rotate(0deg); 
                opacity: 0;
            }
            15% {
                transform: translate(5px, -5px) scale(1) rotate(-5deg);
                opacity: 1;
            }
            50% { 
                transform: translate(60px, -35px) scale(1.1) rotate(5deg);
                opacity: 1;
            }
            85% {
                transform: translate(110px, -15px) scale(0.9) rotate(-3deg);
                opacity: 0.8;
            }
            100% { 
                transform: translate(140px, 10px) scale(0.6) rotate(0deg); 
                opacity: 0;
            }
        }
        
        @keyframes floatPackage {
            0% { 
                transform: translate(0, 0) scale(0.5) rotate(0deg); 
                opacity: 0;
            }
            20% {
                transform: translate(0, -15px) scale(1.2) rotate(-10deg);
                opacity: 1;
            }
            50% { 
                transform: translate(20px, -50px) scale(1) rotate(15deg);
                opacity: 1;
            }
            80% {
                transform: translate(50px, -70px) scale(0.8) rotate(-5deg);
                opacity: 0.6;
            }
            100% { 
                transform: translate(80px, -90px) scale(0.4) rotate(10deg); 
                opacity: 0;
            }
        }
        
        /* Money Animation - Flying Real */
        .money-animation {
            position: absolute;
            pointer-events: none;
            z-index: 160;
            font-size: 20px;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.4));
        }
        
        .money-small {
            animation: moneyFlySmall 1.2s ease-out forwards;
        }
        
        .money-medium {
            animation: moneyFlyMedium 1.5s ease-out forwards;
        }
        
        .money-large {
            animation: moneyFlyLarge 1.8s ease-out forwards;
        }
        
        @keyframes moneyFlySmall {
            0% { 
                transform: translateY(0) scale(0.3) rotate(0deg); 
                opacity: 0;
            }
            20% {
                transform: translateY(-10px) scale(1) rotate(-15deg);
                opacity: 1;
            }
            60% {
                transform: translateY(-40px) scale(1.1) rotate(10deg);
                opacity: 0.9;
            }
            100% { 
                transform: translateY(-70px) scale(0.5) rotate(-5deg); 
                opacity: 0;
            }
        }
        
        @keyframes moneyFlyMedium {
            0% { 
                transform: translate(0, 0) scale(0.3) rotate(0deg); 
                opacity: 0;
            }
            15% {
                transform: translate(-5px, -15px) scale(1.2) rotate(-20deg);
                opacity: 1;
            }
            50% {
                transform: translate(10px, -55px) scale(1.3) rotate(15deg);
                opacity: 1;
            }
            100% { 
                transform: translate(0, -100px) scale(0.6) rotate(-10deg); 
                opacity: 0;
            }
        }
        
        @keyframes moneyFlyLarge {
            0% { 
                transform: translate(0, 0) scale(0.3) rotate(0deg); 
                opacity: 0;
            }
            10% {
                transform: translate(0, -10px) scale(1.3) rotate(-10deg);
                opacity: 1;
            }
            40% {
                transform: translate(15px, -60px) scale(1.5) rotate(20deg);
                opacity: 1;
            }
            70% {
                transform: translate(-10px, -100px) scale(1.2) rotate(-15deg);
                opacity: 0.8;
            }
            100% { 
                transform: translate(5px, -140px) scale(0.7) rotate(5deg); 
                opacity: 0;
            }
        }
        
        /* Multiple money burst effect */
        .money-burst {
            position: absolute;
            pointer-events: none;
            z-index: 165;
        }
        
        .money-burst .money-particle {
            position: absolute;
            font-size: 16px;
            animation: moneyParticle 1.5s ease-out forwards;
        }
        
        .money-burst .money-particle:nth-child(1) { animation-delay: 0s; }
        .money-burst .money-particle:nth-child(2) { animation-delay: 0.1s; }
        .money-burst .money-particle:nth-child(3) { animation-delay: 0.2s; }
        
        @keyframes moneyParticle {
            0% { 
                transform: translate(0, 0) scale(0.5); 
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            100% { 
                transform: translate(var(--tx), var(--ty)) scale(0.3) rotate(var(--rot)); 
                opacity: 0;
            }
        }
        
        /* State Tooltip (hidden by default) */
        .state-tooltip {
            display: none;
        }

        /* Right Sidebar Container - Two Column Layout */
        .right-sidebar {
            position: fixed;
            top: 80px;
            right: 24px;
            bottom: 24px;
            z-index: 100;
            width: 340px;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto auto 1fr auto auto;
            gap: 12px;
        }

        /* Segment Filters - Right Sidebar */
        .segment-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 12px;
            background: rgba(18, 18, 31, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
        }

        .segment-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--neutral-text-low);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .segment-btn:hover {
            background: var(--dark-surface-2);
            color: var(--neutral-background);
        }

        .segment-btn.active {
            background: var(--dark-surface-2);
            border-color: var(--dark-border-light);
            color: var(--neutral-background);
        }

        .segment-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .segment-btn[data-segment="all"] .segment-dot { background: linear-gradient(135deg, var(--primary-interactive), var(--secondary)); }
        .segment-btn[data-segment="moda"] .segment-dot { background: var(--segment-moda); }
        .segment-btn[data-segment="eletronicos"] .segment-dot { background: var(--segment-eletronicos); }
        .segment-btn[data-segment="casa"] .segment-dot { background: var(--segment-casa); }
        .segment-btn[data-segment="beleza"] .segment-dot { background: var(--segment-beleza); }
        .segment-btn[data-segment="alimentos"] .segment-dot { background: var(--segment-alimentos); }
        .segment-btn[data-segment="esportes"] .segment-dot { background: var(--segment-esportes); }

        /* Segment Tooltip on Hover */
        .segment-btn {
            position: relative;
        }

        .segment-btn .segment-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: rgba(10, 10, 20, 0.95);
            border: 1px solid var(--dark-border-light);
            border-radius: 8px;
            font-size: 11px;
            font-weight: 400;
            color: var(--neutral-background);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 100;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .segment-btn .segment-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--dark-border-light);
        }

        .segment-btn:hover .segment-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .segment-tooltip-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--neutral-background);
        }

        .segment-tooltip-desc {
            color: var(--neutral-text-low);
            font-size: 10px;
            max-width: 180px;
            white-space: normal;
            line-height: 1.4;
        }

        .segment-tooltip-percent {
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid var(--dark-border);
            font-size: 10px;
            color: var(--success);
            font-weight: 600;
        }

        /* GMV Counter - Right Sidebar Display */
        .gmv-display {
            position: relative;
            cursor: help;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 16px;
            background: rgba(18, 18, 31, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            overflow: visible;
        }

        .gmv-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 6px;
        }

        .gmv-value-wrapper {
            display: flex;
            align-items: baseline;
            justify-content: center;
            flex-wrap: wrap;
            gap: 4px;
        }

        .gmv-value {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -1px;
            background: linear-gradient(135deg, var(--neutral-background) 0%, var(--primary-light) 50%, var(--neutral-background) 100%);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
            animation: gmvShine 3s ease-in-out infinite;
            font-variant-numeric: tabular-nums;
            word-break: break-word;
        }

        @keyframes gmvShine {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .gmv-prefix {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-light);
            margin-right: 2px;
        }

        .gmv-cents {
            font-size: 20px;
            font-weight: 600;
            color: var(--neutral-text-low);
        }

        .gmv-suffix {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-light);
            margin-left: 2px;
        }

        .gmv-year {
            font-size: 11px;
            color: var(--neutral-text-low);
            margin-top: 6px;
        }

        .gmv-per-second {
            display: inline-block;
            padding: 5px 12px;
            background: rgba(54, 179, 126, 0.15);
            border: 1px solid rgba(54, 179, 126, 0.3);
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            color: var(--success);
            margin-top: 10px;
        }

        .gmv-per-second::before {
            content: '▲ ';
            font-size: 10px;
        }

        /* Stats Bar - Right Sidebar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            padding: 12px;
            background: rgba(18, 18, 31, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
            padding: 10px 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .stat-value {
            font-size: 18px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: var(--neutral-background);
        }

        .stat-value.highlight {
            color: var(--success);
        }

        .stat-label {
            font-size: 9px;
            font-weight: 500;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 3px;
        }

        .stat-trend {
            display: none; /* Hidden to save space */
        }

        /* Left Info Panel */
        .info-panel {
            position: fixed;
            top: 120px;
            left: 32px;
            z-index: 100;
            max-width: 280px;
        }

        .info-title {
            font-size: 42px;
            font-weight: 900;
            line-height: 1.05;
            letter-spacing: -2px;
            margin-bottom: 16px;
        }

        .info-title .highlight {
            background: linear-gradient(135deg, var(--primary-interactive), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .info-description {
            font-size: 14px;
            line-height: 1.6;
            color: var(--neutral-text-low);
            margin-bottom: 20px;
        }

        .info-cta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary-interactive), var(--primary-hover));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .info-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--primary-glow);
        }

        /* Left Sales Panel - Below Info Panel */
        .sales-panel {
            position: fixed;
            bottom: 24px;
            left: 32px;
            z-index: 100;
            width: 300px;
            max-height: calc(100vh - 150px);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .panel-title svg {
            width: 14px;
            height: 14px;
        }

        .sales-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 420px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 4px;
            scrollbar-width: thin;
            scrollbar-color: var(--dark-border-light) transparent;
        }

        .sale-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(18, 18, 31, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            animation: slideIn 0.4s ease-out;
        }
        
        /* Channel-specific background colors */
        .sale-item.channel-online {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(18, 18, 31, 0.9));
            border-color: rgba(33, 150, 243, 0.3);
        }
        
        .sale-item.channel-chat {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(18, 18, 31, 0.9));
            border-color: rgba(76, 175, 80, 0.3);
        }
        
        .sale-item.channel-pos {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.15), rgba(18, 18, 31, 0.9));
            border-color: rgba(255, 152, 0, 0.3);
        }
        
        .sale-item.channel-marketplace {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.15), rgba(18, 18, 31, 0.9));
            border-color: rgba(156, 39, 176, 0.3);
        }
        
        .sale-item.channel-social {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.15), rgba(18, 18, 31, 0.9));
            border-color: rgba(233, 30, 99, 0.3);
        }
        
        /* Custom scrollbar for webkit browsers */
        .sales-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .sales-list::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .sales-list::-webkit-scrollbar-thumb {
            background: var(--dark-border-light);
            border-radius: 3px;
        }
        
        .sales-list::-webkit-scrollbar-thumb:hover {
            background: var(--dark-border);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .sale-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .sale-info {
            flex: 1;
            min-width: 0;
        }

        .sale-location {
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sale-product {
            font-size: 11px;
            color: var(--neutral-text-low);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Human Moments - Customer & Stories */
        .sale-customer {
            font-size: 11px;
            font-weight: 600;
            color: var(--primary-light);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sale-moment {
            font-size: 10px;
            color: var(--success-light);
            margin-top: 3px;
            font-style: italic;
            line-height: 1.3;
            max-width: 200px;
        }

        .sale-item.has-moment {
            border-color: rgba(54, 179, 126, 0.4);
            background: rgba(18, 18, 31, 0.95);
        }

        .sale-item.has-moment:hover {
            border-color: rgba(54, 179, 126, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(54, 179, 126, 0.2);
        }

        .sale-value {
            font-size: 12px;
            font-weight: 700;
            color: var(--success);
        }

        /* Sale Badges (Channel & Solutions) */
        .sale-badges {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }

        .sale-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .sale-badge.channel-online {
            background: rgba(33, 150, 243, 0.2);
            color: #64b5f6;
        }

        .sale-badge.channel-chat {
            background: rgba(76, 175, 80, 0.2);
            color: #81c784;
        }

        .sale-badge.channel-pos {
            background: rgba(255, 152, 0, 0.2);
            color: #ffb74d;
        }

        .sale-badge.channel-marketplace {
            background: rgba(156, 39, 176, 0.2);
            color: #ce93d8;
        }

        .sale-badge.channel-social {
            background: rgba(233, 30, 99, 0.2);
            color: #f48fb1;
        }

        .sale-badge.nuvem-pay {
            background: rgba(0, 89, 213, 0.2);
            color: var(--primary-light);
        }

        .sale-badge.nuvem-envios {
            background: rgba(156, 39, 176, 0.2);
            color: #ce93d8;
        }

        /* First Sale Celebration */
        .sale-item.first-sale {
            border: 2px solid var(--game-gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(18, 18, 31, 0.95));
            animation: firstSaleGlow 2s ease-in-out infinite, slideIn 0.4s ease-out;
        }

        @keyframes firstSaleGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); }
        }

        .first-sale-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: linear-gradient(135deg, var(--game-gold), #ffa000);
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            color: #1a1a1a;
            text-transform: uppercase;
            animation: celebratePulse 1s ease-in-out infinite;
        }

        @keyframes celebratePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Sale Item Hover Tooltip */
        .sale-item {
            position: relative;
        }
        
        .sale-item-tooltip {
            position: absolute;
            left: calc(100% + 12px);
            top: 50%;
            transform: translateY(-50%);
            background: var(--dark-surface-2);
            border: 1px solid var(--dark-border-light);
            border-radius: 12px;
            padding: 14px 16px;
            min-width: 240px;
            max-width: 280px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s ease;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }
        
        .sale-item-tooltip::before {
            content: '';
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 8px solid transparent;
            border-right-color: var(--dark-border-light);
        }
        
        .sale-item:hover .sale-item-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(5px);
        }
        
        .tooltip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .tooltip-store {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-light);
        }
        
        .tooltip-channel {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tooltip-product {
            font-size: 12px;
            font-weight: 600;
            color: var(--neutral-background);
            margin-bottom: 6px;
        }
        
        .tooltip-customer {
            font-size: 11px;
            color: var(--neutral-text-low);
            margin-bottom: 4px;
        }
        
        .tooltip-location {
            font-size: 11px;
            color: var(--neutral-text-low);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .tooltip-value {
            font-size: 16px;
            font-weight: 800;
            color: var(--success);
            margin: 10px 0;
        }
        
        .tooltip-solutions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--dark-border);
        }
        
        .tooltip-solutions span {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(0, 89, 213, 0.15);
            color: var(--primary-light);
        }
        
        .tooltip-moment {
            font-size: 11px;
            font-style: italic;
            color: var(--success-light);
            margin-top: 8px;
            padding: 6px 10px;
            background: rgba(54, 179, 126, 0.1);
            border-radius: 6px;
            border-left: 3px solid var(--success);
        }
        
        .tooltip-time {
            font-size: 10px;
            color: var(--neutral-text-low);
            margin-top: 8px;
            text-align: right;
        }
        
        /* Hide tooltip on mobile */
        @media (max-width: 1024px) {
            .sale-item-tooltip {
                display: none;
            }
        }

        /* First Sale Celebration Overlay */
        .first-sale-celebration {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .first-sale-celebration.active {
            opacity: 1;
            visibility: visible;
        }

        .celebration-card {
            text-align: center;
            padding: 40px 60px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(18, 18, 31, 0.98));
            border: 2px solid var(--game-gold);
            border-radius: 20px;
            animation: celebrateIn 0.5s ease-out;
        }

        @keyframes celebrateIn {
            from { transform: scale(0.5) rotate(-10deg); opacity: 0; }
            to { transform: scale(1) rotate(0); opacity: 1; }
        }

        .celebration-emoji {
            font-size: 64px;
            margin-bottom: 16px;
            animation: bounce 0.6s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .celebration-title {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--game-gold), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .celebration-subtitle {
            font-size: 14px;
            color: var(--neutral-text-low);
            margin-bottom: 16px;
        }

        .celebration-store {
            font-size: 20px;
            font-weight: 700;
            color: var(--neutral-background);
            margin-bottom: 4px;
        }

        .celebration-location {
            font-size: 14px;
            color: var(--neutral-text-low);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .celebration-greeting {
            font-size: 16px;
            font-weight: 600;
            color: var(--success-light);
            margin-top: 16px;
            padding: 10px 20px;
            background: rgba(54, 179, 126, 0.15);
            border-radius: 50px;
            display: inline-block;
            animation: greetingPulse 2s ease-in-out infinite;
        }
        
        @keyframes greetingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .celebration-share-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary-interactive), var(--primary-hover));
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 89, 213, 0.3);
        }
        
        .celebration-share-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 89, 213, 0.4);
        }
        
        .celebration-share-btn svg {
            width: 18px;
            height: 18px;
        }
        
        .celebration-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: var(--neutral-text-low);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .celebration-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--neutral-background);
        }
        
        .celebration-regional-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .celebration-card {
            position: relative;
            max-width: 400px;
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 10000;
            pointer-events: none;
        }

        /* Flow Arcs on Map */
        .flow-arc {
            position: absolute;
            pointer-events: none;
            z-index: 10;
        }

        .flow-arc path {
            fill: none;
            stroke: var(--primary-light);
            stroke-width: 2;
            stroke-linecap: round;
            opacity: 0.6;
        }

        .flow-arc.nuvem-solution path {
            stroke: var(--game-gold);
            stroke-width: 2.5;
        }

        .flow-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--primary-light);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--primary-light);
            pointer-events: none;
            z-index: 11;
        }

        .flow-particle.nuvem-solution {
            background: var(--game-gold);
            box-shadow: 0 0 10px var(--game-gold);
        }

        @keyframes flowDraw {
            to { stroke-dashoffset: 0; }
        }

        /* Solutions Counter in Stats */
        .solutions-stats {
            display: flex;
            gap: 10px;
            padding: 12px;
            background: rgba(18, 18, 31, 0.95);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
        }

        .solution-stat {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--dark-surface-2);
            border-radius: 10px;
            position: relative;
            cursor: help;
            transition: all 0.2s ease;
        }
        
        .solution-stat:hover {
            background: var(--dark-border);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .solution-stat-icon {
            font-size: 18px;
        }

        .solution-stat-info {
            display: flex;
            flex-direction: column;
        }

        .solution-stat-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--neutral-background);
        }

        .solution-stat-label {
            font-size: 9px;
            color: var(--neutral-text-low);
            text-transform: uppercase;
        }
        
        /* Solution Stat Tooltip */
        .solution-stat-tooltip {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-surface-2);
            border: 1px solid var(--dark-border-light);
            border-radius: 12px;
            padding: 14px 16px;
            min-width: 220px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s ease;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }
        
        .solution-stat-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--dark-border-light);
        }
        
        .solution-stat:hover .solution-stat-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
        }
        
        .solution-tooltip-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--neutral-background);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .solution-tooltip-desc {
            font-size: 11px;
            color: var(--neutral-text-low);
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .solution-tooltip-stat {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-top: 1px solid var(--dark-border);
            font-size: 11px;
        }
        
        .solution-tooltip-stat-label {
            color: var(--neutral-text-low);
        }
        
        .solution-tooltip-stat-value {
            font-weight: 700;
            color: var(--primary-light);
        }
        
        .solution-tooltip-highlight {
            margin-top: 10px;
            padding: 8px 10px;
            background: rgba(0, 89, 213, 0.15);
            border-radius: 6px;
            font-size: 10px;
            color: var(--primary-light);
            text-align: center;
        }

        /* Channel Filter Tabs */
        .channel-tabs {
            display: flex;
            gap: 6px;
        }

        .channel-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 8px;
            background: var(--dark-surface);
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            color: var(--neutral-text-low);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .channel-tab:hover {
            background: var(--dark-surface-2);
            color: var(--neutral-background);
        }

        .channel-tab.active {
            background: var(--primary-interactive);
            border-color: var(--primary-interactive);
            color: white;
        }

        .channel-tab svg {
            width: 14px;
            height: 14px;
        }

        /* First Sales Counter */
        .first-sales-counter {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), var(--dark-surface-2));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            cursor: help;
        }
        
        /* Hover tooltip for first sales and GMV */
        .info-tooltip {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 16px;
            background: rgba(10, 10, 20, 0.98);
            border: 1px solid var(--dark-border-light);
            border-radius: 10px;
            font-size: 12px;
            color: var(--neutral-background);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 200;
            pointer-events: none;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            min-width: 260px;
            max-width: 300px;
        }
        
        .info-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--dark-border-light);
        }
        
        .first-sales-counter:hover .info-tooltip,
        .gmv-display:hover .info-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        /* First Sales tooltip appears BELOW (not above) */
        .first-sales-counter .info-tooltip {
            bottom: auto;
            top: calc(100% + 10px);
        }
        
        .first-sales-counter .info-tooltip::after {
            top: auto;
            bottom: 100%;
            border-top-color: transparent;
            border-bottom-color: var(--dark-border-light);
        }
        
        .info-tooltip-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--neutral-background);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .info-tooltip-desc {
            font-size: 11px;
            color: var(--neutral-text-low);
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .info-tooltip-highlight {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(0, 89, 213, 0.2);
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            color: var(--primary-light);
        }

        .first-sales-icon {
            font-size: 22px;
        }

        .first-sales-info {
            flex: 1;
        }

        .first-sales-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--game-gold);
        }

        .first-sales-label {
            font-size: 11px;
            color: var(--neutral-text-low);
        }

        /* ============================================
           GAMING VIEW - Cart Rescue
           ============================================ */
        .game-view {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, var(--dark-bg) 0%, #0f0f1a 100%);
            overflow: hidden;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .game-header {
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
        }

        .game-title {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -1px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--game-gold), var(--warning));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-subtitle {
            font-size: 14px;
            color: var(--neutral-text-low);
        }

        .game-stats {
            position: absolute;
            top: 24px;
            right: 32px;
            z-index: 10;
            display: flex;
            gap: 24px;
        }

        .game-stat {
            text-align: right;
        }

        .game-stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--neutral-background);
        }

        .game-stat-value.score {
            color: var(--game-gold);
        }

        .game-stat-label {
            font-size: 10px;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .game-area {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            height: calc(100% - 200px);
            background: rgba(18, 18, 31, 0.5);
            border: 2px solid var(--dark-border);
            border-radius: 16px;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .game-view {
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .falling-cart {
            position: absolute;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            background: linear-gradient(135deg, var(--danger), var(--danger-light));
            border-radius: 12px;
            cursor: default;
            animation: shake 0.5s ease-in-out infinite;
            transition: transform 0.1s ease, opacity 0.3s ease;
            user-select: none;
            pointer-events: none;
        }
        
        /* Cart Types */
        .falling-cart.premium {
            background: linear-gradient(135deg, #ffd700, #ff9800);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            animation: shake 0.5s ease-in-out infinite, glow-gold 1s ease-in-out infinite;
        }
        
        .falling-cart.vip {
            background: linear-gradient(135deg, #9c27b0, #e91e63);
            box-shadow: 0 0 25px rgba(156, 39, 176, 0.7);
            animation: shake 0.4s ease-in-out infinite, glow-purple 0.8s ease-in-out infinite;
        }
        
        .falling-cart.bomb {
            background: linear-gradient(135deg, #1a1a1a, #333);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5), 0 0 30px rgba(255, 0, 0, 0.3);
            animation: shake 0.3s ease-in-out infinite, bombPulse 0.5s ease-in-out infinite;
            border: 2px solid #ff0000;
        }
        
        @keyframes bombPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 0, 0, 0.5), 0 0 30px rgba(255, 0, 0, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 0, 0, 0.8), 0 0 50px rgba(255, 0, 0, 0.5); }
        }
        
        /* Bomb warning icon */
        .falling-cart.bomb::before {
            content: '⚠️';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            animation: warningBlink 0.4s ease-in-out infinite;
        }
        
        @keyframes warningBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .falling-cart.speedy {
            background: linear-gradient(135deg, #00bcd4, #03a9f4);
            box-shadow: 0 0 25px rgba(0, 188, 212, 0.7);
            animation: speedyTrail 0.2s ease-in-out infinite;
        }
        
        .falling-cart.zigzag {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
            animation: zigzagGlow 0.5s ease-in-out infinite;
        }
        
        .falling-cart.ghost {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(200,200,200,0.3));
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            animation: ghostFade 1.5s ease-in-out infinite;
            border: 2px dashed rgba(255,255,255,0.4);
        }
        
        .falling-cart.splitter {
            background: linear-gradient(135deg, #ff5722, #ff9800);
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.6);
            animation: splitterPulse 0.6s ease-in-out infinite;
        }
        
        .falling-cart.mega-bomb {
            background: linear-gradient(135deg, #4a0000, #8b0000);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.8), 0 0 60px rgba(255, 0, 0, 0.4);
            animation: megaBombPulse 0.4s ease-in-out infinite;
            width: 70px;
            height: 70px;
            font-size: 36px;
            border: 3px solid #ff0000;
        }
        
        .falling-cart.mega-bomb::before {
            content: '☠️ PERIGO';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 700;
            color: #ff0000;
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.8);
            white-space: nowrap;
            animation: warningBlink 0.3s ease-in-out infinite;
        }
        
        .falling-cart.decoy {
            /* Decoy reveals itself after 0.8s */
            animation: decoyReveal 0.8s ease-in-out forwards;
        }
        
        @keyframes decoyReveal {
            0%, 60% { 
                /* Looks normal */
                border: 2px solid transparent;
            }
            70%, 100% { 
                /* Subtle suspicious border */
                border: 2px dashed rgba(255, 100, 100, 0.6);
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
            }
        }
        
        .falling-cart.decoy::after {
            content: '❓';
            position: absolute;
            top: -18px;
            right: -8px;
            font-size: 12px;
            opacity: 0;
            animation: suspiciousAppear 0.8s ease-in-out 0.6s forwards;
        }
        
        @keyframes suspiciousAppear {
            to { opacity: 1; }
        }
        
        /* Float up animation for bonus text */
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }
        
        @keyframes speedyTrail {
            0%, 100% { box-shadow: 0 0 25px rgba(0, 188, 212, 0.7), 0 30px 20px rgba(0, 188, 212, 0.3); }
            50% { box-shadow: 0 0 35px rgba(0, 188, 212, 0.9), 0 40px 30px rgba(0, 188, 212, 0.5); }
        }
        
        @keyframes zigzagGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.6); transform: rotate(-5deg); }
            50% { box-shadow: 0 0 30px rgba(76, 175, 80, 0.8); transform: rotate(5deg); }
        }
        
        @keyframes ghostFade {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.3; }
        }
        
        @keyframes splitterPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes megaBombPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255, 0, 0, 0.8); }
            50% { transform: scale(1.15); box-shadow: 0 0 50px rgba(255, 0, 0, 1), 0 0 80px rgba(255, 0, 0, 0.6); }
        }
        
        @keyframes glow-gold {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 0.9); }
        }
        
        @keyframes glow-purple {
            0%, 100% { box-shadow: 0 0 25px rgba(156, 39, 176, 0.7); }
            50% { box-shadow: 0 0 40px rgba(233, 30, 99, 0.9); }
        }

        .falling-cart.rescued {
            animation: rescue 0.5s ease-out forwards;
            pointer-events: none;
        }
        
        /* Power-ups */
        .power-up {
            position: absolute;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border-radius: 50%;
            animation: float-down 4s linear, pulse-glow 0.5s ease-in-out infinite;
            pointer-events: none;
            z-index: 5;
        }
        
        .power-up.speed { background: linear-gradient(135deg, #00bcd4, #4dd0e1); }
        .power-up.freeze { background: linear-gradient(135deg, #2196f3, #64b5f6); }
        .power-up.multiplier { background: linear-gradient(135deg, #ffc107, #ffeb3b); }
        .power-up.magnet { background: linear-gradient(135deg, #9c27b0, #ba68c8); }
        .power-up.shield { background: linear-gradient(135deg, #4caf50, #81c784); }
        .power-up.heart { 
            background: linear-gradient(135deg, #e91e63, #f48fb1); 
            animation: pulse-glow 0.5s ease-in-out infinite, heartBeat 0.6s ease-in-out infinite;
        }
        
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.15); }
            50% { transform: scale(1); }
            75% { transform: scale(1.1); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes float-down {
            from { top: -60px; }
            to { top: 100%; }
        }
        
        /* Wave Indicator */
        .wave-indicator {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(18, 18, 31, 0.95);
            padding: 12px 24px;
            border-radius: 30px;
            border: 2px solid var(--primary-interactive);
            font-size: 16px;
            font-weight: 700;
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .wave-number {
            color: var(--primary-light);
            font-size: 20px;
        }
        
        /* Lives Display */
        .lives-display {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }
        
        .life-heart {
            font-size: 20px;
            transition: transform 0.3s, opacity 0.3s;
        }
        
        .life-heart.lost {
            opacity: 0.2;
            transform: scale(0.8);
        }
        
        /* Screen Shake - using box-shadow instead of transform to avoid moving content */
        @keyframes screen-shake-glow {
            0%, 100% { box-shadow: inset 0 0 0 rgba(255, 100, 100, 0); }
            25% { box-shadow: inset 0 0 30px rgba(255, 100, 100, 0.3); }
            50% { box-shadow: inset 0 0 50px rgba(255, 200, 100, 0.4); }
            75% { box-shadow: inset 0 0 30px rgba(255, 100, 100, 0.3); }
        }
        
        .game-area.shake {
            animation: screen-shake-glow 0.3s ease-in-out;
        }
        
        /* Game Over Screen */
        .game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 20, 0.95);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
            overflow-y: auto;
            padding: 20px 0;
            -webkit-overflow-scrolling: touch;
        }
        
        .game-over-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .game-over-card {
            background: linear-gradient(135deg, var(--dark-surface), var(--dark-surface-2));
            border: 2px solid var(--primary-interactive);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            max-width: 360px;
            width: 90%;
            margin: auto;
        }
        
        .game-over-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .game-over-wave {
            font-size: 14px;
            color: var(--neutral-text-low);
            margin-bottom: 24px;
        }
        
        /* Ranking Form */
        .ranking-form {
            margin: 12px 0;
            padding: 14px;
            background: rgba(0, 89, 213, 0.1);
            border: 1px solid var(--primary-interactive);
            border-radius: 12px;
        }
        
        .ranking-form-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-light);
            margin-bottom: 10px;
        }
        
        .ranking-form-input {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--dark-border-light);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s, background 0.2s;
            box-sizing: border-box;
        }
        
        .ranking-form-input:focus {
            outline: none;
            border-color: var(--primary-interactive);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .ranking-form-input::placeholder {
            color: var(--neutral-text-low);
        }
        
        .ranking-form-submit {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-interactive), var(--primary-hover));
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .ranking-form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--primary-glow);
        }
        
        .ranking-form-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .ranking-form-skip {
            margin-top: 10px;
            background: transparent;
            border: 1px solid var(--dark-border-light);
            color: var(--neutral-text-low);
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: border-color 0.2s, color 0.2s;
        }
        
        .ranking-form-skip:hover {
            border-color: var(--neutral-text-low);
            color: white;
        }
        
        .ranking-success {
            color: var(--success);
            font-size: 14px;
            padding: 12px;
            background: rgba(54, 179, 126, 0.1);
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .game-over-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--game-gold);
            margin-bottom: 8px;
        }
        
        .game-over-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 16px 0;
            padding: 12px 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
        }
        
        .game-over-stat {
            text-align: center;
        }
        
        .game-over-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-light);
            white-space: nowrap;
        }
        
        .game-over-stat-label {
            font-size: 10px;
            color: var(--neutral-text-low);
            margin-top: 2px;
            white-space: nowrap;
        }
        
        .game-over-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .game-over-btn {
            flex: 1;
            padding: 14px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .game-over-btn.primary {
            background: linear-gradient(135deg, var(--primary-interactive), var(--primary-hover));
            color: white;
        }
        
        .game-over-btn.secondary {
            background: var(--dark-surface-2);
            color: white;
            border: 1px solid var(--dark-border-light);
        }
        
        .game-over-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 89, 213, 0.4);
        }
        
        /* Active Power-up Indicator */
        .active-powerups {
            position: absolute;
            top: 80px;
            left: 32px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 15;
        }
        
        .active-powerup {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(18, 18, 31, 0.9);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .powerup-timer {
            width: 40px;
            height: 4px;
            background: var(--dark-surface-2);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .powerup-timer-fill {
            height: 100%;
            background: var(--primary-light);
            transition: width 0.1s linear;
        }
        
        /* Particle Effects */
        .particle-burst {
            position: absolute;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: particle-fly 0.8s ease-out forwards;
        }
        
        @keyframes particle-fly {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        @keyframes shake {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        @keyframes rescue {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(0); opacity: 0; }
        }

        .rescue-points {
            position: absolute;
            font-size: 24px;
            font-weight: 800;
            color: var(--success);
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        .game-controls {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
        }

        .game-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--primary-interactive), var(--primary-hover));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--primary-glow);
        }

        .game-btn.secondary {
            background: var(--dark-surface-2);
            border: 1px solid var(--dark-border);
        }

        /* Nuvemshop Paddle/Cursor */
        .game-paddle {
            position: fixed;
            left: 0;
            top: 0;
            width: 90px;
            height: 90px;
            pointer-events: none;
            z-index: 100;
            display: none;
            will-change: transform;
        }

        .paddle-inner {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 30px var(--primary-glow), 
                0 0 60px rgba(0, 89, 213, 0.4),
                0 4px 20px rgba(0, 0, 0, 0.3);
            animation: paddlePulse 1.5s ease-in-out infinite;
            padding: 16px;
        }

        .paddle-inner svg,
        .paddle-inner img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .paddle-logo {
            filter: drop-shadow(0 2px 8px rgba(0, 102, 255, 0.5));
        }

        .paddle-trail {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, var(--primary-glow) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.5;
            animation: trailFade 0.3s ease-out forwards;
        }

        @keyframes paddlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes trailFade {
            from { opacity: 0.5; transform: scale(1); }
            to { opacity: 0; transform: scale(0.5); }
        }

        .paddle-hit {
            animation: paddleHit 0.2s ease-out;
        }

        @keyframes paddleHit {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Side Counter Panel */
        .game-side-counter {
            position: absolute;
            bottom: 140px;
            left: 32px;
            width: 200px;
            z-index: 10;
        }

        .counter-card {
            background: rgba(18, 18, 31, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--dark-border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .counter-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .counter-main-value {
            font-size: 48px;
            font-weight: 900;
            color: var(--game-gold);
            line-height: 1;
            margin-bottom: 4px;
        }

        .counter-sub {
            font-size: 12px;
            color: var(--neutral-text-low);
        }

        .combo-display {
            text-align: center;
            padding: 16px;
        }

        .combo-value {
            font-size: 36px;
            font-weight: 900;
            color: var(--success);
            line-height: 1;
        }

        .combo-value.hot {
            color: var(--warning);
            animation: comboHot 0.3s ease infinite;
        }

        .combo-value.fire {
            color: var(--danger);
            animation: comboFire 0.2s ease infinite;
        }

        @keyframes comboHot {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes comboFire {
            0%, 100% { transform: scale(1) rotate(-2deg); }
            50% { transform: scale(1.15) rotate(2deg); }
        }

        .combo-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }

        .combo-multiplier {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--success), #2ecc71);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            margin-top: 8px;
        }

        .combo-multiplier.x3 {
            background: linear-gradient(135deg, var(--warning), #f39c12);
        }

        .combo-multiplier.x5 {
            background: linear-gradient(135deg, var(--danger), #e74c3c);
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--dark-border);
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .stats-row-label {
            font-size: 12px;
            color: var(--neutral-text-low);
        }

        .stats-row-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--neutral-background);
        }

        .stats-row-value.green {
            color: var(--success);
        }

        .stats-row-value.red {
            color: var(--danger);
        }

        /* Game hint */
        .game-hint {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(18, 18, 31, 0.9);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            font-size: 12px;
            color: var(--neutral-text-low);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .game-hint-icon {
            font-size: 18px;
        }

        /* Leaderboard */
        .leaderboard {
            position: absolute;
            top: 120px;
            right: 32px;
            width: 260px;
            z-index: 10;
        }

        .leaderboard-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        /* Live Ranking Badge */
        .live-ranking-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: rgba(54, 179, 126, 0.15);
            border: 1px solid rgba(54, 179, 126, 0.3);
            border-radius: 10px;
            font-size: 9px;
            font-weight: 700;
            color: var(--success);
            margin-left: auto;
            animation: livePulse 2s ease-in-out infinite;
        }

        .live-ranking-badge .live-dot {
            width: 6px;
            height: 6px;
            background: var(--success);
            border-radius: 50%;
            animation: liveDotPulse 1.5s ease-in-out infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes liveDotPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* New Player Animation */
        .leaderboard-item.new-player {
            animation: newPlayerSlideIn 0.6s ease-out;
            border-left: 3px solid var(--success);
        }

        @keyframes newPlayerSlideIn {
            0% {
                opacity: 0;
                transform: translateX(-20px);
                background: rgba(54, 179, 126, 0.2);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
                background: rgba(18, 18, 31, 0.85);
            }
        }

        /* Just Added Player Highlight */
        .leaderboard-item.just-added {
            animation: justAddedPulse 1s ease-out, newPlayerSlideIn 0.6s ease-out;
            border-left: 3px solid var(--primary-light);
            background: rgba(0, 89, 213, 0.15) !important;
            box-shadow: 0 0 20px rgba(0, 89, 213, 0.3);
        }

        @keyframes justAddedPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(0, 89, 213, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(0, 89, 213, 0.6);
            }
        }

        .just-added-badge {
            display: inline-block;
            margin-left: 6px;
            padding: 2px 6px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-interactive));
            color: white;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: badgeGlow 1.5s ease-in-out infinite;
        }

        @keyframes badgeGlow {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        .clear-ranking-btn {
            width: 100%;
            margin-top: 12px;
            padding: 8px 12px;
            background: transparent;
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            color: var(--neutral-text-low);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clear-ranking-btn:hover {
            background: rgba(222, 53, 11, 0.1);
            border-color: var(--danger);
            color: var(--danger);
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: rgba(18, 18, 31, 0.85);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
        }

        .leaderboard-rank {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
        }

        .leaderboard-rank.gold { background: linear-gradient(135deg, var(--game-gold), #b8860b); color: #1a1a1a; }
        .leaderboard-rank.silver { background: linear-gradient(135deg, var(--game-silver), #a0a0a0); color: #1a1a1a; }
        .leaderboard-rank.bronze { background: linear-gradient(135deg, var(--game-bronze), #a0522d); color: white; }
        .leaderboard-rank.default { background: var(--dark-surface-2); color: var(--neutral-text-low); }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-size: 13px;
            font-weight: 600;
        }

        .leaderboard-store {
            font-size: 11px;
            color: var(--neutral-text-low);
        }

        .leaderboard-score {
            font-size: 14px;
            font-weight: 700;
            color: var(--game-gold);
        }

        /* Leaderboard from storage (lb- prefix) */
        .lb-rank {
            font-size: 16px;
            min-width: 24px;
        }

        .lb-name {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .lb-wave {
            font-size: 11px;
            padding: 2px 6px;
            background: rgba(0, 188, 212, 0.2);
            color: #00bcd4;
            border-radius: 4px;
            font-weight: 600;
        }

        .lb-score {
            font-size: 13px;
            font-weight: 700;
            color: var(--game-gold);
        }

        /* Game Instructions */
        .game-instructions {
            position: absolute;
            right: 32px;
            top: 500px;
            width: 260px;
            padding: 20px;
            background: rgba(18, 18, 31, 0.85);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
        }

        .instructions-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .instructions-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .instructions-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 12px;
            color: var(--neutral-text-low);
            line-height: 1.5;
        }

        .instruction-icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-surface-2);
            border-radius: 6px;
            font-size: 12px;
        }

        /* ============================================
           STATS VIEW
           ============================================ */
        .stats-view {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 32px;
            overflow-y: auto;
            background: linear-gradient(180deg, var(--dark-bg) 0%, #0f0f1a 100%);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-card {
            padding: 24px;
            background: rgba(18, 18, 31, 0.8);
            border: 1px solid var(--dark-border);
            border-radius: 16px;
        }

        .stats-card.large {
            grid-column: span 2;
        }

        .stats-card.full {
            grid-column: span 4;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-badge {
            padding: 4px 10px;
            background: rgba(54, 179, 126, 0.15);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            color: var(--success);
        }

        .big-number {
            font-size: 48px;
            font-weight: 900;
            letter-spacing: -2px;
            line-height: 1;
            margin-bottom: 8px;
        }

        .big-number.gradient {
            background: linear-gradient(135deg, var(--neutral-background), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-description {
            font-size: 13px;
            color: var(--neutral-text-low);
        }

        .mini-chart {
            height: 60px;
            display: flex;
            align-items: flex-end;
            gap: 4px;
            margin-top: 20px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--primary-interactive), var(--primary-pressed));
            border-radius: 4px 4px 0 0;
            min-height: 10px;
        }

        /* Segment breakdown */
        .segment-breakdown {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .segment-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .segment-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .segment-name {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }

        .segment-value {
            font-size: 13px;
            font-weight: 600;
        }

        .segment-bar-container {
            width: 100px;
            height: 6px;
            background: var(--dark-surface-2);
            border-radius: 3px;
            overflow: hidden;
        }

        .segment-bar-fill {
            height: 100%;
            border-radius: 3px;
        }

        /* ============================================
           LOADING SCREEN
           ============================================ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--dark-border);
            border-top-color: var(--primary-interactive);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loader-text {
            font-size: 14px;
            color: var(--neutral-text-low);
        }

        /* Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--primary-light);
            border-radius: 50%;
            opacity: 0.2;
            animation: float 20s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) scale(0); opacity: 0; }
            10% { opacity: 0.2; }
            90% { opacity: 0.2; }
            100% { transform: translateY(-100vh) scale(1); opacity: 0; }
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 69px;
            right: 0;
            bottom: 0;
            width: 320px;
            background: var(--dark-surface);
            border-left: 1px solid var(--dark-border);
            z-index: 500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            padding: 24px;
            overflow-y: auto;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--dark-border);
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        .settings-label {
            font-size: 13px;
            font-weight: 500;
        }

        .toggle {
            width: 44px;
            height: 24px;
            background: var(--dark-surface-2);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .toggle.active {
            background: var(--primary-interactive);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }

        .toggle.active::after {
            transform: translateX(20px);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sales-panel, .info-panel { display: none; }
            .right-sidebar { width: 260px; }
            .gmv-value { font-size: 26px; }
            .gmv-prefix { font-size: 14px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .stats-card.large, .stats-card.full { grid-column: span 2; }
            .segment-filters { gap: 4px; padding: 10px; }
            .segment-btn { padding: 6px 10px; font-size: 11px; }
        }

        @media (max-width: 768px) {
            /* ===== HEADER MOBILE ===== */
            .header { 
                padding: 10px 16px; 
                height: 56px;
            }
            .header-cta { display: none; }
            .main-nav { display: none; }
            .logo-text { font-size: 12px; }
            .live-badge { font-size: 9px; padding: 3px 6px; }
            .navbar-logo { height: 24px; }
            
            /* ===== VIEWS MOBILE ===== */
            .view {
                top: 56px;
                bottom: 60px; /* Space for mobile nav */
            }
            
            /* ===== HIDE DESKTOP ELEMENTS ===== */
            .right-sidebar { display: none !important; }
            .info-panel { display: none !important; }
            .sales-panel { display: none !important; }
            .globe-controls-hint { display: none !important; }
            .leaderboard { display: none !important; }
            .game-instructions { display: none !important; }
            .game-side-counter { display: none !important; }
            
            /* ===== MAP VIEW MOBILE ===== */
            .globe-view {
                padding: 10px;
            }
            
            .globe-view::before { display: none; }
            
            .brazil-map-container {
                max-width: 100%;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            
            .brazil-map-svg {
                max-height: calc(100vh - 180px);
            }
            
            .map-glow { display: none; }
            
            /* Hide city dots on mobile */
            .city-dot { display: none !important; }
            
            /* Mobile GMV - collapsible top bar */
            .mobile-gmv {
                display: block !important;
                position: absolute;
                top: 10px;
                left: 10px;
                right: 10px;
                background: rgba(18, 18, 31, 0.95);
                backdrop-filter: blur(10px);
                border: 1px solid var(--dark-border);
                border-radius: 10px;
                z-index: 50;
                overflow: hidden;
                transition: all 0.3s ease;
            }
            
            .mobile-gmv-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 14px;
                cursor: pointer;
            }
            
            .mobile-gmv-main {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            
            .mobile-gmv .gmv-prefix {
                font-size: 12px;
                color: var(--neutral-text-low);
            }
            
            .mobile-gmv .gmv-value {
                font-size: 18px;
                font-weight: 700;
                color: var(--success);
            }
            
            .mobile-gmv-chevron {
                color: var(--neutral-text-low);
                transition: transform 0.3s ease;
            }
            
            .mobile-gmv.expanded .mobile-gmv-chevron {
                transform: rotate(180deg);
            }
            
            .mobile-gmv-details {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                padding: 0 14px 12px;
                max-height: 0;
                opacity: 0;
                overflow: hidden;
                transition: all 0.3s ease;
            }
            
            .mobile-gmv.expanded .mobile-gmv-details {
                max-height: 80px;
                opacity: 1;
                border-top: 1px solid var(--dark-border);
                padding-top: 12px;
            }
            
            .mobile-gmv-stat {
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .mobile-gmv-stat-value {
                font-size: 13px;
                font-weight: 700;
                color: var(--neutral-background);
                white-space: nowrap;
            }
            
            .mobile-gmv-stat-label {
                font-size: 9px;
                color: var(--neutral-text-low);
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            /* ===== GAME VIEW MOBILE ===== */
            .game-view {
                display: flex;
                flex-direction: column;
            }
            
            .game-container {
                flex: 1;
                display: flex;
                flex-direction: column;
                padding: 0;
                position: relative;
            }
            
            .game-header {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                padding: 10px 16px;
                text-align: center;
                background: rgba(18, 18, 31, 0.9);
            }
            
            .game-title { font-size: 16px; margin: 0; }
            .game-subtitle { display: none; }
            
            .game-area {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                flex: 1;
                width: calc(100% - 20px);
                height: auto;
                margin: 10px auto;
                min-height: 300px;
            }
            
            .game-stats {
                position: relative;
                top: auto;
                left: auto;
                right: auto;
                flex-direction: row;
                justify-content: center;
                gap: 8px;
                padding: 10px;
                background: rgba(18, 18, 31, 0.9);
            }
            
            .game-stat {
                padding: 6px 10px;
                min-width: auto;
                flex: 0 1 auto;
            }
            
            .game-stat-value { font-size: 16px; }
            .game-stat-label { font-size: 8px; }
            
            /* Paddle mobile */
            .game-paddle {
                width: 50px;
                height: 50px;
            }
            
            .paddle-inner {
                width: 44px;
                height: 44px;
                padding: 8px;
            }
            
            /* ===== GAME OVER MOBILE ===== */
            .game-over-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                padding: 0;
                align-items: center;
                justify-content: center;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .game-over-card {
                padding: 16px;
                margin: 20px 16px;
                max-width: calc(100% - 32px);
                max-height: calc(100vh - 40px);
                overflow-y: auto;
            }
            
            .game-over-title { font-size: 20px; margin-bottom: 4px; }
            .game-over-wave { font-size: 11px; }
            .game-over-score { font-size: 32px; }
            
            .game-over-stats {
                margin: 8px 0;
                padding: 8px;
                gap: 4px;
            }
            
            .game-over-stat-value { font-size: 13px; }
            .game-over-stat-label { font-size: 8px; }
            
            .ranking-form {
                margin: 8px 0;
                padding: 10px;
            }
            
            .ranking-form-title { font-size: 11px; margin-bottom: 6px; }
            .ranking-form-input { padding: 8px 10px; margin-bottom: 6px; font-size: 14px; }
            .ranking-form-submit { padding: 10px; font-size: 13px; }
            .ranking-form-skip { padding: 6px; font-size: 10px; margin-top: 4px; }
            
            .game-over-buttons { gap: 8px; }
            .game-over-btn { padding: 10px 16px; font-size: 12px; }
            
            /* Stats view mobile */
            .stats-grid { grid-template-columns: 1fr; }
            .stats-card.large, .stats-card.full { grid-column: span 1; }
        }
        
        /* ===== EXTRA SMALL SCREENS (iPhone SE, etc) ===== */
        @media (max-width: 380px) {
            .header { padding: 8px 12px; }
            .logo-text { font-size: 10px; }
            .navbar-logo { height: 20px; }
            
            .game-title { font-size: 14px; }
            .game-area { width: calc(100% - 16px); margin: 8px auto; }
            
            .game-stat { padding: 4px 8px; }
            .game-stat-value { font-size: 14px; }
            
            .game-paddle { width: 40px; height: 40px; }
            .paddle-inner { width: 36px; height: 36px; padding: 6px; }
            
            .game-over-card { padding: 12px; margin: 10px 12px; }
            .game-over-title { font-size: 18px; }
            .game-over-score { font-size: 28px; }
            
            .mobile-gmv .gmv-value { font-size: 16px; }
            
            .mobile-gmv-details {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }
            
            .mobile-gmv.expanded .mobile-gmv-details {
                max-height: 120px;
            }
            
            .mobile-gmv-stat-value { font-size: 12px; }
            .mobile-gmv-stat-label { font-size: 8px; }
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(18, 18, 31, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--dark-border);
            padding: 6px 8px;
            padding-bottom: max(6px, env(safe-area-inset-bottom));
            height: 60px;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .mobile-nav { display: flex; justify-content: space-around; align-items: center; }
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: 6px 12px;
            background: none;
            border: none;
            color: var(--neutral-text-low);
            font-size: 9px;
            font-weight: 500;
            cursor: pointer;
        }

        .mobile-nav-item.active {
            color: var(--primary-light);
        }

        .mobile-nav-item svg {
            width: 20px;
            height: 20px;
        }

        /* Globe Controls Hint */
        .globe-controls-hint {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-70%);
            z-index: 150;
            display: flex;
            gap: 24px;
            padding: 12px 20px;
            background: rgba(18, 18, 31, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            font-size: 11px;
            color: var(--neutral-text-low);
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .globe-controls-hint.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .control-hint {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-hint-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-surface-2);
            border-radius: 6px;
            font-size: 14px;
        }

        /* Region Tooltip */
        .region-tooltip {
            position: fixed;
            z-index: 200;
            min-width: 280px;
            max-width: 340px;
            padding: 20px;
            background: rgba(18, 18, 31, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--dark-border);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .region-tooltip.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        /* Mobile tooltip - centered bottom sheet style */
        @media (max-width: 768px) {
            .region-tooltip {
                position: fixed;
                left: 10px !important;
                right: 10px !important;
                bottom: 70px !important;
                top: auto !important;
                min-width: auto;
                max-width: none;
                width: calc(100% - 20px);
                padding: 16px;
                border-radius: 12px;
                transform: translateY(20px);
            }
            
            .region-tooltip.visible {
                transform: translateY(0);
            }
            
            .region-tooltip-header {
                margin-bottom: 12px;
                padding-bottom: 12px;
            }
            
            .region-tooltip-flag { font-size: 24px; }
            .region-tooltip-city { font-size: 16px; }
            .region-tooltip-country { font-size: 11px; }
            
            .region-tooltip-stats {
                gap: 8px;
                margin-bottom: 12px;
            }
            
            .region-stat { padding: 8px; }
            .region-stat-value { font-size: 14px; }
            .region-stat-label { font-size: 9px; }
            
            .region-tooltip-segments { margin-bottom: 12px; }
            .region-segments-title { font-size: 10px; margin-bottom: 6px; }
            .region-segment-tag { font-size: 10px; padding: 3px 6px; }
            
            .region-tooltip-footer { gap: 6px; }
            .region-tooltip-btn { padding: 8px 12px; font-size: 11px; }
        }

        .region-tooltip-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--dark-border);
        }

        .region-tooltip-flag {
            font-size: 32px;
        }

        .region-tooltip-title {
            flex: 1;
        }

        .region-tooltip-city {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .region-tooltip-country {
            font-size: 12px;
            color: var(--neutral-text-low);
        }

        .region-tooltip-close {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-surface-2);
            border: none;
            border-radius: 6px;
            color: var(--neutral-text-low);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .region-tooltip-close:hover {
            background: var(--dark-border);
            color: var(--neutral-background);
        }

        .region-tooltip-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .region-stat {
            padding: 12px;
            background: var(--dark-surface-2);
            border-radius: 10px;
        }

        .region-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--neutral-background);
            margin-bottom: 2px;
        }

        .region-stat-value.highlight {
            color: var(--success);
        }

        .region-stat-label {
            font-size: 10px;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .region-tooltip-segments {
            margin-bottom: 16px;
        }

        .region-segments-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--neutral-text-low);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .region-segments-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .region-segment-tag {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--dark-surface-2);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
        }

        .region-tooltip-footer {
            display: flex;
            gap: 8px;
        }

        .region-tooltip-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 16px;
            background: var(--primary-interactive);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .region-tooltip-btn:hover {
            background: var(--primary-hover);
        }

        .region-tooltip-btn.secondary {
            background: var(--dark-surface-2);
            border: 1px solid var(--dark-border);
        }

        .region-tooltip-btn.secondary:hover {
            background: var(--dark-border);
        }

        /* City Marker Styles */
        .city-marker-label {
            position: absolute;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            color: white;
            white-space: nowrap;
            pointer-events: none;
            transform: translate(-50%, -100%);
            margin-top: -8px;
        }

        /* Zoom Controls */
        .zoom-controls {
            position: fixed;
            right: 24px;
            bottom: 140px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(18, 18, 31, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            color: var(--neutral-background);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: var(--dark-surface-2);
            border-color: var(--dark-border-light);
        }

        .zoom-btn:active {
            transform: scale(0.95);
        }

        .zoom-divider {
            height: 1px;
            background: var(--dark-border);
            margin: 4px 0;
        }

        .zoom-btn.reset {
            font-size: 12px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .globe-controls-hint { display: none; }
            .zoom-controls { right: 16px; bottom: 200px; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
        <div class="loader">
            <div class="loader-spinner"></div>
            <div class="loader-text">Carregando dados em tempo real...</div>
        </div>
    </div>

    <div class="app-container">
        <!-- Particles -->
        <div class="particles" id="particles"></div>

        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo" onclick="switchView('globe')">
                    <div class="logo-icon">
                        <img src="assets/nuvemshop-logo.png" alt="Nuvemshop" class="navbar-logo">
                    </div>
                    <div class="logo-text">E-commerce do Brasil ao Vivo</div>
                </div>
                <nav class="main-nav">
                    <button class="nav-item active" data-view="globe" onclick="switchView('globe')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                        Brasil
                    </button>
                    <button class="nav-item" data-view="game" onclick="switchView('game')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="6" width="20" height="12" rx="2"/>
                            <circle cx="8" cy="12" r="2"/>
                            <path d="M15 9h2M16 8v2M18 12h2"/>
                        </svg>
                        Caça aos Carrinhos
                        <span class="nav-badge">NOVO</span>
                    </button>
                    <button class="nav-item" data-view="stats" onclick="switchView('stats')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 20V10M12 20V4M6 20v-6"/>
                        </svg>
                        Estatísticas
                    </button>
                </nav>
            </div>
            <div class="header-right">
                <a href="https://www.nuvemshop.com.br/monte-sua-loja-virtual" class="header-cta" target="_blank">
                    Criar loja grátis
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </a>
                <div class="live-badge">
                    <div class="live-dot"></div>
                    AO VIVO
                </div>
                <button class="header-btn share-btn" id="share-btn" onclick="sharePage()" title="Compartilhar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                </button>
                <button class="header-btn" id="sound-toggle" onclick="toggleSound()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                    </svg>
                </button>
                <button class="header-btn" id="settings-toggle" onclick="toggleSettings()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- First Sale Celebration Overlay -->
        <div class="first-sale-celebration" id="first-sale-celebration" onclick="closeCelebration(event)">
            <div class="celebration-card">
                <button class="celebration-close-btn" onclick="closeCelebration(event)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
                <div class="celebration-emoji">🎉</div>
                <div class="celebration-regional-icon" id="celebration-regional-icon">🏙️</div>
                <div class="celebration-title">PRIMEIRA VENDA!</div>
                <div class="celebration-subtitle">Um novo merchant acaba de fazer história</div>
                <div class="celebration-store" id="celebration-store">Loja Exemplo</div>
                <div class="celebration-location">
                    <span>📍</span>
                    <span id="celebration-location">São Paulo, SP</span>
                </div>
            </div>
        </div>

        <!-- Region Tooltip -->
        <div class="region-tooltip" id="region-tooltip">
            <div class="region-tooltip-header">
                <div class="region-tooltip-flag" id="tooltip-flag">🇧🇷</div>
                <div class="region-tooltip-title">
                    <div class="region-tooltip-city" id="tooltip-city">São Paulo</div>
                    <div class="region-tooltip-country" id="tooltip-country">Brasil</div>
                </div>
                <button class="region-tooltip-close" onclick="closeTooltip()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="region-tooltip-stats">
                <div class="region-stat">
                    <div class="region-stat-value highlight" id="tooltip-orders">12.4K</div>
                    <div class="region-stat-label">Pedidos Hoje</div>
                </div>
                <div class="region-stat">
                    <div class="region-stat-value" id="tooltip-gmv">R$ 2.3M</div>
                    <div class="region-stat-label">GMV Hoje</div>
                </div>
                <div class="region-stat">
                    <div class="region-stat-value" id="tooltip-stores">8.547</div>
                    <div class="region-stat-label">Lojas Ativas</div>
                </div>
                <div class="region-stat">
                    <div class="region-stat-value" id="tooltip-ticket">R$ 185</div>
                    <div class="region-stat-label">Ticket Médio</div>
                </div>
            </div>
            <div class="region-tooltip-segments">
                <div class="region-segments-title">Top Segmentos</div>
                <div class="region-segments-list" id="tooltip-segments">
                    <span class="region-segment-tag"><span style="color: #e91e63">●</span> Moda 38%</span>
                    <span class="region-segment-tag"><span style="color: #2196f3">●</span> Eletrônicos 25%</span>
                    <span class="region-segment-tag"><span style="color: #9c27b0">●</span> Beleza 18%</span>
                </div>
            </div>
            <div class="region-tooltip-footer">
                <button class="region-tooltip-btn" onclick="focusOnCity()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                    </svg>
                    Focar
                </button>
                <button class="region-tooltip-btn secondary" onclick="closeTooltip()">Fechar</button>
            </div>
        </div>

        <!-- State Tooltip -->
        <div class="state-tooltip" id="state-tooltip">
            <div class="state-tooltip-header">
                <span class="state-tooltip-abbr" id="state-abbr">SP</span>
                <span class="state-tooltip-name" id="state-name">São Paulo</span>
            </div>
            <div class="state-tooltip-stats">
                <div class="state-stat">
                    <div class="state-stat-value" id="state-gmv">R$ 0</div>
                    <div class="state-stat-label">GMV</div>
                </div>
                <div class="state-stat">
                    <div class="state-stat-value" id="state-orders">0</div>
                    <div class="state-stat-label">Pedidos</div>
                </div>
                <div class="state-stat">
                    <div class="state-stat-value" id="state-stores">0</div>
                    <div class="state-stat-label">Lojas</div>
                </div>
                <div class="state-stat">
                    <div class="state-stat-value" id="state-ticket">R$ 0</div>
                    <div class="state-stat-label">Ticket Médio</div>
                </div>
            </div>
        </div>

        <!-- Brazil Map View -->
        <div class="view active" id="view-globe">
            <div class="globe-view">
                <div class="map-glow"></div>
                <div class="brazil-map-container" id="brazil-map-container">
                    <!-- SVG Map and city dots will be inserted by JavaScript -->
                </div>

                <!-- Map Controls Hint -->
                <div class="globe-controls-hint" id="globe-controls-hint">
                    <div class="control-hint">
                        <div class="control-hint-icon">👆</div>
                        <span>Clique nos estados</span>
                    </div>
                    <div class="control-hint">
                        <div class="control-hint-icon">📍</div>
                        <span>Explore as capitais</span>
                    </div>
                </div>
                
                <!-- Mobile GMV (shown only on mobile) - Collapsible -->
                <div class="mobile-gmv" id="mobile-gmv" style="display: none;">
                    <div class="mobile-gmv-header" onclick="toggleMobileGmv()">
                        <div class="mobile-gmv-main">
                            <span class="gmv-prefix">R$</span>
                            <span class="gmv-value" id="mobile-gmv-counter">0</span>
                        </div>
                        <svg class="mobile-gmv-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="mobile-gmv-details">
                        <div class="mobile-gmv-stat">
                            <span class="mobile-gmv-stat-value" id="mobile-orders">0</span>
                            <span class="mobile-gmv-stat-label">Pedidos</span>
                        </div>
                        <div class="mobile-gmv-stat">
                            <span class="mobile-gmv-stat-value" id="mobile-stores">0</span>
                            <span class="mobile-gmv-stat-label">Lojas</span>
                        </div>
                        <div class="mobile-gmv-stat">
                            <span class="mobile-gmv-stat-value" id="mobile-ticket">R$ 0</span>
                            <span class="mobile-gmv-stat-label">Ticket</span>
                        </div>
                        <div class="mobile-gmv-stat">
                            <span class="mobile-gmv-stat-value" id="mobile-per-sec">+R$ 0/s</span>
                            <span class="mobile-gmv-stat-label">Ritmo</span>
                        </div>
                    </div>
                </div>
                
                <!-- Info Panel (Left) -->
                <div class="info-panel">
                    <h1 class="info-title">
                        E-commerce do Brasil<br>
                        <span class="highlight">ao vivo</span>
                    </h1>
                    <p class="info-description">
                        Acompanhe em tempo real as vendas acontecendo em mais de 100.000 lojas da Nuvemshop em todo o Brasil.
                    </p>
                </div>

                <!-- Right Sidebar -->
                <div class="right-sidebar">
                    <!-- First Sales Counter -->
                    <div class="first-sales-counter">
                        <div class="first-sales-icon">🎉</div>
                        <div class="first-sales-info">
                            <div class="first-sales-value" id="first-sales-count">0</div>
                            <div class="first-sales-label">Primeiras Vendas Hoje</div>
                        </div>
                        <!-- Tooltip -->
                        <div class="info-tooltip">
                            <div class="info-tooltip-title">🎉 Primeiras Vendas</div>
                            <div class="info-tooltip-desc">
                                Número de merchants que realizaram sua <strong>primeira venda de todos os tempos</strong> hoje. 
                                Um marco especial na jornada empreendedora!
                            </div>
                            <div class="info-tooltip-highlight">Momento celebrado com confetti 🎊</div>
                        </div>
                    </div>

                    <!-- Channel Tabs -->
                    <div class="channel-tabs">
                        <button class="channel-tab active" data-channel="all" onclick="filterChannel('all')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                            Todos
                        </button>
                        <button class="channel-tab" data-channel="online" onclick="filterChannel('online')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                            Online
                        </button>
                        <button class="channel-tab" data-channel="chat" onclick="filterChannel('chat')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                            Chat
                        </button>
                        <button class="channel-tab" data-channel="pos" onclick="filterChannel('pos')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
                            POS
                        </button>
                        <button class="channel-tab" data-channel="social" onclick="filterChannel('social')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
                            Social
                        </button>
                    </div>

                    <!-- Segment Filters -->
                    <div class="segment-filters">
                        <button class="segment-btn active" data-segment="all" onclick="filterSegment('all')">
                            <span class="segment-dot"></span>
                            Todos
                            <div class="segment-tooltip">
                                <div class="segment-tooltip-title">Todos os Segmentos</div>
                                <div class="segment-tooltip-desc">Visualize vendas de todas as categorias de produtos em tempo real.</div>
                                <div class="segment-tooltip-percent">100% do volume</div>
                            </div>
                        </button>
                        <button class="segment-btn" data-segment="moda" onclick="filterSegment('moda')">
                            <span class="segment-dot"></span>
                            Moda
                            <div class="segment-tooltip">
                                <div class="segment-tooltip-title">👗 Moda & Vestuário</div>
                                <div class="segment-tooltip-desc">Roupas, calçados, acessórios e joias. O maior segmento do e-commerce brasileiro.</div>
                                <div class="segment-tooltip-percent">32% do volume</div>
                            </div>
                        </button>
                        <button class="segment-btn" data-segment="eletronicos" onclick="filterSegment('eletronicos')">
                            <span class="segment-dot"></span>
                            Eletrônicos
                            <div class="segment-tooltip">
                                <div class="segment-tooltip-title">📱 Eletrônicos</div>
                                <div class="segment-tooltip-desc">Smartphones, notebooks, games, áudio e gadgets tecnológicos.</div>
                                <div class="segment-tooltip-percent">24% do volume</div>
                            </div>
                        </button>
                        <button class="segment-btn" data-segment="casa" onclick="filterSegment('casa')">
                            <span class="segment-dot"></span>
                            Casa
                            <div class="segment-tooltip">
                                <div class="segment-tooltip-title">🏠 Casa & Decoração</div>
                                <div class="segment-tooltip-desc">Móveis, decoração, eletrodomésticos e utilidades para o lar.</div>
                                <div class="segment-tooltip-percent">15% do volume</div>
                            </div>
                        </button>
                        <button class="segment-btn" data-segment="beleza" onclick="filterSegment('beleza')">
                            <span class="segment-dot"></span>
                            Beleza
                            <div class="segment-tooltip">
                                <div class="segment-tooltip-title">💄 Beleza & Cosméticos</div>
                                <div class="segment-tooltip-desc">Maquiagem, skincare, perfumes e produtos de cuidado pessoal.</div>
                                <div class="segment-tooltip-percent">12% do volume</div>
                            </div>
                        </button>
                        <button class="segment-btn" data-segment="alimentos" onclick="filterSegment('alimentos')">
                            <span class="segment-dot"></span>
                            Alimentos
                            <div class="segment-tooltip">
                                <div class="segment-tooltip-title">🍫 Alimentos & Bebidas</div>
                                <div class="segment-tooltip-desc">Gourmet, vinhos, chocolates, cafés especiais e produtos artesanais.</div>
                                <div class="segment-tooltip-percent">10% do volume</div>
                            </div>
                        </button>
                        <button class="segment-btn" data-segment="esportes" onclick="filterSegment('esportes')">
                            <span class="segment-dot"></span>
                            Esportes
                            <div class="segment-tooltip">
                                <div class="segment-tooltip-title">⚽ Esportes & Fitness</div>
                                <div class="segment-tooltip-desc">Equipamentos esportivos, roupas fitness, suplementos e acessórios.</div>
                                <div class="segment-tooltip-percent">7% do volume</div>
                            </div>
                        </button>
                    </div>

                    <!-- GMV Display -->
                    <div class="gmv-display">
                        <div class="gmv-label">GMV Anual 2025</div>
                        <div class="gmv-value-wrapper">
                            <span class="gmv-prefix">R$</span>
                            <span class="gmv-value" id="gmv-counter">0</span>
                        </div>
                        <div class="gmv-year">Total transacionado pela plataforma</div>
                        <div class="gmv-per-second" id="gmv-per-second">R$ 0/segundo</div>
                        <!-- Tooltip -->
                        <div class="info-tooltip">
                            <div class="info-tooltip-title">💰 GMV (Gross Merchandise Value)</div>
                            <div class="info-tooltip-desc">
                                Volume total de vendas transacionado através da plataforma Nuvemshop em 2025. 
                                Inclui todas as transações de e-commerce, POS e social commerce.
                            </div>
                            <div class="info-tooltip-highlight">Atualizado em tempo real • +R$ 40K/segundo</div>
                        </div>
                    </div>

                    <!-- Stats Bar -->
                    <div class="stats-bar">
                        <div class="stat-item">
                            <div class="stat-value" id="total-orders">0</div>
                            <div class="stat-label">Pedidos Totais</div>
                            <div class="stat-trend">
                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                </svg>
                                +12.4%
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value highlight" id="orders-per-minute">0</div>
                            <div class="stat-label">Pedidos/min</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="active-stores">0</div>
                            <div class="stat-label">Lojas Ativas</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avg-ticket">R$ 0</div>
                            <div class="stat-label">Ticket Médio</div>
                        </div>
                    </div>

                    <!-- Nuvemshop Solutions Stats -->
                    <div class="solutions-stats">
                        <div class="solution-stat">
                            <div class="solution-stat-icon">💳</div>
                            <div class="solution-stat-info">
                                <div class="solution-stat-value" id="nuvem-pay-percent">0%</div>
                                <div class="solution-stat-label">Nuvem Pay</div>
                            </div>
                            <!-- Nuvem Pay Tooltip -->
                            <div class="solution-stat-tooltip">
                                <div class="solution-tooltip-title">💳 Nuvem Pay</div>
                                <div class="solution-tooltip-desc">
                                    Solução de pagamentos integrada da Nuvemshop. Aceite cartões, Pix e boleto com as melhores taxas.
                                </div>
                                <div class="solution-tooltip-stat">
                                    <span class="solution-tooltip-stat-label">Transações hoje:</span>
                                    <span class="solution-tooltip-stat-value" id="nuvem-pay-count">0</span>
                                </div>
                                <div class="solution-tooltip-stat">
                                    <span class="solution-tooltip-stat-label">Ticket médio:</span>
                                    <span class="solution-tooltip-stat-value">+15% vs outros</span>
                                </div>
                                <div class="solution-tooltip-highlight">
                                    Aprovação 23% maior que concorrentes
                                </div>
                            </div>
                        </div>
                        <div class="solution-stat">
                            <div class="solution-stat-icon">📦</div>
                            <div class="solution-stat-info">
                                <div class="solution-stat-value" id="nuvem-envios-percent">0%</div>
                                <div class="solution-stat-label">Nuvem Envios</div>
                            </div>
                            <!-- Nuvem Envios Tooltip -->
                            <div class="solution-stat-tooltip">
                                <div class="solution-tooltip-title">📦 Nuvem Envios</div>
                                <div class="solution-tooltip-desc">
                                    Logística integrada com fretes até 75% mais baratos. Correios, Jadlog, Loggi e muito mais.
                                </div>
                                <div class="solution-tooltip-stat">
                                    <span class="solution-tooltip-stat-label">Envios hoje:</span>
                                    <span class="solution-tooltip-stat-value" id="nuvem-envios-count">0</span>
                                </div>
                                <div class="solution-tooltip-stat">
                                    <span class="solution-tooltip-stat-label">Economia média:</span>
                                    <span class="solution-tooltip-stat-value">45% no frete</span>
                                </div>
                                <div class="solution-tooltip-highlight">
                                    Rastreio automático para o cliente
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sales Panel -->
                <div class="sales-panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Vendas Recentes
                        </div>
                    </div>
                    <div class="sales-list" id="sales-list"></div>
                </div>
            </div>
        </div>

        <!-- Game View -->
        <div class="view" id="view-game">
            <div class="game-view">
                <div class="game-container">
                    <!-- Nuvemshop Paddle (follows mouse inside game area) -->
                    <div class="game-paddle" id="game-paddle">
                        <div class="paddle-inner">
                            <img src="assets/nuvemshop-logo.png" alt="Nuvemshop" class="paddle-logo">
                        </div>
                    </div>

                    <div class="game-header">
                        <h2 class="game-title">🛒 Caça aos Carrinhos</h2>
                        <p class="game-subtitle">Mova o logo da Nuvemshop para recuperar os carrinhos abandonados!</p>
                    </div>

                    <!-- Side Counter Panel -->
                    <!-- Wave Indicator -->
                    <div class="wave-indicator" id="wave-indicator" style="display: none;">
                        <span>🌊 Onda</span>
                        <span class="wave-number" id="wave-number">1</span>
                    </div>
                    
                    <!-- Active Power-ups -->
                    <div class="active-powerups" id="active-powerups"></div>
                    
                    <div class="game-side-counter">
                        <div class="counter-card">
                            <div class="counter-title">Pontuação</div>
                            <div class="counter-main-value" id="game-score">0</div>
                            <div class="counter-sub">pontos</div>
                            <div class="lives-display" id="lives-display">
                                <span class="life-heart">❤️</span>
                                <span class="life-heart">❤️</span>
                                <span class="life-heart">❤️</span>
                            </div>
                        </div>
                        
                        <div class="counter-card combo-display">
                            <div class="combo-value" id="combo-value">0</div>
                            <div class="combo-label">Combo</div>
                            <div class="combo-multiplier" id="combo-multiplier">x1</div>
                        </div>
                        
                        <div class="counter-card">
                            <div class="counter-title">Estatísticas</div>
                            <div class="stats-row">
                                <span class="stats-row-label">Resgatados</span>
                                <span class="stats-row-value green" id="carts-rescued">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-row-label">Perdidos</span>
                                <span class="stats-row-value red" id="carts-lost">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-row-label">Taxa de Sucesso</span>
                                <span class="stats-row-value" id="success-rate">0%</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-row-label">Maior Combo</span>
                                <span class="stats-row-value" id="max-combo">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="leaderboard">
                        <div class="leaderboard-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22M18 2H6v7a6 6 0 1 0 12 0V2Z"/>
                            </svg>
                            Ranking Global
                            <span class="live-ranking-badge">
                                <span class="live-dot"></span>
                                LIVE
                            </span>
                        </div>
                        <div class="leaderboard-list" id="leaderboard-list">
                            <!-- Populated by JS -->
                        </div>
                        <button class="clear-ranking-btn" onclick="clearRankingHistory()">
                            🗑️ Limpar ranking
                        </button>
                    </div>

                    <div class="game-area" id="game-area">
                        <!-- Falling carts appear here -->
                        
                        <!-- Game Over Overlay -->
                        <div class="game-over-overlay" id="game-over-overlay">
                            <div class="game-over-card">
                                <div class="game-over-title">🎮 Fim de Jogo!</div>
                                <div class="game-over-wave">Você chegou na onda <span id="final-wave">1</span></div>
                                <div class="game-over-score" id="final-score">0</div>
                                <div style="font-size: 14px; color: var(--neutral-text-low);">pontos</div>
                                
                                <div class="game-over-stats">
                                    <div class="game-over-stat">
                                        <div class="game-over-stat-value" id="final-rescued">0</div>
                                        <div class="game-over-stat-label">Resgatados</div>
                                    </div>
                                    <div class="game-over-stat">
                                        <div class="game-over-stat-value" id="final-max-combo">0</div>
                                        <div class="game-over-stat-label">Maior Combo</div>
                                    </div>
                                    <div class="game-over-stat">
                                        <div class="game-over-stat-value" id="final-gmv">R$ 0</div>
                                        <div class="game-over-stat-label">GMV</div>
                                    </div>
                                </div>
                                
                                <!-- Ranking Form -->
                                <div class="ranking-form" id="ranking-form">
                                    <div class="ranking-form-title">🏆 Entre para o Ranking!</div>
                                    <input type="text" class="ranking-form-input" id="player-name" placeholder="Seu nome *" maxlength="30" required>
                                    <input type="email" class="ranking-form-input" id="player-email" placeholder="Seu email *" required>
                                    <input type="text" class="ranking-form-input" id="player-brand" placeholder="Nome da sua marca (opcional)" maxlength="40">
                                    <div class="ranking-form-error" id="ranking-error" style="display: none; color: #ff4444; font-size: 12px; margin-bottom: 10px; padding: 8px; background: rgba(255,68,68,0.1); border-radius: 6px;"></div>
                                    <button class="ranking-form-submit" id="ranking-submit" onclick="submitToRanking()">
                                        Salvar no Ranking
                                    </button>
                                    <button class="ranking-form-skip" onclick="skipRanking()">
                                        Pular e jogar novamente
                                    </button>
                                </div>
                                
                                <!-- Success message (hidden by default) -->
                                <div class="ranking-success" id="ranking-success" style="display: none;">
                                    ✅ Você foi adicionado ao ranking!
                                </div>
                                
                                <div class="game-over-buttons" id="game-over-buttons" style="display: none;">
                                    <button class="game-over-btn secondary" onclick="shareScore()">
                                        📤 Compartilhar
                                    </button>
                                    <button class="game-over-btn primary" onclick="playAgain()">
                                        🔄 Jogar Novamente
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Game Hint -->
                    <div class="game-hint" id="game-hint">
                        <span class="game-hint-icon">🖱️</span>
                        Mova o mouse para controlar o logo da Nuvemshop
                    </div>

                    <div class="game-instructions">
                        <div class="instructions-title">Como Jogar</div>
                        <ul class="instructions-list">
                            <li>
                                <span class="instruction-icon">🖱️</span>
                                Mova o mouse para controlar o logo
                            </li>
                            <li>
                                <span class="instruction-icon">💥</span>
                                Bata nos carrinhos para resgatá-los
                            </li>
                            <li>
                                <span class="instruction-icon">💣</span>
                                EVITE bombas! Têm borda vermelha e ⚠️
                            </li>
                            <li>
                                <span class="instruction-icon">❓</span>
                                Decoys parecem carrinhos mas revelam ❓ suspeito
                            </li>
                            <li>
                                <span class="instruction-icon">💖</span>
                                Colete corações para ganhar vidas extras!
                            </li>
                        </ul>
                    </div>

                    <div class="game-controls">
                        <button class="game-btn" id="game-start-btn" onclick="startGame()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                            Iniciar Jogo
                        </button>
                        <button class="game-btn secondary" onclick="resetGame()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="1 4 1 10 7 10"/>
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                            </svg>
                            Reiniciar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats View -->
        <div class="view" id="view-stats">
            <div class="stats-view">
                <div class="stats-grid">
                    <div class="stats-card large">
                        <div class="card-header">
                            <span class="card-title">GMV Anual 2025</span>
                            <span class="card-badge">+18.7% vs 2024</span>
                        </div>
                        <div class="big-number gradient" id="stats-gmv">R$ 0</div>
                        <div class="card-description">Volume total transacionado</div>
                        <div class="mini-chart" id="gmv-chart">
                            <!-- Bars added by JS -->
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-header">
                            <span class="card-title">Pedidos Totais</span>
                        </div>
                        <div class="big-number gradient" id="stats-orders">0</div>
                        <div class="card-description">Pedidos processados em 2025</div>
                    </div>

                    <div class="stats-card">
                        <div class="card-header">
                            <span class="card-title">Lojas Ativas</span>
                        </div>
                        <div class="big-number gradient">130.847</div>
                        <div class="card-description">Na plataforma Nuvemshop</div>
                    </div>

                    <div class="stats-card large">
                        <div class="card-header">
                            <span class="card-title">Vendas por Segmento</span>
                        </div>
                        <div class="segment-breakdown" id="segment-breakdown">
                            <!-- Added by JS -->
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="card-header">
                            <span class="card-title">Ticket Médio</span>
                        </div>
                        <div class="big-number gradient">R$ 187</div>
                        <div class="card-description">Valor médio por pedido</div>
                    </div>

                    <div class="stats-card">
                        <div class="card-header">
                            <span class="card-title">Taxa de Conversão</span>
                        </div>
                        <div class="big-number gradient">3.2%</div>
                        <div class="card-description">Visitantes → Compradores</div>
                    </div>

                    <div class="stats-card full">
                        <div class="card-header">
                            <span class="card-title">Volume por País</span>
                        </div>
                        <div style="display: flex; gap: 32px; margin-top: 16px;">
                            <div style="flex: 1;">
                                <div style="font-size: 24px; font-weight: 800; margin-bottom: 4px;">🇧🇷 Brasil</div>
                                <div style="font-size: 14px; color: var(--neutral-text-low);">68% do volume</div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 24px; font-weight: 800; margin-bottom: 4px;">🇦🇷 Argentina</div>
                                <div style="font-size: 14px; color: var(--neutral-text-low);">18% do volume</div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 24px; font-weight: 800; margin-bottom: 4px;">🇲🇽 México</div>
                                <div style="font-size: 14px; color: var(--neutral-text-low);">9% do volume</div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 24px; font-weight: 800; margin-bottom: 4px;">🌎 Outros</div>
                                <div style="font-size: 14px; color: var(--neutral-text-low);">5% do volume</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settings-panel">
            <div class="settings-title">Configurações</div>
            
            <div class="settings-section">
                <div class="settings-section-title">Visualização</div>
                <div class="settings-option">
                    <span class="settings-label">Sons</span>
                    <div class="toggle active" id="toggle-sound" onclick="this.classList.toggle('active')"></div>
                </div>
                <div class="settings-option">
                    <span class="settings-label">Partículas</span>
                    <div class="toggle active" id="toggle-particles" onclick="toggleParticles()"></div>
                </div>
                <div class="settings-option">
                    <span class="settings-label">Rotação automática</span>
                    <div class="toggle active" id="toggle-rotation" onclick="toggleRotation()"></div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">Dados</div>
                <div class="settings-option">
                    <span class="settings-label">Atualização em tempo real</span>
                    <div class="toggle active"></div>
                </div>
                <div class="settings-option">
                    <span class="settings-label">Mostrar valores</span>
                    <div class="toggle active"></div>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <button class="mobile-nav-item active" data-view="globe" onclick="switchView('globe')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M2 12h20"/>
                </svg>
                Brasil
            </button>
            <button class="mobile-nav-item" data-view="game" onclick="switchView('game')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="6" width="20" height="12" rx="2"/>
                    <circle cx="8" cy="12" r="2"/>
                </svg>
                Jogo
            </button>
            <button class="mobile-nav-item" data-view="stats" onclick="switchView('stats')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 20V10M12 20V4M6 20v-6"/>
                </svg>
                Stats
            </button>
        </nav>
    </div>

    <script>
        // ============================================
        // CONFIGURATION & DATA
        // ============================================
        const CONFIG = {
            segments: {
                moda: { name: 'Moda', color: '#e91e63', emoji: '👗', products: ['Vestido Midi', 'Camiseta Premium', 'Jaqueta Couro', 'Calça Jeans', 'Sapato Social'], percent: 32 },
                eletronicos: { name: 'Eletrônicos', color: '#2196f3', emoji: '📱', products: ['Smartphone 5G', 'Notebook Gamer', 'Fone Bluetooth', 'Smartwatch', 'Console Games'], percent: 24 },
                casa: { name: 'Casa & Decoração', color: '#ff9800', emoji: '🏠', products: ['Luminária Design', 'Sofá 3 Lugares', 'Panela Elétrica', 'Jogo de Cama', 'Cortina Blackout'], percent: 15 },
                beleza: { name: 'Beleza', color: '#9c27b0', emoji: '💄', products: ['Kit Skincare', 'Perfume Importado', 'Maquiagem Pro', 'Secador Ionic', 'Creme Facial'], percent: 12 },
                alimentos: { name: 'Alimentos', color: '#4caf50', emoji: '🍫', products: ['Chocolate Belga', 'Vinho Reserva', 'Café Gourmet', 'Kit Churrasco', 'Doces Artesanais'], percent: 10 },
                esportes: { name: 'Esportes', color: '#00bcd4', emoji: '⚽', products: ['Tênis Running', 'Bicicleta MTB', 'Kit Yoga', 'Halteres Pro', 'Suplemento Whey'], percent: 7 }
            },
            // NEW: Sales Channels (5 channels with distinct colors)
            channels: {
                online: { name: 'Loja Online', icon: '🛒', color: '#2196f3', percent: 50 },
                chat: { name: 'Nuvemchat', icon: '💬', color: '#4caf50', percent: 20 },
                pos: { name: 'Loja Física', icon: '🏪', color: '#ff9800', percent: 15 },
                social: { name: 'Redes Sociais', icon: '📱', color: '#e91e63', percent: 15 }
            },
            // NEW: Store names for first sale celebration
            storeNames: [
                'Moda Elegance', 'TechStore BR', 'Beauty Box', 'Casa Decor', 'Pet Paradise',
                'Sabor Artesanal', 'Fit Life', 'Kids World', 'Urban Style', 'Eco Shop',
                'Jardim Verde', 'Gourmet Café', 'Esportes Pro', 'Arte & Design', 'Bem Estar',
                'Doceria Maria', 'Auto Peças JL', 'Livraria Cultural', 'Joias Brilho', 'Ótica Vision'
            ],
            // Brazilian States Data
            states: {
                'AC': { name: 'Acre', capital: 'Rio Branco', gmv: 89000000, orders: 42000, stores: 890, ticket: 156, region: 'Norte' },
                'AL': { name: 'Alagoas', capital: 'Maceió', gmv: 245000000, orders: 128000, stores: 1890, ticket: 168, region: 'Nordeste' },
                'AP': { name: 'Amapá', capital: 'Macapá', gmv: 67000000, orders: 31000, stores: 520, ticket: 152, region: 'Norte' },
                'AM': { name: 'Amazonas', capital: 'Manaus', gmv: 520000000, orders: 285000, stores: 3200, ticket: 175, region: 'Norte' },
                'BA': { name: 'Bahia', capital: 'Salvador', gmv: 1850000000, orders: 980000, stores: 12400, ticket: 178, region: 'Nordeste' },
                'CE': { name: 'Ceará', capital: 'Fortaleza', gmv: 1120000000, orders: 620000, stores: 8900, ticket: 176, region: 'Nordeste' },
                'DF': { name: 'Distrito Federal', capital: 'Brasília', gmv: 1450000000, orders: 780000, stores: 6800, ticket: 195, region: 'Centro-Oeste' },
                'ES': { name: 'Espírito Santo', capital: 'Vitória', gmv: 890000000, orders: 485000, stores: 5200, ticket: 182, region: 'Sudeste' },
                'GO': { name: 'Goiás', capital: 'Goiânia', gmv: 1080000000, orders: 590000, stores: 7200, ticket: 181, region: 'Centro-Oeste' },
                'MA': { name: 'Maranhão', capital: 'São Luís', gmv: 380000000, orders: 198000, stores: 2800, ticket: 165, region: 'Nordeste' },
                'MT': { name: 'Mato Grosso', capital: 'Cuiabá', gmv: 620000000, orders: 340000, stores: 4100, ticket: 183, region: 'Centro-Oeste' },
                'MS': { name: 'Mato Grosso do Sul', capital: 'Campo Grande', gmv: 480000000, orders: 265000, stores: 3200, ticket: 180, region: 'Centro-Oeste' },
                'MG': { name: 'Minas Gerais', capital: 'Belo Horizonte', gmv: 3200000000, orders: 1720000, stores: 18500, ticket: 184, region: 'Sudeste' },
                'PA': { name: 'Pará', capital: 'Belém', gmv: 580000000, orders: 310000, stores: 4200, ticket: 172, region: 'Norte' },
                'PB': { name: 'Paraíba', capital: 'João Pessoa', gmv: 320000000, orders: 175000, stores: 2600, ticket: 170, region: 'Nordeste' },
                'PR': { name: 'Paraná', capital: 'Curitiba', gmv: 2100000000, orders: 1150000, stores: 12800, ticket: 186, region: 'Sul' },
                'PE': { name: 'Pernambuco', capital: 'Recife', gmv: 1280000000, orders: 695000, stores: 9200, ticket: 177, region: 'Nordeste' },
                'PI': { name: 'Piauí', capital: 'Teresina', gmv: 198000000, orders: 108000, stores: 1650, ticket: 164, region: 'Nordeste' },
                'RJ': { name: 'Rio de Janeiro', capital: 'Rio de Janeiro', gmv: 4200000000, orders: 2280000, stores: 22000, ticket: 189, region: 'Sudeste' },
                'RN': { name: 'Rio Grande do Norte', capital: 'Natal', gmv: 380000000, orders: 205000, stores: 2900, ticket: 173, region: 'Nordeste' },
                'RS': { name: 'Rio Grande do Sul', capital: 'Porto Alegre', gmv: 1950000000, orders: 1060000, stores: 11500, ticket: 185, region: 'Sul' },
                'RO': { name: 'Rondônia', capital: 'Porto Velho', gmv: 245000000, orders: 135000, stores: 1800, ticket: 171, region: 'Norte' },
                'RR': { name: 'Roraima', capital: 'Boa Vista', gmv: 52000000, orders: 28000, stores: 420, ticket: 158, region: 'Norte' },
                'SC': { name: 'Santa Catarina', capital: 'Florianópolis', gmv: 1680000000, orders: 920000, stores: 10200, ticket: 187, region: 'Sul' },
                'SP': { name: 'São Paulo', capital: 'São Paulo', gmv: 8500000000, orders: 4600000, stores: 45000, ticket: 192, region: 'Sudeste' },
                'SE': { name: 'Sergipe', capital: 'Aracaju', gmv: 178000000, orders: 98000, stores: 1450, ticket: 169, region: 'Nordeste' },
                'TO': { name: 'Tocantins', capital: 'Palmas', gmv: 145000000, orders: 78000, stores: 1100, ticket: 167, region: 'Norte' }
            },
            // Brazilian Cities with lat/lng for 3D globe
            cities: [
                // Sudeste
                { name: 'São Paulo', state: 'SP', capital: true, lat: -23.5505, lng: -46.6333, orders: 4600000, gmv: 8500000000, stores: 45000, ticket: 192, topSegments: ['moda', 'eletronicos', 'beleza'] },
                { name: 'Rio de Janeiro', state: 'RJ', capital: true, lat: -22.9068, lng: -43.1729, orders: 2280000, gmv: 4200000000, stores: 22000, ticket: 189, topSegments: ['moda', 'beleza', 'casa'] },
                { name: 'Belo Horizonte', state: 'MG', capital: true, lat: -19.9167, lng: -43.9345, orders: 1720000, gmv: 3200000000, stores: 18500, ticket: 184, topSegments: ['moda', 'casa', 'alimentos'] },
                { name: 'Vitória', state: 'ES', capital: true, lat: -20.3155, lng: -40.3128, orders: 485000, gmv: 890000000, stores: 5200, ticket: 182, topSegments: ['moda', 'casa', 'eletronicos'] },
                // Sul
                { name: 'Curitiba', state: 'PR', capital: true, lat: -25.4290, lng: -49.2671, orders: 1150000, gmv: 2100000000, stores: 12800, ticket: 186, topSegments: ['moda', 'eletronicos', 'esportes'] },
                { name: 'Florianópolis', state: 'SC', capital: true, lat: -27.5954, lng: -48.5480, orders: 920000, gmv: 1680000000, stores: 10200, ticket: 187, topSegments: ['moda', 'esportes', 'beleza'] },
                { name: 'Porto Alegre', state: 'RS', capital: true, lat: -30.0346, lng: -51.2177, orders: 1060000, gmv: 1950000000, stores: 11500, ticket: 185, topSegments: ['moda', 'esportes', 'casa'] },
                // Centro-Oeste
                { name: 'Brasília', state: 'DF', capital: true, lat: -15.7942, lng: -47.8822, orders: 780000, gmv: 1450000000, stores: 6800, ticket: 195, topSegments: ['moda', 'eletronicos', 'casa'] },
                { name: 'Goiânia', state: 'GO', capital: true, lat: -16.6869, lng: -49.2648, orders: 590000, gmv: 1080000000, stores: 7200, ticket: 181, topSegments: ['moda', 'alimentos', 'casa'] },
                { name: 'Cuiabá', state: 'MT', capital: true, lat: -15.6014, lng: -56.0979, orders: 340000, gmv: 620000000, stores: 4100, ticket: 183, topSegments: ['agro', 'moda', 'casa'] },
                { name: 'Campo Grande', state: 'MS', capital: true, lat: -20.4697, lng: -54.6201, orders: 265000, gmv: 480000000, stores: 3200, ticket: 180, topSegments: ['agro', 'moda', 'alimentos'] },
                // Nordeste
                { name: 'Salvador', state: 'BA', capital: true, lat: -12.9714, lng: -38.5014, orders: 980000, gmv: 1850000000, stores: 12400, ticket: 178, topSegments: ['moda', 'beleza', 'alimentos'] },
                { name: 'Fortaleza', state: 'CE', capital: true, lat: -3.7172, lng: -38.5433, orders: 620000, gmv: 1120000000, stores: 8900, ticket: 176, topSegments: ['moda', 'beleza', 'casa'] },
                { name: 'Recife', state: 'PE', capital: true, lat: -8.0476, lng: -34.8770, orders: 695000, gmv: 1280000000, stores: 9200, ticket: 177, topSegments: ['moda', 'beleza', 'alimentos'] },
                { name: 'Natal', state: 'RN', capital: true, lat: -5.7945, lng: -35.2110, orders: 205000, gmv: 380000000, stores: 2900, ticket: 173, topSegments: ['moda', 'beleza', 'casa'] },
                { name: 'João Pessoa', state: 'PB', capital: true, lat: -7.1195, lng: -34.8450, orders: 175000, gmv: 320000000, stores: 2600, ticket: 170, topSegments: ['moda', 'beleza', 'alimentos'] },
                { name: 'Maceió', state: 'AL', capital: true, lat: -9.6658, lng: -35.7350, orders: 128000, gmv: 245000000, stores: 1890, ticket: 168, topSegments: ['moda', 'beleza', 'alimentos'] },
                { name: 'Aracaju', state: 'SE', capital: true, lat: -10.9472, lng: -37.0731, orders: 98000, gmv: 178000000, stores: 1450, ticket: 169, topSegments: ['moda', 'beleza', 'alimentos'] },
                { name: 'Teresina', state: 'PI', capital: true, lat: -5.0892, lng: -42.8016, orders: 108000, gmv: 198000000, stores: 1650, ticket: 164, topSegments: ['moda', 'alimentos', 'casa'] },
                { name: 'São Luís', state: 'MA', capital: true, lat: -2.5307, lng: -44.3068, orders: 198000, gmv: 380000000, stores: 2800, ticket: 165, topSegments: ['moda', 'alimentos', 'beleza'] },
                // Norte
                { name: 'Manaus', state: 'AM', capital: true, lat: -3.1190, lng: -60.0217, orders: 285000, gmv: 520000000, stores: 3200, ticket: 175, topSegments: ['eletronicos', 'moda', 'casa'] },
                { name: 'Belém', state: 'PA', capital: true, lat: -1.4558, lng: -48.4902, orders: 310000, gmv: 580000000, stores: 4200, ticket: 172, topSegments: ['moda', 'eletronicos', 'alimentos'] },
                { name: 'Porto Velho', state: 'RO', capital: true, lat: -8.7612, lng: -63.9039, orders: 135000, gmv: 245000000, stores: 1800, ticket: 171, topSegments: ['agro', 'moda', 'casa'] },
                { name: 'Rio Branco', state: 'AC', capital: true, lat: -9.9754, lng: -67.8249, orders: 42000, gmv: 89000000, stores: 890, ticket: 156, topSegments: ['moda', 'alimentos', 'casa'] },
                { name: 'Macapá', state: 'AP', capital: true, lat: 0.0356, lng: -51.0705, orders: 31000, gmv: 67000000, stores: 520, ticket: 152, topSegments: ['moda', 'eletronicos', 'alimentos'] },
                { name: 'Boa Vista', state: 'RR', capital: true, lat: 2.8235, lng: -60.6758, orders: 28000, gmv: 52000000, stores: 420, ticket: 158, topSegments: ['moda', 'alimentos', 'casa'] },
                { name: 'Palmas', state: 'TO', capital: true, lat: -10.2491, lng: -48.3243, orders: 78000, gmv: 145000000, stores: 1100, ticket: 167, topSegments: ['agro', 'moda', 'casa'] }
            ],
            // Brazilian names for human moments
            brazilianNames: {
                firstNames: [
                    'Ana', 'Carlos', 'Julia', 'Roberto', 'Maria', 'João', 'Fernanda', 'Pedro',
                    'Mariana', 'Lucas', 'Beatriz', 'Rafael', 'Gabriela', 'Felipe', 'Isabella',
                    'Thiago', 'Larissa', 'Bruno', 'Camila', 'Gustavo', 'Amanda', 'Rodrigo',
                    'Juliana', 'André', 'Patricia', 'Marcos', 'Vanessa', 'Diego', 'Renata',
                    'Ricardo', 'Carolina', 'Leonardo', 'Priscila', 'Eduardo', 'Tatiana', 'Paulo',
                    'Daniela', 'Vinicius', 'Adriana', 'Fábio', 'Cristina', 'Alexandre', 'Monica'
                ],
                lastNames: [
                    'Silva', 'Santos', 'Oliveira', 'Souza', 'Rodrigues', 'Ferreira', 'Alves',
                    'Pereira', 'Lima', 'Gomes', 'Ribeiro', 'Carvalho', 'Almeida', 'Costa',
                    'Martins', 'Araújo', 'Mendes', 'Barbosa', 'Rocha', 'Nascimento', 'Moreira',
                    'Fernandes', 'Dias', 'Monteiro', 'Cardoso', 'Teixeira', 'Machado', 'Freitas',
                    'Cavalcanti', 'Ramos', 'Reis', 'Nunes', 'Moraes', 'Azevedo', 'Correia'
                ]
            },
            // Human moments & emotional stories
            humanMoments: [
                { 
                    type: 'milestone',
                    templates: [
                        'Primeira venda do mês! 🎯',
                        'Meta de R$ {value} atingida! 🏆',
                        'Cliente fiel retorna! 💚',
                        'Venda especial de aniversário! 🎂',
                        'Marca histórica alcançada! 📈',
                        '100ª venda da loja! 💯'
                    ]
                },
                {
                    type: 'journey',
                    templates: [
                        'Jornada completa: pesquisa → compra em {time}min',
                        'Cliente visitou {visits}x antes de comprar',
                        'Abandonou carrinho, retornou e comprou! 🔄',
                        'Do Instagram direto pro checkout! 📱',
                        'Indicação de amigo! 👯'
                    ]
                },
                {
                    type: 'emotion',
                    templates: [
                        'Presente para alguém especial 💝',
                        'Realizando um sonho! ✨',
                        'Compra planejada há semanas 📅',
                        'Decisão espontânea que valeu a pena! 🎲',
                        'Autocuidado merecido! 💆',
                        'Presente pra si mesmo! 🎁'
                    ]
                },
                {
                    type: 'local',
                    templates: [
                        'De {city} para todo Brasil 🇧🇷',
                        'Pequeno negócio, grande sonho! 🌟',
                        'Família brasileira comprando junto 👨‍👩‍👧‍👦',
                        'Apoiando comércio local! 🏪',
                        'Empreendedor raiz! 🌱',
                        'Negócio de família! 👨‍👩‍👧'
                    ]
                },
                {
                    type: 'celebration',
                    templates: [
                        'Eita, vendeu! 🎉',
                        'Vai Brasil! 🇧🇷',
                        'É gol! É venda! ⚽',
                        'Sextou com estilo! 🎊',
                        'Partiu sucesso! 🚀',
                        'Tá voando! ✈️',
                        'Que orgulho! 🏆'
                    ]
                },
                {
                    type: 'regional',
                    templates: [
                        'Ô coisa boa, sô! (MG) 🫘',
                        'Bah, tchê! Vendeu! (RS) 🧉',
                        'Oxe, arretado! (NE) 🌴',
                        'Mó legal! (SP) 🏙️',
                        'Show de bola! (RJ) 🏖️',
                        'Égua, mano! (PA) 🌳',
                        'Uai, deu bom! (GO) 🌾',
                        'Massa demais! (PE) 🎭',
                        'Muito bom, visse! (CE) ☀️'
                    ]
                },
                {
                    type: 'timing',
                    templates: [
                        'Venda noturna! 🌙',
                        'Madrugada produtiva! ⭐',
                        'Almoço com lucro! 🍽️',
                        'Happy hour de vendas! 🍻'
                    ]
                }
            ],
            // Regional cultural references
            // Regional Icons by region (legacy support)
            regionalIcons: {
                'Sudeste': '🏙️',
                'Sul': '🌲',
                'Nordeste': '🌴',
                'Norte': '🌳',
                'Centro-Oeste': '🌾'
            },
            // State-specific cultural data (expanded local identity)
            stateIcons: {
                // Sudeste (cores das bandeiras: SP=vermelho/branco/preto, RJ=azul/branco, MG=vermelho/branco/verde, ES=azul/rosa/branco)
                'SP': { icon: '🏙️', flag: '🔴⚪⚫', food: '🍕', drink: '☕', culture: 'Paulistano', greeting: 'E aí, mano!' },
                'RJ': { icon: '🏖️', flag: '🔵⚪🟡', food: '🥤', drink: '🍻', culture: 'Carioca', greeting: 'E aí, parceiro!' },
                'MG': { icon: '⛰️', flag: '🔴⚪🟢', food: '🫘', drink: '☕', culture: 'Mineiro', greeting: 'Ô coisa boa, sô!' },
                'ES': { icon: '🌊', flag: '🔵🩷⚪', food: '🦐', drink: '🍹', culture: 'Capixaba', greeting: 'Beleza, irmão?' },
                // Sul (RS=verde/vermelho/amarelo, SC=verde/branco/vermelho, PR=verde/branco/azul)
                'RS': { icon: '🧉', flag: '🟢🔴🟡', food: '🥩', drink: '🍷', culture: 'Gaúcho', greeting: 'Bah, tchê!' },
                'SC': { icon: '🏔️', flag: '🟢⚪🔴', food: '🦪', drink: '🍺', culture: 'Catarinense', greeting: 'Opa, bom dia!' },
                'PR': { icon: '🌲', flag: '🟢⚪🔵', food: '🫒', drink: '☕', culture: 'Paranaense', greeting: 'E aí, como vai?' },
                // Nordeste
                'BA': { icon: '🥁', flag: '🔴⚪🔵', food: '🍲', drink: '🥥', culture: 'Baiano', greeting: 'Ôxe, meu rei!' },
                'PE': { icon: '🎭', flag: '🔵⚪🌈', food: '🍰', drink: '🍹', culture: 'Pernambucano', greeting: 'Oxente, visse!' },
                'CE': { icon: '☀️', flag: '🟢🟡⚪', food: '🦐', drink: '🥥', culture: 'Cearense', greeting: 'Macho, arretado!' },
                'RN': { icon: '🏜️', flag: '🟢⚪🔴', food: '🦀', drink: '🧃', culture: 'Potiguar', greeting: 'Eita, cabra!' },
                'PB': { icon: '🌅', flag: '🔴⚫🟡', food: '🍖', drink: '🥤', culture: 'Paraibano', greeting: 'E aê, cabra!' },
                'AL': { icon: '🌴', flag: '🔵⚪🔴', food: '🐟', drink: '🥥', culture: 'Alagoano', greeting: 'Oxe, bom demais!' },
                'SE': { icon: '🎶', flag: '🔵🟢⚪', food: '🦐', drink: '🍹', culture: 'Sergipano', greeting: 'Boa tarde, viu!' },
                'PI': { icon: '🌵', flag: '🟢🟡🔵', food: '🍖', drink: '🧃', culture: 'Piauiense', greeting: 'Oxe, danado!' },
                'MA': { icon: '🏛️', flag: '🔴⚪⚫', food: '🦀', drink: '🍻', culture: 'Maranhense', greeting: 'Égua, meu fi!' },
                // Norte
                'AM': { icon: '🌳', flag: '🔴⚪🔵', food: '🐟', drink: '🍹', culture: 'Amazonense', greeting: 'Maninho, tudo bem?' },
                'PA': { icon: '🌴', flag: '🔵⚪🔴', food: '🥭', drink: '🧃', culture: 'Paraense', greeting: 'Égua, mano!' },
                'RO': { icon: '🌿', flag: '🟢🔵🟡', food: '🐟', drink: '🥤', culture: 'Rondoniense', greeting: 'E aí, parceiro!' },
                'AC': { icon: '🌲', flag: '🟢🟡🔴', food: '🍖', drink: '🧃', culture: 'Acreano', greeting: 'Oi, compadre!' },
                'AP': { icon: '🏝️', flag: '🔵🟢⚪', food: '🦐', drink: '🥥', culture: 'Amapaense', greeting: 'E aí, mano!' },
                'RR': { icon: '⛰️', flag: '🟢⚪🔵', food: '🐟', drink: '🍹', culture: 'Roraimense', greeting: 'Tudo bem, irmão?' },
                'TO': { icon: '🌾', flag: '🔵🟡⚪', food: '🍖', drink: '🥤', culture: 'Tocantinense', greeting: 'Opa, beleza?' },
                // Centro-Oeste
                'GO': { icon: '🌾', flag: '🟢🟡🔵', food: '🌽', drink: '🍻', culture: 'Goiano', greeting: 'Uai, tudo bom?' },
                'MT': { icon: '🐊', flag: '🔵🟢⚪', food: '🐄', drink: '🧃', culture: 'Mato-Grossense', greeting: 'E aí, parceiro!' },
                'MS': { icon: '🦜', flag: '🟢⚪🔵', food: '🥩', drink: '🧉', culture: 'Sul-Mato-Grossense', greeting: 'Tchê, como vai?' },
                'DF': { icon: '🏛️', flag: '⚪🟢🟡', food: '🍖', drink: '☕', culture: 'Candango', greeting: 'Beleza, véi?' }
            },
            leaderboard: [
                { name: 'Ana Silva', store: 'Moda Elegance', score: 15420 },
                { name: 'Carlos Mendes', store: 'TechStore BR', score: 12350 },
                { name: 'Julia Santos', store: 'Beauty Box', score: 11890 },
                { name: 'Roberto Lima', store: 'Casa Decor', score: 9540 },
                { name: 'Maria Oliveira', store: 'Pet Paradise', score: 8720 }
            ]
        };

        // ============================================
        // STATE
        // ============================================
        let state = {
            currentView: 'globe',
            currentSegment: 'all',
            currentChannel: 'all', // NEW: all, online, chat, pos
            soundEnabled: true,
            particlesEnabled: true,
            rotationEnabled: true,
            settingsOpen: false,
            
            // Stats
            gmv: 28547832156, // R$ 28.5 bilhões (starting value)
            gmvPerSecond: 45000, // R$ 45.000 por segundo (média)
            gmvLastUpdate: Date.now(),
            totalOrders: 145678432,
            ordersPerMinute: 847,
            activeStores: 130847,
            avgTicket: 187,
            
            // NEW: Channel & Solutions Stats
            firstSalesToday: 47, // Primeiras vendas hoje
            nuvemPayCount: 0,
            nuvemEnviosCount: 0,
            totalSalesTracked: 0,
            channelCounts: { online: 0, chat: 0, pos: 0, social: 0 },
            
            // Game
            gameRunning: false,
            gameScore: 0,
            cartsRescued: 0,
            cartsLost: 0,
            gameInterval: null,
            fallingCarts: [],
            
            // Globe interaction
            isDragging: false,
            selectedCity: null,
            tooltipVisible: false,
            controlsHintShown: true,
            autoRotateSpeed: 0.001
        };

        // ============================================
        // UTILITIES
        // ============================================
        function formatCurrency(value) {
            if (value >= 1000000000) {
                return 'R$ ' + (value / 1000000000).toFixed(1) + ' bi';
            }
            if (value >= 1000000) {
                return 'R$ ' + (value / 1000000).toFixed(1) + ' mi';
            }
            return 'R$ ' + value.toLocaleString('pt-BR');
        }

        // Format GMV as full number with dots (xx.xxx.xxx.xxx)
        function formatGMV(value) {
            return Math.floor(value).toLocaleString('pt-BR');
        }

        // Format currency for per-second display
        function formatPerSecond(value) {
            if (value >= 1000000) {
                return 'R$ ' + (value / 1000000).toFixed(1) + 'M/segundo';
            }
            if (value >= 1000) {
                return 'R$ ' + (value / 1000).toFixed(0) + 'K/segundo';
            }
            return 'R$ ' + Math.floor(value).toLocaleString('pt-BR') + '/segundo';
        }

        function formatNumber(value) {
            if (value >= 1000000000) {
                return (value / 1000000000).toFixed(2) + 'B';
            }
            if (value >= 1000000) {
                return (value / 1000000).toFixed(1) + 'M';
            }
            if (value >= 1000) {
                return (value / 1000).toFixed(1) + 'K';
            }
            return value.toLocaleString('pt-BR');
        }

        function animateValue(element, start, end, duration, formatter) {
            const startTime = performance.now();
            const update = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                const current = start + (end - start) * eased;
                element.textContent = formatter ? formatter(Math.floor(current)) : Math.floor(current);
                if (progress < 1) requestAnimationFrame(update);
            };
            requestAnimationFrame(update);
        }

        // ============================================
        // NAVIGATION
        // ============================================
        function switchView(viewId) {
            state.currentView = viewId;
            
            // Update nav items
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.view === viewId);
            });
            
            // Update views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.toggle('active', view.id === `view-${viewId}`);
            });
            
            // Start/stop global ranking updates based on view
            if (viewId === 'game') {
                startGlobalRankingUpdates();
            } else {
                stopGlobalRankingUpdates();
            }
            
            // Stop game if switching away
            if (viewId !== 'game' && state.gameRunning) {
                pauseGame();
            }
        }

        function toggleSettings() {
            state.settingsOpen = !state.settingsOpen;
            document.getElementById('settings-panel').classList.toggle('open', state.settingsOpen);
            document.getElementById('settings-toggle').classList.toggle('active', state.settingsOpen);
        }

        function toggleSound() {
            state.soundEnabled = !state.soundEnabled;
            document.getElementById('sound-toggle').classList.toggle('active', state.soundEnabled);
        }

        function toggleParticles() {
            state.particlesEnabled = !state.particlesEnabled;
            document.getElementById('particles').style.display = state.particlesEnabled ? 'block' : 'none';
            document.getElementById('toggle-particles').classList.toggle('active', state.particlesEnabled);
        }

        function toggleRotation() {
            state.rotationEnabled = !state.rotationEnabled;
            document.getElementById('toggle-rotation').classList.toggle('active', state.rotationEnabled);
            if (controls) {
                controls.autoRotate = state.rotationEnabled;
            }
        }

        // ============================================
        // SHARE FUNCTIONALITY (Brand & Emotion)
        // ============================================
        function sharePage() {
            const shareData = {
                title: 'Nuvemshop Live | E-commerce do Brasil ao Vivo',
                text: `Acompanhe o e-commerce brasileiro em tempo real! R$ ${formatGMV(state.gmv)} em vendas e ${formatNumber(state.totalOrders)} pedidos. 🇧🇷`,
                url: window.location.href
            };

            // Try Web Share API first (mobile)
            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => {
                        showShareFeedback(true);
                    })
                    .catch(() => {
                        fallbackShare();
                    });
            } else {
                fallbackShare();
            }
        }

        function fallbackShare() {
            // Copy to clipboard
            const text = `Nuvemshop Live | E-commerce do Brasil ao Vivo\n${window.location.href}\n\nAcompanhe o e-commerce brasileiro em tempo real! 🇧🇷`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showShareFeedback(true);
                    })
                    .catch(() => {
                        showShareFeedback(false);
                    });
            } else {
                // Fallback: create temporary textarea
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showShareFeedback(true);
                } catch (err) {
                    showShareFeedback(false);
                }
                document.body.removeChild(textarea);
            }
        }

        function showShareFeedback(success) {
            const shareBtn = document.getElementById('share-btn');
            if (success) {
                shareBtn.classList.add('shared');
                setTimeout(() => {
                    shareBtn.classList.remove('shared');
                }, 2000);
            }
        }

        // ============================================
        // SEGMENT FILTERING
        // ============================================
        function filterSegment(segment) {
            state.currentSegment = segment;
            document.querySelectorAll('.segment-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.segment === segment);
            });
        }

        // ============================================
        // STATS UPDATE
        // ============================================
        // Real-time GMV counter (updates every 50ms)
        function updateGMVRealtime() {
            const now = Date.now();
            const elapsed = (now - state.gmvLastUpdate) / 1000; // seconds
            
            // Add GMV based on time elapsed
            const gmvToAdd = state.gmvPerSecond * elapsed;
            state.gmv += gmvToAdd;
            state.gmvLastUpdate = now;
            
            // Update GMV display with full number format
            const gmvCounter = document.getElementById('gmv-counter');
            if (gmvCounter) {
                gmvCounter.textContent = formatGMV(state.gmv);
            }
            
            // Update mobile GMV counter
            const mobileGmvCounter = document.getElementById('mobile-gmv-counter');
            if (mobileGmvCounter) {
                mobileGmvCounter.textContent = formatGMV(state.gmv);
            }
            
            // Update per-second indicator (with some variation)
            const perSecond = document.getElementById('gmv-per-second');
            if (perSecond) {
                const variation = 0.8 + Math.random() * 0.4; // 80% to 120%
                const currentRate = state.gmvPerSecond * variation;
                perSecond.textContent = formatPerSecond(currentRate);
            }
        }

        // Toggle mobile GMV expanded/collapsed
        function toggleMobileGmv() {
            const mobileGmv = document.getElementById('mobile-gmv');
            if (mobileGmv) {
                mobileGmv.classList.toggle('expanded');
            }
        }

        function updateStats() {
            // Update orders and other stats
            state.totalOrders += Math.floor(Math.random() * 15) + 5;
            state.ordersPerMinute = 800 + Math.floor(Math.random() * 200);
            
            // Vary the GMV per second slightly
            state.gmvPerSecond = 40000 + Math.floor(Math.random() * 15000);
            
            // Update displays
            document.getElementById('total-orders').textContent = formatNumber(state.totalOrders);
            document.getElementById('orders-per-minute').textContent = state.ordersPerMinute;
            document.getElementById('active-stores').textContent = formatNumber(state.activeStores);
            document.getElementById('avg-ticket').textContent = 'R$ ' + state.avgTicket;
            
            // Stats view
            document.getElementById('stats-gmv').textContent = formatCurrency(state.gmv);
            document.getElementById('stats-orders').textContent = formatNumber(state.totalOrders);
            
            // Mobile stats (collapsible)
            const mobileOrders = document.getElementById('mobile-orders');
            const mobileStores = document.getElementById('mobile-stores');
            const mobileTicket = document.getElementById('mobile-ticket');
            const mobilePerSec = document.getElementById('mobile-per-sec');
            
            if (mobileOrders) mobileOrders.textContent = formatNumber(state.totalOrders);
            if (mobileStores) mobileStores.textContent = formatNumber(state.activeStores);
            if (mobileTicket) mobileTicket.textContent = 'R$ ' + state.avgTicket;
            if (mobilePerSec) mobilePerSec.textContent = formatPerSecond(state.gmvPerSecond);
        }

        // ============================================
        // SALES FEED
        // ============================================
        const salesList = document.getElementById('sales-list');
        const maxSales = 20;

        function getRandomSegment() {
            const segments = Object.keys(CONFIG.segments);
            if (state.currentSegment !== 'all') {
                return state.currentSegment;
            }
            // Weighted random based on percent
            const rand = Math.random() * 100;
            let cumulative = 0;
            for (const key of segments) {
                cumulative += CONFIG.segments[key].percent;
                if (rand <= cumulative) return key;
            }
            return segments[0];
        }

        // NEW: Get random channel based on weights
        function getRandomChannel() {
            const channels = Object.keys(CONFIG.channels);
            if (state.currentChannel !== 'all') {
                return state.currentChannel;
            }
            const rand = Math.random() * 100;
            let cumulative = 0;
            for (const key of channels) {
                cumulative += CONFIG.channels[key].percent;
                if (rand <= cumulative) return key;
            }
            return channels[0];
        }

        // NEW: Filter by channel
        function filterChannel(channel) {
            state.currentChannel = channel;
            
            // Update active tab
            document.querySelectorAll('.channel-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.channel === channel);
            });
            
            // Filter sales list
            const salesItems = document.querySelectorAll('.sale-item');
            salesItems.forEach(item => {
                if (channel === 'all') {
                    item.style.display = '';
                } else {
                    // Check if item has the channel class
                    const hasChannel = item.classList.contains('channel-' + channel);
                    item.style.display = hasChannel ? '' : 'none';
                }
            });
        }

        // NEW: Create confetti for first sale celebration
        function createConfetti() {
            const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96c93d', '#f39c12'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                
                // Animate falling
                const duration = 2000 + Math.random() * 2000;
                const endX = (Math.random() - 0.5) * 200;
                confetti.animate([
                    { transform: `translateY(0) translateX(0) rotate(0deg)`, opacity: 1 },
                    { transform: `translateY(100vh) translateX(${endX}px) rotate(${360 + Math.random() * 360}deg)`, opacity: 0 }
                ], { duration, easing: 'ease-out' });
                
                setTimeout(() => confetti.remove(), duration);
            }
        }

        // NEW: Show first sale celebration
        function showFirstSaleCelebration(storeName, cityName, stateName) {
            const celebration = document.getElementById('first-sale-celebration');
            document.getElementById('celebration-store').textContent = storeName;
            document.getElementById('celebration-location').textContent = `${cityName}, ${stateName}`;
            
            // Get state-specific icon and greeting
            const stateIcon = CONFIG.stateIcons[stateName] || {};
            const regionalIcon = stateIcon.icon || '🏙️';
            const regionalGreeting = stateIcon.greeting || 'Parabéns, empreendedor!';
            
            document.getElementById('celebration-regional-icon').textContent = regionalIcon;
            
            celebration.classList.add('active');
            createConfetti();
            
            // Store current celebration data for sharing
            window.currentCelebration = { storeName, cityName, stateName };
            
            // Auto close after 6 seconds (longer to allow sharing)
            window.celebrationTimeout = setTimeout(() => {
                celebration.classList.remove('active');
            }, 6000);
        }
        
        // Close celebration overlay
        function closeCelebration(event) {
            // Only close if clicking the overlay (not the card)
            if (event.target.closest('.celebration-card') && !event.target.closest('.celebration-close-btn')) {
                return;
            }
            
            const celebration = document.getElementById('first-sale-celebration');
            celebration.classList.remove('active');
            
            // Clear the auto-close timeout
            if (window.celebrationTimeout) {
                clearTimeout(window.celebrationTimeout);
            }
        }
        
        // Share celebration moment
        function shareCelebration(event) {
            event.stopPropagation();
            
            const { storeName, cityName, stateName } = window.currentCelebration || {};
            const shareText = `🎉 Primeira venda histórica!\n\n${storeName} de ${cityName}, ${stateName} acabou de fazer sua primeira venda na Nuvemshop!\n\nO e-commerce brasileiro pulsa! 🇧🇷\n\n#Nuvemshop #Empreendedorismo #PrimeiraVenda`;
            
            // Try to use the native share API
            if (navigator.share) {
                navigator.share({
                    title: 'Primeira Venda - Nuvemshop',
                    text: shareText,
                    url: window.location.href
                }).catch(() => {
                    // Fallback: copy to clipboard
                    copyToClipboard(shareText);
                });
            } else {
                // Fallback: copy to clipboard
                copyToClipboard(shareText);
            }
        }
        
        // Helper: copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show feedback
                const btn = document.querySelector('.celebration-share-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M20 6L9 17l-5-5"/></svg> Copiado!`;
                btn.style.background = 'var(--success)';
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(() => {
                alert('Copie manualmente: ' + text);
            });
        }

        // ============================================
        // EMOTIONAL ANIMATIONS - Delivery & Money
        // ============================================
        
        // Show delivery truck/package animation when NuvemEnvios is used
        function showDeliveryAnimation(cityName) {
            const mapContainer = document.getElementById('brazil-map-container');
            if (!mapContainer || state.currentView !== 'globe') return;
            
            const cityPos = CITY_POSITIONS[cityName];
            if (!cityPos) return;
            
            const containerRect = mapContainer.getBoundingClientRect();
            const x = (cityPos.x / 100) * containerRect.width;
            const y = (cityPos.y / 100) * containerRect.height;
            
            // Create delivery element
            const delivery = document.createElement('div');
            delivery.className = 'delivery-animation';
            
            // Randomly choose truck or package
            const isTruck = Math.random() > 0.4;
            delivery.innerHTML = isTruck ? '🚚' : '📦';
            delivery.classList.add(isTruck ? 'delivery-truck' : 'delivery-package');
            
            // Position at city
            delivery.style.left = `${x}px`;
            delivery.style.top = `${y}px`;
            
            mapContainer.appendChild(delivery);
            
            // Remove after animation
            setTimeout(() => {
                if (delivery.parentNode) {
                    delivery.parentNode.removeChild(delivery);
                }
            }, isTruck ? 2500 : 2000);
        }
        
        // Show money/real flying animation for sales
        function showMoneyAnimation(cityName, value) {
            const mapContainer = document.getElementById('brazil-map-container');
            if (!mapContainer || state.currentView !== 'globe') return;
            
            const cityPos = CITY_POSITIONS[cityName];
            if (!cityPos) return;
            
            const containerRect = mapContainer.getBoundingClientRect();
            const x = (cityPos.x / 100) * containerRect.width;
            const y = (cityPos.y / 100) * containerRect.height;
            
            // Determine size based on value
            let sizeClass = 'money-small';
            let emoji = '💰';
            
            if (value >= 1000) {
                sizeClass = 'money-large';
                emoji = '💵';
            } else if (value >= 500) {
                sizeClass = 'money-medium';
                emoji = '💵';
            }
            
            // Create main money element
            const money = document.createElement('div');
            money.className = `money-animation ${sizeClass}`;
            money.innerHTML = emoji;
            money.style.left = `${x}px`;
            money.style.top = `${y}px`;
            
            mapContainer.appendChild(money);
            
            // For large values, create a burst effect with multiple particles
            if (value >= 800) {
                const burst = document.createElement('div');
                burst.className = 'money-burst';
                burst.style.left = `${x}px`;
                burst.style.top = `${y}px`;
                
                const particles = value >= 1500 ? 3 : 2;
                const emojis = ['💰', '💵', '🪙'];
                
                for (let i = 0; i < particles; i++) {
                    const particle = document.createElement('span');
                    particle.className = 'money-particle';
                    particle.innerHTML = emojis[i % emojis.length];
                    
                    // Random directions
                    const angle = (Math.random() - 0.5) * 120;
                    const distance = 40 + Math.random() * 60;
                    const tx = Math.sin(angle * Math.PI / 180) * distance;
                    const ty = -Math.abs(Math.cos(angle * Math.PI / 180) * distance) - 30;
                    
                    particle.style.setProperty('--tx', `${tx}px`);
                    particle.style.setProperty('--ty', `${ty}px`);
                    particle.style.setProperty('--rot', `${(Math.random() - 0.5) * 360}deg`);
                    
                    burst.appendChild(particle);
                }
                
                mapContainer.appendChild(burst);
                
                setTimeout(() => {
                    if (burst.parentNode) {
                        burst.parentNode.removeChild(burst);
                    }
                }, 1800);
            }
            
            // Remove main money after animation
            const duration = sizeClass === 'money-large' ? 1800 : sizeClass === 'money-medium' ? 1500 : 1200;
            setTimeout(() => {
                if (money.parentNode) {
                    money.parentNode.removeChild(money);
                }
            }, duration);
        }

        function createSaleItem() {
            const segment = getRandomSegment();
            const segmentData = CONFIG.segments[segment];
            const city = CONFIG.cities[Math.floor(Math.random() * CONFIG.cities.length)];
            const product = segmentData.products[Math.floor(Math.random() * segmentData.products.length)];
            const value = Math.floor(Math.random() * 2000) + 50;
            
            // NEW: Get channel
            const channel = getRandomChannel();
            const channelData = CONFIG.channels[channel];
            
            // NEW: Determine if using Nuvem solutions (random)
            const usesNuvemPay = Math.random() < 0.42; // 42% use Nuvem Pay
            const usesNuvemEnvios = Math.random() < 0.35; // 35% use Nuvem Envios
            
            // NEW: Small chance of first sale (0.5%)
            const isFirstSale = Math.random() < 0.005;
            const storeName = isFirstSale ? CONFIG.storeNames[Math.floor(Math.random() * CONFIG.storeNames.length)] : null;
            
            // HUMAN MOMENT: Generate Brazilian customer name
            const firstName = CONFIG.brazilianNames.firstNames[Math.floor(Math.random() * CONFIG.brazilianNames.firstNames.length)];
            const lastName = CONFIG.brazilianNames.lastNames[Math.floor(Math.random() * CONFIG.brazilianNames.lastNames.length)];
            const customerName = `${firstName} ${lastName}`;
            
            // HUMAN MOMENT: Generate emotional story/moment (30% chance)
            let humanMoment = null;
            if (Math.random() < 0.3) {
                const momentType = CONFIG.humanMoments[Math.floor(Math.random() * CONFIG.humanMoments.length)];
                const template = momentType.templates[Math.floor(Math.random() * momentType.templates.length)];
                humanMoment = template
                    .replace('{value}', formatCurrency(value))
                    .replace('{city}', city.name)
                    .replace('{time}', Math.floor(Math.random() * 30) + 5)
                    .replace('{visits}', Math.floor(Math.random() * 5) + 2);
            }
            
            // REGIONAL IDENTITY: Get state-specific icon and culture
            const stateData = CONFIG.states[city.state];
            const stateIcon = CONFIG.stateIcons[city.state] || {};
            const regionIcon = stateIcon.icon || CONFIG.regionalIcons[stateData?.region] || '📍';
            const stateGreeting = stateIcon.greeting || '';
            const stateCulture = stateIcon.culture || '';
            
            const item = document.createElement('div');
            item.className = 'sale-item channel-' + channel + (isFirstSale ? ' first-sale' : '') + (humanMoment ? ' has-moment' : '');
            
            // Generate a store name for tooltip (use existing for first sale, or random)
            const displayStoreName = storeName || CONFIG.storeNames[Math.floor(Math.random() * CONFIG.storeNames.length)];
            
            // Build badges HTML
            let badgesHtml = `<span class="sale-badge channel-${channel}">${channelData.icon} ${channelData.name}</span>`;
            if (usesNuvemPay) badgesHtml += `<span class="sale-badge nuvem-pay">💳 Nuvem Pay</span>`;
            if (usesNuvemEnvios) badgesHtml += `<span class="sale-badge nuvem-envios">📦 Envios</span>`;
            
            // First sale badge
            let firstSaleBadge = isFirstSale ? `<div class="first-sale-badge">🎉 Primeira Venda!</div>` : '';
            
            // HUMAN MOMENT: Show moment story only (no customer name in main view)
            const momentInfo = humanMoment 
                ? `<div class="sale-moment">${humanMoment}</div>`
                : '';
            
            // Build tooltip solutions HTML
            let tooltipSolutions = '';
            if (usesNuvemPay || usesNuvemEnvios) {
                tooltipSolutions = '<div class="tooltip-solutions">';
                if (usesNuvemPay) tooltipSolutions += '<span>💳 Nuvem Pay</span>';
                if (usesNuvemEnvios) tooltipSolutions += '<span>📦 Nuvem Envios</span>';
                tooltipSolutions += '</div>';
            }
            
            // Build tooltip moment HTML
            const tooltipMoment = humanMoment ? `<div class="tooltip-moment">${humanMoment}</div>` : '';
            
            // Build tooltip HTML
            const tooltipHtml = `
                <div class="sale-item-tooltip">
                    <div class="tooltip-header">
                        <span class="tooltip-store">${displayStoreName}</span>
                        <span class="tooltip-channel">${channelData.icon} ${channelData.name}</span>
                    </div>
                    <div class="tooltip-product">${segmentData.emoji} ${product}</div>
                    <div class="tooltip-customer">Cliente: ${customerName}</div>
                    <div class="tooltip-location">📍 ${city.name}, ${city.state} ${stateIcon.food || ''}</div>
                    <div class="tooltip-value">R$ ${value.toLocaleString('pt-BR')}</div>
                    ${tooltipMoment}
                    ${tooltipSolutions}
                    <div class="tooltip-time">Agora mesmo</div>
                </div>
            `;
            
            item.innerHTML = `
                <div class="sale-icon" style="background: linear-gradient(135deg, ${segmentData.color}, ${segmentData.color}dd)">${segmentData.emoji}</div>
                <div class="sale-info">
                    <div class="sale-location">${regionIcon} ${city.name}, ${city.state}</div>
                    <div class="sale-badges">${badgesHtml}</div>
                    ${momentInfo}
                </div>
                <div style="text-align: right;">
                    <div class="sale-value">R$ ${value.toLocaleString('pt-BR')}</div>
                    ${firstSaleBadge}
                </div>
                ${tooltipHtml}
            `;
            
            return { 
                item, 
                city, 
                value, 
                segment, 
                channel, 
                usesNuvemPay, 
                usesNuvemEnvios, 
                isFirstSale, 
                storeName,
                customerName,
                humanMoment
            };
        }

        function addSale() {
            const { 
                item, city, value, segment, channel, 
                usesNuvemPay, usesNuvemEnvios, isFirstSale, storeName 
            } = createSaleItem();
            
            salesList.insertBefore(item, salesList.firstChild);
            
            // Apply current channel filter to new item
            if (state.currentChannel !== 'all' && !item.classList.contains('channel-' + state.currentChannel)) {
                item.style.display = 'none';
            }
            
            while (salesList.children.length > maxSales) {
                salesList.removeChild(salesList.lastChild);
            }
            
            // Update stats
            state.gmv += value;
            state.totalOrders += 1;
            state.totalSalesTracked += 1;
            
            // NEW: Track channel and solutions
            state.channelCounts[channel] = (state.channelCounts[channel] || 0) + 1;
            if (usesNuvemPay) state.nuvemPayCount += 1;
            if (usesNuvemEnvios) state.nuvemEnviosCount += 1;
            
            // NEW: First sale celebration
            if (isFirstSale) {
                state.firstSalesToday += 1;
                showFirstSaleCelebration(storeName, city.name, city.state);
            }
            
            updateStats();
            updateSolutionsStats();
            
            // Pulse effect on city marker (2D map)
            if (state.currentView === 'globe') {
                const cityMarkers = document.querySelectorAll('.city-marker');
                const cityIndex = CONFIG.cities.findIndex(c => c.name === city.name);
                if (cityIndex >= 0 && cityMarkers[cityIndex]) {
                    const marker = cityMarkers[cityIndex];
                    marker.style.transform = 'translate(-50%, -50%) scale(1.5)';
                    setTimeout(() => {
                        marker.style.transform = 'translate(-50%, -50%) scale(1)';
                    }, 300);
                }
            }
            
            // NEW: Create flow arc occasionally (every 3rd sale)
            if (state.totalSalesTracked % 3 === 0 && state.currentView === 'globe') {
                createFlowArc(city, usesNuvemPay || usesNuvemEnvios);
            }
            
            // EMOTIONAL ANIMATIONS: Money flying for every sale
            if (state.currentView === 'globe' && Math.random() < 0.6) {
                showMoneyAnimation(city.name, value);
            }
            
            // EMOTIONAL ANIMATIONS: Delivery truck for NuvemEnvios
            if (usesNuvemEnvios && state.currentView === 'globe' && Math.random() < 0.5) {
                setTimeout(() => {
                    showDeliveryAnimation(city.name);
                }, 300); // Slight delay after money
            }
        }
        
        // NEW: Update solutions stats display
        function updateSolutionsStats() {
            const nuvemPayEl = document.getElementById('nuvem-pay-percent');
            const nuvemEnviosEl = document.getElementById('nuvem-envios-percent');
            const firstSalesEl = document.getElementById('first-sales-count');
            const nuvemPayCountEl = document.getElementById('nuvem-pay-count');
            const nuvemEnviosCountEl = document.getElementById('nuvem-envios-count');
            
            if (state.totalSalesTracked > 0) {
                const payPercent = Math.round((state.nuvemPayCount / state.totalSalesTracked) * 100);
                const enviosPercent = Math.round((state.nuvemEnviosCount / state.totalSalesTracked) * 100);
                
                if (nuvemPayEl) nuvemPayEl.textContent = payPercent + '%';
                if (nuvemEnviosEl) nuvemEnviosEl.textContent = enviosPercent + '%';
            }
            
            // Update tooltip counts
            if (nuvemPayCountEl) nuvemPayCountEl.textContent = state.nuvemPayCount.toLocaleString('pt-BR');
            if (nuvemEnviosCountEl) nuvemEnviosCountEl.textContent = state.nuvemEnviosCount.toLocaleString('pt-BR');
            
            if (firstSalesEl) firstSalesEl.textContent = state.firstSalesToday;
        }
        
        // NEW: Create animated flow arc on map
        function createFlowArc(destinationCity, isNuvemSolution) {
            const mapContainer = document.querySelector('.brazil-map-container');
            if (!mapContainer) return;
            
            // Get random origin city (different from destination)
            const originCity = CONFIG.cities[Math.floor(Math.random() * CONFIG.cities.length)];
            if (originCity.name === destinationCity.name) return;
            
            // Create SVG arc
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.classList.add('flow-arc');
            if (isNuvemSolution) svg.classList.add('nuvem-solution');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.pointerEvents = 'none';
            svg.style.zIndex = '10';
            
            // Get positions (simplified - just use random positions within the map)
            const rect = mapContainer.getBoundingClientRect();
            const x1 = 50 + Math.random() * 200;
            const y1 = 50 + Math.random() * 300;
            const x2 = 150 + Math.random() * 200;
            const y2 = 100 + Math.random() * 300;
            
            // Control point for curve
            const cx = (x1 + x2) / 2;
            const cy = Math.min(y1, y2) - 50 - Math.random() * 50;
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', `M ${x1} ${y1} Q ${cx} ${cy} ${x2} ${y2}`);
            path.style.strokeDasharray = '200';
            path.style.strokeDashoffset = '200';
            path.style.animation = 'flowDraw 1.5s ease-out forwards';
            
            svg.appendChild(path);
            mapContainer.appendChild(svg);
            
            // Create moving particle
            const particle = document.createElement('div');
            particle.className = 'flow-particle' + (isNuvemSolution ? ' nuvem-solution' : '');
            mapContainer.appendChild(particle);
            
            // Animate particle along path
            let progress = 0;
            const animateParticle = () => {
                progress += 0.02;
                if (progress >= 1) {
                    particle.remove();
                    setTimeout(() => svg.remove(), 500);
                    return;
                }
                
                const t = progress;
                const px = (1-t)*(1-t)*x1 + 2*(1-t)*t*cx + t*t*x2;
                const py = (1-t)*(1-t)*y1 + 2*(1-t)*t*cy + t*t*y2;
                particle.style.left = px + 'px';
                particle.style.top = py + 'px';
                
                requestAnimationFrame(animateParticle);
            };
            
            requestAnimationFrame(animateParticle);
        }

        // ============================================
        // PARTICLES
        // ============================================
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 25; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 15 + 15) + 's';
                container.appendChild(particle);
            }
        }

        // ============================================
        // BRAZIL 2D MAP WITH INTERACTIVITY
        // ============================================
        
        // Real geographic SVG paths for Brazilian states (from IBGE data)
        const BRAZIL_SVG = `
        <svg class="brazil-map-svg" viewBox="0 0 353.845 367.766" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
            <!-- Amazonas -->
            <polygon class="state-path" data-state="AM" points="159.534,63.864 156.251,66.717 155.966,64.435 152.255,61.866 144.834,61.009 143.408,59.154 142.123,55.016 139.269,53.018 137.699,48.023 137.771,43.884 128.28,44.027 126.71,48.451 123.428,49.878 123.999,53.446 119.146,54.017 116.721,50.734 113.01,54.445 112.725,58.869 105.874,53.018 107.017,50.877 104.447,44.455 104.162,37.748 101.308,34.037 99.596,29.613 95.782,28.182 93.558,27.979 92.359,29.04 89.831,29.901 89.763,32.354 87.301,34.808 86.17,33.349 83.706,35.47 77.715,36.929 75.785,39.78 73.521,39.382 71.991,39.515 70.859,40.178 68.862,39.581 65.134,36.2 63.337,37.692 62.139,36.797 62.339,32.719 60.242,29.437 58.046,29.337 57.247,32.321 55.15,32.918 53.153,29.239 51.556,29.337 51.056,31.426 39.874,31.625 38.575,34.211 39.874,36.896 43.668,37.095 44.566,39.482 43.668,42.267 39.973,40.775 37.477,42.764 37.078,50.023 40.372,53.206 40.172,56.289 43.168,58.676 38.376,87.118 34.382,85.825 28.59,85.229 27.592,87.218 20.702,88.212 12.082,92.729 10.618,94.851 9.52,99.251 7.789,102.235 8.388,103.826 7.723,105.484 3.528,107.937 2.197,111.915 2.199,113.858 9.973,116.096 16.253,117.808 27.527,118.949 34.662,120.662 51.502,129.225 70.312,136.403 79.532,137.421 81.757,134.363 83.469,134.363 85.039,132.792 84.753,128.797 87.894,126.942 90.605,126.514 91.604,124.944 91.604,122.232 93.744,119.521 96.599,117.666 101.308,117.666 103.734,121.661 108.158,124.087 112.012,124.087 114.58,126.371 140.649,125.419 141.314,123.136 142.647,121.042 141.885,117.998 142.409,116.381 142.551,113.527 141.694,113.099 141.267,111.529 141.125,109.959 139.126,106.677 139.839,104.393 142.123,103.537 154.967,76.565 157.108,70.571 159.676,67.574 161.817,63.864"/>
            <!-- Roraima -->
            <polygon class="state-path" data-state="RR" points="101.308,34.037 104.162,37.748 104.447,44.455 107.017,50.877 105.874,53.018 112.725,58.869 113.01,54.445 116.721,50.734 119.146,54.017 123.999,53.446 123.428,49.878 126.71,48.451 128.28,44.027 137.771,43.884 136.926,36.548 135.578,34.857 133.78,34.559 129.487,30.133 130.235,27.249 129.586,25.757 126.841,24.316 126.541,21.481 128.238,18.398 128.487,14.47 130.734,12.68 130.734,10.393 128.887,7.906 126.591,7.409 125.692,6.017 126.441,4.077 126.641,1.193 125.093,0.448 123.845,0.796 121.848,0 120.851,0.53 120.117,4.044 113.528,6.563 113.594,8.553 108.069,9.746 103.743,9.878 100.281,12.663 97.751,13.393 95.821,12.531 93.292,12.663 90.097,9.812 86.569,8.751 84.372,11.801 86.569,11.205 89.231,12.597 90.03,15.646 89.032,16.973 88.366,20.155 88.499,24.597 91.162,26.52 94.755,25.857 96.553,26.52 95.782,28.182 99.596,29.613"/>
            <!-- Amapá -->
            <polygon class="state-path" data-state="AP" points="174.328,33.609 182.51,36.083 183.271,39.508 185.745,41.22 187.267,42.172 187.647,46.548 190.692,50.164 193.736,53.398 194.879,54.349 195.259,55.682 194.497,57.014 195.068,58.346 197.635,58.516 199.081,57.73 200.928,54.051 201.527,53.852 202.675,51.217 206.07,48.879 207.567,46.642 210.213,44.852 211.413,42.813 214.208,40.426 214.258,39.681 215.406,38.288 215.456,36.548 216.006,36.1 216.306,36.2 217.252,35.255 217.004,34.808 215.805,35.404 215.256,35.105 214.807,34.459 214.208,34.957 214.157,35.305 213.159,35.603 213.908,35.205 213.758,34.907 214.407,34.26 214.957,34.211 215.456,34.957 215.955,35.105 216.854,34.658 216.954,33.763 216.754,32.918 217.054,31.674 216.405,31.028 214.108,30.432 212.809,30.68 211.761,30.183 211.812,29.586 211.062,28.542 211.162,27.896 210.464,27.796 210.812,27.448 210.313,26.006 209.614,23.371 207.917,18.398 207.368,13.375 207.118,12.829 206.67,13.077 206.42,14.62 206.37,12.382 205.172,9.796 203.125,7.906 202.675,8.702 202.626,10.194 202.275,9.249 201.627,10.741 199.879,11.487 199.03,12.232 196.234,15.315 194.236,19.79 192.791,24.565 188.497,28.741 184.203,28.691 180.808,30.68 176.266,29.835 174.268,26.702 173.168,25.559 173.377,30.375"/>
            <!-- Pará -->
            <path class="state-path" data-state="PA" d="M228.32,92.976l4.28-0.713l3.426-2.996l2.068-2.926l3.283-4.352l0.356-1.927l-0.499-2.712l0.143-0.784l0.856-1.284l3.496-3.568l1.213-1.427l1.785-4.067l1.283-4.282l1.143-3.14l0.713-0.785l1.431-0.232l0.351-0.845l-0.25-0.696l-0.699-0.199l-1.298,0.397l-0.749-0.944l-0.599-0.249l-1.599,0.945l-0.848-0.199l-0.101-0.597l-0.6-0.795h-0.798l-0.201-0.596l-0.348-0.1l-0.85,0.398l-0.448-0.796l-1.149,0.15v-0.398l-1.249,0.05v-0.547l-0.398-0.149l-0.449,0.398l-0.35-0.199l-0.05-0.498h-0.448l-0.65,0.498l-0.898,0.199l-0.349-0.747l-0.35,0.1l0.05,0.647l-0.5-0.1V52.41l-0.499-0.248l-0.35,0.448l0.3,0.348l-0.699-0.199l-0.199-0.448l-0.499,0.099l-0.101,0.547l-0.897-0.348l-1.1,0.746l0.101,0.398l-0.399-0.149l-0.849,0.646l-0.599,0.995l0.35,1.193l-0.899-0.646l-0.699,0.746l0.05,0.547l0.398,0.398l-0.448,0.099l-0.249,1.243l0.35,0.846l0.599,0.199l1.598,0.646l-1.598-0.397l-1.148,0.497l-0.05,0.349l1.447,1.193l-1.796-1.243l0.049-0.696l-0.6,0.248l-0.249-0.596h-0.399l-0.2,0.696l-0.998,0.498l0.15-0.597l-0.399-0.049l-1.798,1.591l-0.648,2.162l-1.748,1.792l0.349,0.82l-1.097,0.497l0.35,1.642l-0.849,0.795v1.392l-0.601-1.542l0.7-0.745l-0.4-1.89l2.472-3.182l0.074-1.293l-0.398-0.348l-2.347,1.144l-0.499-0.448l-1.598,0.05l-0.998,0.747l-1.896,0.248l-1.049-0.398l-1.199-0.298l-0.349,0.448l0.748,1.441l-0.548-0.498l-0.699,0.349l-0.102,0.995l-0.148-1.243l0.499-0.199v-0.597l-2.146-0.298l-2.047,0.695l0.049,2.138l-0.549-2.188l0.65-0.547l-0.898-0.198l1.846-0.746l0.299-0.895l0.85,0.547l0.101,0.746l1.147,0.298l0.15-0.696l1.048-0.299l0.2,0.397l1.397,0.249l0.35-0.348l0.1-0.498l0.4-0.298v0.497l1.098,0.149l0.349-0.298l-0.15-0.596l0.15-0.299l0.2,0.448l0.999,0.596l1.099-0.348l0.249-0.945l0.1,0.995l2.246-0.746l-0.099-0.497l0.848,0.199l1.849-0.845l-0.102-0.298l0.599,0.149l1.898-0.696l0.648-2.138l-0.05-0.696l-0.499,0.199l0.749-0.597l0.599-0.249l-0.15-1.094l0.851-0.697l0.149-1.989l0.947-1.94v-0.894l-0.947-0.299l-2.396-0.199l-1.498-1.144l-1.397,0.398l-4.145,0.82l-4.394-0.597l-0.399,0.522l-0.648-0.248l-1.897,1.491l0.049,0.747l-0.397-0.547l-0.749,1.591v2.834l0.248,0.349l-0.349,0.05l-0.698,0.945l-0.4,1.641l1.798,0.099l-0.948,0.199l0.648,0.348l-1.423-0.249l0.025,1.541l-0.699-1.69l0.4-1.144l-0.3-0.796l-1.398,0.149l-0.1,0.497l-2.047,0.449l-1.399,1.342l-2.395,0.746l-0.499,0.547l-2.098,1.243l-1.847,0.299l-0.249,0.696l-1.149-0.049l-0.648,0.447l-0.767,2.502l0.301,0.812l0.998,3.48l-0.399,0.598l0.1,0.546l-0.398-0.646l0.199-0.498l-1.598-3.033l0.399-2.917l1.016-1.441l0.698-0.299l0.85,0.199l0.05-0.447l-0.85-0.398l-2.397,0.298l-1.047,0.348l-1.398-0.099l-1.198,0.944l0.051,0.498l-1.048,0.049l-2.597,0.946h-0.301l0.5-0.448l2.197-0.795l0.798-1.144l0.948-0.647l2.297,0.15l0.749-1.193l1.997,0.149l1.648-0.646l-0.517-0.646l0.019-0.01l-2.566-0.17l-0.571-1.332l0.762-1.332l-0.38-1.333l-1.143-0.951l-3.044-3.235l-3.045-3.615l-0.381-4.376l-1.521-0.952l-2.475-1.712l-0.76-3.425l-8.182-2.474l-0.951-3.234l-0.209-4.816l-1.696,0.249l-1.148-1.194l-2.545,1.292l-1.997,0.398l-2.546-0.945l-0.999,0.995l0.45,1.492l1.198,1.69l-1.298,1.094h-1.498l-4.144-0.795l-0.3,1.69l-3.145,0.398l-1.647-2.586l-1.947,0.398l-0.849,1.79l-2.996,0.547l-2.445,1.442l-0.95-1.193l-1.397,1.441l-1.648,0.598l0.599,2.138l-3.294,0.05l0.845,7.336l-0.072,4.139l1.57,4.995l2.854,1.998l1.285,4.138l1.426,1.855l7.421,0.856l3.711,2.569l0.285,2.282l3.283-2.854h2.284l-2.141,3.71l-2.568,2.997l-2.141,5.994l-12.844,26.972l-2.284,0.856l-0.713,2.284l1.999,3.282l0.142,1.57l0.427,1.57l0.857,0.429l-0.143,2.854l1.998,1.427c0,0,0.428,2.426,0.571,2.854c0.143,0.428,1.142,1.712,1.142,1.712l1.854,4.71l2.854,4.423l3.854,2.284l3.996,1.142l57.941,0.143l1.641-2.854l2.283-2.641l4.424-7.136l-1.641-3.853v-1.427l1.498-4.067l-1.141-1.855l-0.072-0.856l1.57-1.071l3.567-0.642l2.711-2.212l0.571-3.354v-4.067l-2.355-1.999l-1.854-2.925L228.32,92.976z"/>
            <!-- Acre -->
            <polygon class="state-path" data-state="AC" points="34.662,120.662 27.527,118.949 16.253,117.808 9.973,116.096 2.199,113.858 0.134,114.5 0,116.356 1.532,117.948 2.131,120.037 6.224,124.611 8.221,126.103 8.521,128.191 9.22,129.882 7.523,133.064 8.521,134.258 13.413,133.761 14.313,135.054 17.707,138.932 21.701,138.833 25.695,137.042 26.294,134.457 27.792,133.263 29.688,130.479 30.887,130.479 29.789,134.357 31.187,135.749 31.985,142.015 33.882,144.203 38.176,141.816 41.87,142.412 45.964,142.313 50.357,146.192 52.354,146.391 54.151,142.114 56.848,140.225 63.837,140.026 70.312,136.403 51.502,129.225"/>
            <!-- Rondônia -->
            <polygon class="state-path" data-state="RO" points="124.569,162.477 127.71,161.478 127.138,158.908 128.852,157.48 126.139,151.773 127.71,149.204 126.853,145.637 122.429,144.78 117.862,145.493 116.579,143.21 113.867,142.354 113.438,138.073 115.008,132.364 113.438,129.082 114.58,126.371 112.012,124.087 108.158,124.087 103.734,121.661 101.308,117.666 96.599,117.666 93.744,119.521 91.604,122.232 91.604,124.944 90.605,126.514 87.894,126.942 84.753,128.797 85.039,132.792 83.469,134.363 81.757,134.363 79.532,137.421 79.712,137.44 79.513,144.699 82.708,152.258 86.102,153.949 89.098,157.032 95.289,157.23 97.686,159.22 100.78,158.922 104.176,162.602 107.571,163.894 110.065,166.58 117.456,166.679 122.681,169.708 125.141,166.329"/>
            <!-- Tocantins -->
            <polygon class="state-path" data-state="TO" points="249.87,134.838 247.396,133.221 248.252,132.079 245.873,130.557 245.303,128.083 243.21,127.513 243.21,125.991 245.017,125.991 244.541,122.564 245.493,121.709 249.107,122.755 249.298,121.233 246.92,120.091 248.347,117.333 246.635,116.476 244.353,118.949 243.02,116.476 241.4,115.334 239.213,114.192 238.166,112.29 238.548,108.389 238.071,101.919 235.694,96.307 232.363,95.736 229.675,97.043 232.03,99.042 232.03,103.109 231.459,106.462 228.748,108.674 225.181,109.316 223.61,110.387 223.683,111.244 224.823,113.099 223.325,117.166 223.325,118.593 224.966,122.446 220.542,129.582 218.259,132.222 216.618,135.076 216.118,137.788 214.834,142.497 212.407,145.708 212.052,148.349 211.053,151.345 211.908,153.343 212.193,155.341 211.766,157.053 212.621,159.194 213.525,161.787 215.904,157.576 215.523,162.143 222.088,164.902 224.942,160.24 227.987,160.526 229.033,165.093 233.886,163.38 234.456,165.283 237.787,165.188 243.971,162.904 250.819,161.953 250.535,160.811 251.582,159.956 249.488,156.815 250.345,155.579 252.628,154.151 252.533,152.439 251.012,153.01 250.63,151.868 251.867,151.107 251.772,149.681 250.726,149.204 249.298,149.3 247.586,147.396 248.632,145.779 250.535,144.066 250.059,141.117 253.866,140.261 254.722,138.643 250.819,137.312"/>
            <!-- Maranhão -->
            <polygon class="state-path" data-state="MA" points="253.295,131.508 253.866,128.654 256.149,126.371 256.007,121.947 256.434,119.663 260.715,116.952 267.707,112.813 269.991,109.246 272.132,108.532 276.27,110.387 277.555,110.245 278.696,108.104 279.98,104.536 278.125,101.396 277.84,99.255 281.836,94.975 281.552,92.834 279.41,90.693 278.696,88.694 280.694,84.7 283.691,80.561 289.114,76.708 289.543,73.71 289.193,71.555 287.646,71.157 287.895,71.853 286.847,71.952 286.547,71.405 285.948,71.753 284.351,71.504 283.353,70.511 280.956,69.465 277.861,67.676 276.062,67.477 275.913,67.825 276.612,68.173 276.514,68.421 275.913,68.173 276.112,68.67 275.464,68.72 275.265,67.975 275.114,68.173 275.165,69.068 274.316,68.969 273.217,68.57 273.566,67.925 273.217,67.825 272.868,68.621 272.719,67.975 272.318,68.919 271.919,68.969 271.071,70.212 269.674,71.057 269.374,70.66 269.123,70.858 268.924,70.66 268.575,70.958 268.626,70.41 268.274,70.361 267.801,71.629 268.301,73.071 268.075,73.271 267.127,73.221 266.578,74.787 266.752,72.772 265.654,71.579 265.479,71.107 265.93,70.66 266.179,69.167 266.927,68.173 266.179,67.676 266.278,67.427 266.977,67.726 267.227,67.328 266.878,66.134 266.079,65.587 265.579,65.737 265.979,66.333 265.18,65.936 264.281,66.582 264.581,67.129 264.132,67.129 263.781,66.433 263.233,66.283 264.382,65.936 264.231,65.737 265.979,64.991 265.829,64.643 265.08,64.792 265.629,64.394 264.98,63.399 264.531,63.599 264.231,63.3 264.729,62.802 263.882,62.853 263.683,62.057 264.332,61.858 264.132,61.46 263.434,61.261 263.732,60.416 263.283,59.968 262.584,60.714 262.233,60.118 261.735,60.665 261.437,60.465 261.535,60.118 260.837,60.366 260.137,61.112 259.838,60.764 259.588,61.361 258.89,61.212 258.59,61.709 258.89,62.355 258.49,62.604 259.438,63.35 257.941,62.604 258.49,62.255 258.342,61.809 257.691,61.809 257.541,60.963 258.391,60.465 258.54,59.57 258.092,59.173 259.239,58.676 259.139,58.179 257.941,58.477 257.941,58.875 256.692,59.074 256.044,58.875 255.895,58.129 255.045,57.682 254.146,58.228 253.298,57.78 251.867,58.012 251.154,58.797 250.012,61.937 248.729,66.219 246.943,70.286 245.73,71.712 242.234,75.281 241.378,76.565 241.235,77.349 241.734,80.061 241.378,81.988 238.095,86.34 236.026,89.267 232.601,92.263 228.32,92.976 227.82,94.118 229.675,97.043 232.363,95.736 235.694,96.307 238.071,101.919 238.548,108.389 238.166,112.29 239.213,114.192 241.4,115.334 243.02,116.476 244.353,118.949 246.635,116.476 248.347,117.333 246.92,120.091 249.298,121.233 249.107,122.755 245.493,121.709 244.541,122.564 245.017,125.991 243.21,125.991 243.21,127.513 245.303,128.083 245.873,130.557 248.252,132.079 247.396,133.221 249.87,134.838 250.819,137.312 254.722,138.643 255.862,134.648"/>
            <!-- Piauí -->
            <polygon class="state-path" data-state="PI" points="303.146,108.199 302.481,105.345 299.818,105.345 298.961,100.017 299.247,97.543 297.915,96.401 297.724,94.308 298.392,93.167 296.679,91.55 296.012,87.649 297.629,84.89 296.772,80.132 294.585,78.516 294.3,76.422 295.833,73.344 292.888,73.146 290.791,72.798 289.193,71.555 289.543,73.71 289.114,76.708 283.691,80.561 280.694,84.7 278.696,88.694 279.41,90.693 281.552,92.834 281.836,94.975 277.84,99.255 278.125,101.396 279.98,104.536 278.696,108.104 277.555,110.245 276.27,110.387 272.132,108.532 269.991,109.246 267.707,112.813 260.715,116.952 256.434,119.663 256.007,121.947 256.149,126.371 253.866,128.654 253.295,131.508 255.862,134.648 254.722,138.643 257.576,139.024 260.145,143.116 265.376,142.83 267.185,140.832 269.944,141.022 270.989,139.5 272.132,139.69 272.513,137.501 274.321,136.36 274.796,133.982 273.559,132.841 273.368,130.652 275.177,128.939 277.46,130.652 278.602,129.225 281.265,131.603 283.643,131.603 285.167,130.271 286.879,130.271 289.352,129.416 290.113,127.513 292.492,127.227 292.683,126.085 295.061,124.468 296.012,122.375 300.675,120.281 302.102,118.949 301.72,114.573 300.579,111.909 302.006,110.577"/>
            <!-- Ceará -->
            <polygon class="state-path" data-state="CE" points="329.781,88.412 328.383,88.61 327.285,87.666 326.786,86.124 326.187,85.428 324.589,84.632 321.743,81.549 317.051,78.366 313.706,75.582 312.009,75.333 307.715,72.449 305.469,71.902 301.823,72.647 295.833,73.344 294.3,76.422 294.585,78.516 296.772,80.132 297.629,84.89 296.012,87.649 296.679,91.55 298.392,93.167 297.724,94.308 297.915,96.401 299.247,97.543 298.961,100.017 299.818,105.345 302.481,105.345 303.146,108.199 302.006,110.577 300.579,111.909 302.815,112.1 306.383,111.957 307.81,110.815 309.38,111.671 311.521,111.814 315.23,116.238 317.799,113.527 319.797,113.669 320.511,112.528 319.226,110.958 319.939,109.103 317.799,108.959 317.655,107.961 318.799,106.534 319.654,107.391 320.938,106.677 322.65,106.962 323.937,106.391 323.937,103.823 322.08,102.681 320.082,103.965 319.654,101.967 321.795,98.971 324.649,97.686 326.933,92.976 331.629,89.158"/>
            <!-- Rio Grande do Norte -->
            <polygon class="state-path" data-state="RN" points="328.073,101.539 330.785,99.113 333.64,99.684 332.784,101.824 331.356,101.824 329.645,104.965 331.356,104.821 331.499,106.677 335.352,105.678 335.78,107.676 338.492,106.677 337.636,103.537 340.918,102.109 341.917,103.965 344.057,102.681 347.911,103.965 351.648,103.03 350.3,99.351 350.15,99.202 350.55,98.555 349.7,95.423 347.754,93.533 343.96,92.539 342.014,93.085 339.316,92.638 337.071,92.688 335.174,91.345 333.076,91.494 331.629,89.158 326.933,92.976 324.649,97.686 321.795,98.971 319.654,101.967 320.082,103.965 322.08,102.681 323.937,103.823 326.79,100.541"/>
            <!-- Paraíba -->
            <polygon class="state-path" data-state="PB" points="326.361,113.241 328.502,112.956 329.787,111.101 334.496,111.386 334.496,112.813 332.213,113.099 333.068,115.097 330.785,116.381 331.928,118.521 334.068,118.094 335.496,120.233 337.636,119.663 337.779,117.237 343.202,114.811 344.057,115.953 345.627,115.239 345.057,114.098 346.627,112.956 349.053,113.527 350.337,109.959 353.19,108.817 353.047,107.704 351.648,103.03 347.911,103.965 344.057,102.681 341.917,103.965 340.918,102.109 337.636,103.537 338.492,106.677 335.78,107.676 335.352,105.678 331.499,106.677 331.356,104.821 329.645,104.965 331.356,101.824 332.784,101.824 333.64,99.684 330.785,99.113 328.073,101.539 326.79,100.541 323.937,103.823 323.937,106.391 322.65,106.962 320.938,106.677 319.654,107.391 318.799,106.534 317.655,107.961 317.799,108.959 319.939,109.103 319.226,110.958 320.511,112.528 319.797,113.669 323.365,116.381"/>
            <!-- Pernambuco -->
            <polygon class="state-path" data-state="PE" points="353.19,108.817 350.337,109.959 349.053,113.527 346.627,112.956 345.057,114.098 345.627,115.239 344.057,115.953 343.202,114.811 337.779,117.237 337.636,119.663 335.496,120.233 334.068,118.094 331.928,118.521 330.785,116.381 333.068,115.097 332.213,113.099 334.496,112.813 334.496,111.386 329.787,111.101 328.502,112.956 326.361,113.241 323.365,116.381 319.797,113.669 317.799,113.527 315.23,116.238 311.521,111.814 309.38,111.671 307.81,110.815 306.383,111.957 302.815,112.1 300.579,111.909 301.72,114.573 302.102,118.949 300.675,120.281 296.012,122.375 295.061,124.468 297.963,124.087 299.818,125.799 299.104,128.083 301.531,128.654 301.815,130.366 303.527,131.081 305.812,130.794 308.095,128.511 308.809,126.085 310.521,125.799 312.519,124.23 315.372,123.944 317.514,125.799 319.226,125.799 319.654,127.227 321.653,127.37 323.079,128.797 326.647,127.655 327.646,125.372 329.073,127.37 330.644,126.228 332.213,127.37 332.213,128.654 333.782,128.939 334.782,130.366 337.351,128.797 340.49,129.225 341.489,125.799 343.915,126.656 347.197,124.516 351.398,125.805 353.296,118.396 353.845,112.528"/>
            <!-- Alagoas -->
            <polygon class="state-path" data-state="AL" points="343.915,126.656 341.489,125.799 340.49,129.225 337.351,128.797 334.782,130.366 333.782,128.939 332.213,128.654 332.213,127.37 330.644,126.228 329.073,127.37 327.646,125.372 326.647,127.655 323.079,128.797 324.364,131.508 330.357,132.65 332.641,136.218 335.496,136.218 338.778,139.356 339.314,141.237 342.246,138.369 342.312,137.042 345.975,133.86 345.975,132.866 346.44,133.396 347.238,132.666 346.905,132.07 347.505,132.467 348.57,130.479 351.398,125.805 347.197,124.516"/>
            <!-- Sergipe -->
            <polygon class="state-path" data-state="SE" points="338.778,139.356 335.496,136.218 332.641,136.218 330.357,132.65 324.364,131.508 325.648,134.363 324.078,136.075 324.221,137.646 328.217,139.5 327.932,142.497 326.077,143.068 324.364,145.493 327.932,147.063 327.932,148.918 330.563,148.894 331.096,148.761 331.296,149.292 331.896,148.098 331.762,147.501 331.962,146.838 331.362,146.375 332.628,146.573 332.095,147.302 332.228,147.833 333.126,145.346 338.451,142.082 339.314,141.237"/>
            <!-- Bahia -->
            <polygon class="state-path" data-state="BA" points="327.932,147.063 324.364,145.493 326.077,143.068 327.932,142.497 328.217,139.5 324.221,137.646 324.078,136.075 325.648,134.363 324.364,131.508 323.079,128.797 321.653,127.37 319.654,127.227 319.226,125.799 317.514,125.799 315.372,123.944 312.519,124.23 310.521,125.799 308.809,126.085 308.095,128.511 305.812,130.794 303.527,131.081 301.815,130.366 301.531,128.654 299.104,128.083 299.818,125.799 297.963,124.087 295.061,124.468 292.683,126.085 292.492,127.227 290.113,127.513 289.352,129.416 286.879,130.271 285.167,130.271 283.643,131.603 281.265,131.603 278.602,129.225 277.46,130.652 275.177,128.939 273.368,130.652 273.559,132.841 274.796,133.982 274.321,136.36 272.513,137.501 272.132,139.69 270.989,139.5 269.944,141.022 267.185,140.832 265.376,142.83 260.145,143.116 257.576,139.024 254.722,138.643 253.866,140.261 250.059,141.117 250.535,144.066 248.632,145.779 247.586,147.396 249.298,149.3 250.726,149.204 251.772,149.681 251.867,151.107 250.63,151.868 251.012,153.01 252.533,152.439 252.628,154.151 250.345,155.579 249.488,156.815 251.582,159.956 250.535,160.811 250.819,161.953 252.533,161.953 253.009,163.571 251.391,164.902 252.438,166.615 250.726,167.947 250.059,170.325 251.678,172.229 251.296,174.321 253.484,174.606 253.961,176.319 253.199,178.221 253.579,179.458 252.628,181.266 251.582,183.548 252.914,184.023 255.293,182.501 256.909,182.693 259.384,180.409 264.141,178.602 264.615,176.605 269.277,174.893 272.132,175.558 272.988,177.84 275.177,178.602 277.649,176.89 280.79,177.651 281.171,179.458 283.93,180.694 286.402,183.453 289.923,181.835 294.396,185.449 294.396,186.496 295.537,188.209 298.296,188.398 298.676,186.972 302.102,188.018 302.768,189.73 306.572,190.018 307.619,192.68 305.43,195.629 306.097,196.865 305.645,198.555 303.456,198.84 302.243,202.193 303.195,206.666 305.146,206.189 306.668,207.902 305.525,209.9 310.517,213.857 311.16,210.732 314.305,208.146 315.453,206.107 314.505,204.965 314.754,202.627 315.403,200.736 315.304,197.703 316.353,194.371 316.202,192.631 317.201,190.742 317.051,188.156 316.452,186.764 316.202,185.223 316.702,183.036 316.402,182.788 316.702,182.142 317.051,182.441 317.301,181.892 316.751,181.645 316.852,180.998 316.152,179.059 316.054,177.319 316.801,175.729 317.201,171.701 317.85,169.313 317.449,169.414 317.001,170.955 316.702,170.806 316.801,169.911 317.151,169.612 316.801,169.463 317.25,169.065 316.852,168.867 317.25,167.922 317.899,168.668 318.099,168.419 317.65,167.275 316.952,167.374 316.901,165.982 317.449,166.131 317.301,165.286 318.299,164.789 318.148,164.391 319.497,163.248 318.948,163.347 318.849,162.701 319.297,162.651 319.447,161.955 318.799,161.855 318.898,161.357 318.148,161.309 318.299,161.01 319.148,161.06 319.398,160.065 320.097,160.115 320.146,160.91 320.296,161.159 320.795,160.612 320.844,161.159 321.595,161.159 321.295,161.905 320.895,161.855 320.746,163.198 322.043,162.899 325.887,159.17 327.867,156.004 330.098,152.474 329.698,152.208 329.632,151.214 329.964,151.082 330.098,151.745 330.363,151.811 331.163,149.688 330.63,149.49 330.563,148.894 327.932,148.918"/>
            <!-- Mato Grosso -->
            <path class="state-path" data-state="MT" d="M156.346,203.24l1.142,1.141l3.33-1.711l3.33,0.477l1.617,1.711l4.758,1.713l1.903-0.191l2.949-1.998l2.474,0.762l2.379-0.285l2.378-2.664l1.713,0.381l0.38,1.047l-0.286,3.426l1.522,1.711l2.094,1.143l1.331-1.047v-1.428l-1.142-1.047l-0.475-4.186l0.38-2.188l2.284-1.047l-0.191-1.047l0.477-1.996l3.329-0.857l0.096-2.664l1.331-1.143l1.903-1.996l3.807-0.57l0.854-1.809l0.286-3.423l1.998-1.902l1.903,0.571l3.044-4.375l-0.475-3.14l1.616-2.569l-0.095-3.139l1.712-1.902l-0.285-1.999l1.808-3.21l-0.904-2.593l-0.855-2.141l0.428-1.712l-0.285-1.998l-0.855-1.998l0.999-2.996l0.355-2.641l2.427-3.211l1.284-4.709l0.5-2.711l-57.941-0.143l-3.996-1.142l-3.854-2.284l-2.854-4.423l-1.854-4.71c0,0-1-1.284-1.142-1.712c-0.143-0.429-0.571-2.854-0.571-2.854l-1.998-1.427l-0.524,1.617l0.762,3.044l-1.333,2.093l-0.665,2.283l-26.069,0.952l-1.142,2.71l1.57,3.283l-1.57,5.708l0.429,4.282l2.712,0.855l1.284,2.283l4.567-0.713l4.424,0.857l0.857,3.567l-1.571,2.569l2.712,5.708l-1.713,1.428l0.572,2.569l-3.141,0.999l0.571,3.853l-2.459,3.379l1.264,5.025v8.153l-2.098,0.398l3.995,8.75l2.696,1.094l4.892,0.598l3.695-1.293l5.393,1.193l-0.5,1.988l1.298,8.951l2.495,0.596l3.933,5.533l3.178-2.793L156.346,203.24z"/>
            <!-- Goiás -->
            <polygon class="state-path" data-state="GO" points="237.787,165.188 234.456,165.283 233.886,163.38 229.033,165.093 227.987,160.526 224.942,160.24 222.088,164.902 215.523,162.143 215.904,157.576 213.525,161.787 211.718,164.997 212.003,166.996 210.291,168.898 210.386,172.037 208.77,174.606 209.244,177.747 206.2,182.122 204.297,181.551 202.299,183.453 202.013,186.876 201.158,188.686 197.352,189.256 195.448,191.252 194.117,192.395 194.021,195.059 190.692,195.916 190.216,197.912 190.407,198.959 188.123,200.006 187.743,202.193 188.218,206.379 189.359,207.426 189.359,208.854 188.028,209.9 188.693,212.66 190.026,211.898 191.453,213.135 191.644,215.514 196.923,216.703 199.635,219.271 203.346,219.414 206.058,222.125 211.147,222.84 214.478,218.938 218.092,217.797 225.704,215.799 229.129,212.943 233.98,213.516 235.883,214.467 240.07,211.518 240.83,209.328 239.784,207.713 242.067,205.809 241.498,203.811 239.118,204.764 239.118,202.383 240.545,202.004 242.163,200.102 242.258,197.816 239.975,196.01 240.261,194.393 241.782,193.916 242.067,192.205 243.876,190.873 233.791,190.873 233.695,186.876 234.933,185.83 235.122,183.833 241.021,183.357 243.685,184.499 243.781,187.447 243.876,190.873 245.303,189.541 246.159,187.733 244.826,185.83 246.159,184.404 244.353,183.167 246.159,181.266 248.062,182.216 248.918,181.266 247.68,179.172 248.729,178.317 251.012,180.79 252.628,181.266 253.579,179.458 253.199,178.221 253.961,176.319 253.484,174.606 251.296,174.321 251.678,172.229 250.059,170.325 250.726,167.947 252.438,166.615 251.391,164.902 253.009,163.571 252.533,161.953 250.819,161.953 243.971,162.904"/>
            <!-- Distrito Federal -->
            <polygon class="state-path" data-state="DF" points="243.685,184.499 241.021,183.357 235.122,183.833 234.933,185.83 233.695,186.876 233.791,190.873 243.876,190.873 243.781,187.447"/>
            <!-- Mato Grosso do Sul -->
            <polygon class="state-path" data-state="MS" points="184.604,263.369 185.364,259.564 186.887,256.709 190.407,253.475 194.213,249.859 197.828,247.385 201.252,243.865 203.44,239.393 204.394,237.775 204.772,235.875 208.389,231.688 208.959,230.164 209.815,227.217 211.147,222.84 206.058,222.125 203.346,219.414 199.635,219.271 196.923,216.703 191.644,215.514 191.453,213.135 190.026,211.898 188.693,212.66 188.028,209.9 185.935,208.758 184.413,207.047 184.698,203.621 184.318,202.574 182.605,202.193 180.227,204.857 177.848,205.143 175.375,204.381 172.426,206.379 170.522,206.57 165.765,204.857 164.148,203.146 160.818,202.67 157.488,204.381 156.346,203.24 152.922,207.902 149.744,210.695 144.914,224.754 146.21,228.334 144.714,231.219 146.012,232.91 147.909,237.584 145.413,246.336 146.411,248.82 149.407,249.219 160.988,248.623 163.485,249.518 165.182,248.721 167.679,250.811 168.976,265.23 173.371,266.027 175.966,263.938 180.196,265.885 183.556,265.082"/>
            <!-- Minas Gerais -->
            <polygon class="state-path" data-state="MG" points="248.729,178.317 247.68,179.172 248.918,181.266 248.062,182.216 246.159,181.266 244.353,183.167 246.159,184.404 244.826,185.83 246.159,187.733 245.303,189.541 243.876,190.873 242.067,192.205 241.782,193.916 240.261,194.393 239.975,196.01 242.258,197.816 242.163,200.102 240.545,202.004 239.118,202.383 239.118,204.764 241.498,203.811 242.067,205.809 239.784,207.713 240.83,209.328 240.07,211.518 235.883,214.467 233.98,213.516 229.129,212.943 225.704,215.799 218.092,217.797 214.478,218.938 211.147,222.84 209.815,227.217 208.959,230.164 214.001,228.549 217.711,228.645 220.851,229.689 222.183,231.688 229.795,232.543 235.503,230.736 241.688,230.928 241.688,232.447 242.733,234.637 242.163,237.967 243.685,240.346 247.301,241.391 248.156,245.293 246.92,249.383 249.107,254.141 254.436,251.857 254.816,249.764 258.433,249.191 260.715,250.906 265.853,249.383 273.272,247.385 278.269,247.242 282.265,244.531 284.119,245.814 286.118,244.104 286.118,240.965 288.259,239.25 286.831,237.537 287.545,236.396 290.874,235.969 290.685,230.928 291.35,230.832 295.061,230.164 296.012,225.979 298.866,223.6 298.486,220.461 296.772,218.844 296.108,216.654 298.01,214.943 297.249,212.373 298.392,211.424 300.484,212.088 301.911,211.328 300.77,209.9 300.389,208.189 305.525,209.9 306.668,207.902 305.146,206.189 303.195,206.666 302.243,202.193 303.456,198.84 305.645,198.555 306.097,196.865 305.43,195.629 307.619,192.68 306.572,190.018 302.768,189.73 302.102,188.018 298.676,186.972 298.296,188.398 295.537,188.209 294.396,186.496 294.396,185.449 289.923,181.835 286.402,183.453 283.93,180.694 281.171,179.458 280.79,177.651 277.649,176.89 275.177,178.602 272.988,177.84 272.132,175.558 269.277,174.893 264.615,176.605 264.141,178.602 259.384,180.409 256.909,182.693 255.293,182.501 252.914,184.023 251.582,183.548 252.628,181.266 251.012,180.79"/>
            <!-- Espírito Santo -->
            <polygon class="state-path" data-state="ES" points="300.389,208.189 300.77,209.9 301.911,211.328 300.484,212.088 298.392,211.424 297.249,212.373 298.01,214.943 296.108,216.654 296.772,218.844 298.486,220.461 298.866,223.6 296.012,225.979 295.061,230.164 291.35,230.832 290.685,230.928 290.874,235.969 293.158,239.49 296.393,239.203 298.38,241.711 299.428,239.623 299.927,239.324 301.674,236.24 303.722,234.748 305.818,226.893 307.066,225.549 309.163,224.854 311.061,222.318 310.517,213.857 305.525,209.9"/>
            <!-- Rio de Janeiro -->
            <polygon class="state-path" data-state="RJ" points="293.158,239.49 290.874,235.969 287.545,236.396 286.831,237.537 288.259,239.25 286.118,240.965 286.118,244.104 284.119,245.814 282.265,244.531 278.269,247.242 273.272,247.385 265.853,249.383 265.853,252.998 262.428,257.945 263.199,259.527 263.798,260.291 266.761,260.059 267.027,259.23 268.092,259.164 267.027,258.633 266.062,258.898 265.497,258.533 266.095,258.068 265.129,258.17 265.463,257.207 266.661,255.781 268.392,255.75 268.891,256.412 267.859,257.439 269.423,256.711 270.555,255.617 272.852,255.584 273.252,256.115 275.314,256.08 276.413,256.428 277.262,256.381 277.811,255.732 277.61,255.236 277.711,254.639 279.259,253.545 279.808,254.092 279.708,255.336 278.809,255.732 278.959,255.982 280.207,256.131 284.8,256.428 286.696,256.381 286.547,255.982 284.8,256.281 282.653,255.883 284.501,255.186 286.696,255.285 286.797,255.781 288.495,255.832 289.044,256.031 290.393,254.59 289.843,253.893 289.743,252.301 291.89,250.113 295.533,249.367 298.679,247.129 297.931,245.092 298.38,241.711 296.393,239.203"/>
            <!-- São Paulo -->
            <polygon class="state-path" data-state="SP" points="265.853,252.998 265.853,249.383 260.715,250.906 258.433,249.191 254.816,249.764 254.436,251.857 249.107,254.141 246.92,249.383 248.156,245.293 247.301,241.391 243.685,240.346 242.163,237.967 242.733,234.637 241.688,232.447 241.688,230.928 235.503,230.736 229.795,232.543 222.183,231.688 220.851,229.689 217.711,228.645 214.001,228.549 208.959,230.164 208.389,231.688 204.772,235.875 204.394,237.775 203.44,239.393 201.252,243.865 197.828,247.385 194.213,249.859 190.407,253.475 193.356,254.141 196.591,253.949 199.635,253.189 201.158,252.809 202.109,254.33 203.061,254.33 207.056,254.33 212.384,257.186 218.663,256.424 220.945,258.326 220.757,263.463 220.375,266.127 221.898,269.363 224.942,269.172 228.368,269.744 229.318,273.357 232.173,276.213 235.218,274.689 234.456,277.734 236.125,278.635 236.175,277.912 235.525,278.16 235.725,276.717 237.172,275.225 238.321,274.877 240.717,273.135 240.418,272.887 242.614,271.895 244.861,269.557 246.392,267.848 247.823,266.623 248.854,266.588 249.787,265.895 250.719,266.623 251.318,266.656 251.717,265.297 253.548,263.738 256.443,263.771 257.541,264.436 257.608,264.734 258.474,264.832 258.606,264.336 259.072,264.234 259.339,263.572 258.807,263.539 258.74,262.977 259.506,262.082 260.57,262.182 261.302,260.988 263.199,259.527 262.428,257.945"/>
            <!-- Paraná -->
            <polygon class="state-path" data-state="PR" points="234.456,277.734 235.218,274.689 232.173,276.213 229.318,273.357 228.368,269.744 224.942,269.172 221.898,269.363 220.375,266.127 220.757,263.463 220.945,258.326 218.663,256.424 212.384,257.186 207.056,254.33 203.061,254.33 202.109,254.33 201.158,252.809 199.635,253.189 196.591,253.949 193.356,254.141 190.407,253.475 186.887,256.709 185.364,259.564 184.604,263.369 183.556,265.082 180.196,265.885 177.763,274.082 177.664,278.756 176.28,281.801 182.956,283.033 184.454,288.203 183.603,290.621 186.648,288.984 189.502,290.197 192.356,289.484 193.927,291.41 196.425,291.34 199.706,292.695 204.844,293.695 206.058,292.98 205.985,291.197 207.199,289.414 212.052,286.273 214.478,286.844 217.401,286.346 220.686,288.344 224.823,285.988 228.248,287.129 230.233,287.793 230.184,284.873 229.085,284.475 230.033,284.375 231.132,282.336 232.28,281.49 231.682,281.291 231.082,281.49 231.032,280.943 229.585,281.043 229.085,281.143 229.385,280.695 228.485,279.9 229.934,280.396 230.482,280.098 230.932,280.695 231.631,279.6 231.381,278.807 231.932,279.004 232.33,278.705 232.28,279.502 232.879,279.9 233.478,279.451 233.777,279.65 233.029,280.297 233.129,281.143 233.528,281.094 234.377,279.65 236.125,278.635"/>
            <!-- Santa Catarina -->
            <polygon class="state-path" data-state="SC" points="224.823,285.988 220.686,288.344 217.401,286.346 214.478,286.844 212.052,286.273 207.199,289.414 205.985,291.197 206.058,292.98 204.844,293.695 199.706,292.695 196.425,291.34 193.927,291.41 192.356,289.484 189.502,290.197 186.648,288.984 183.603,290.621 185.153,294.27 183.62,298.275 185.364,298.57 188.98,298.191 192.976,298.191 196.211,298.762 198.873,300.379 201.348,301.615 205.153,302.566 207.342,303.613 209.054,306.941 211.053,310.463 213.052,312.271 214.478,312.271 216.569,311.32 218.378,310.844 219.71,311.795 219.899,313.508 217.235,316.076 214.667,320.357 215.714,320.738 217.33,319.502 218.663,320.547 226.838,312.867 227.688,313.016 228.336,312.471 227.937,311.176 228.186,310.182 229.285,309.934 229.435,308.641 229.885,308.59 229.535,310.133 229.834,309.982 230.282,307.746 230.333,305.807 230.184,305.605 230.433,304.465 229.834,302.873 230.033,301.68 230.433,301.23 229.834,300.834 229.885,300.039 230.732,299.691 230.832,299.393 230.533,298.893 231.432,298.348 231.932,298.646 232.33,298.1 231.381,297.203 231.032,297.75 230.533,297.551 230.732,296.756 230.184,296.707 230.033,295.762 230.533,294.867 229.783,294.619 229.634,292.777 230.083,290.689 229.285,289.496 228.535,289.695 227.786,289.545 228.685,288.998 227.837,287.955 229.034,288.75 230.233,287.793 228.248,287.129"/>
            <!-- Rio Grande do Sul -->
            <polygon class="state-path" data-state="RS" points="215.714,320.738 214.667,320.357 217.235,316.076 219.899,313.508 219.71,311.795 218.378,310.844 216.569,311.32 214.478,312.271 213.052,312.271 211.053,310.463 209.054,306.941 207.342,303.613 205.153,302.566 201.348,301.615 198.873,300.379 196.211,298.762 192.976,298.191 188.98,298.191 185.364,298.57 183.62,298.275 171.023,304.363 165.032,310.133 159.191,319.432 151.903,325.398 150.604,328.383 155.53,328.646 158.924,331.697 161.122,332.293 161.988,334.215 163.452,335.875 163.384,336.668 164.583,337.729 165.981,336.934 166.381,335.875 168.843,335.807 171.04,338.459 180.825,347.012 183.354,347.674 189.013,354.637 186.883,359.477 187.082,362.857 185.951,366.57 186.449,367.764 187.647,364.881 192.641,360.205 195.536,356.029 197.033,350.758 200.129,348.77 199.829,348.371 198.532,348.869 198.432,347.773 199.629,347.477 197.934,346.879 198.232,346.082 199.23,345.984 199.829,344.988 200.129,342.803 201.527,341.707 202.725,341.906 203.125,340.613 203.724,340.912 203.923,338.027 205.021,336.535 205.121,337.631 205.722,335.74 206.818,334.547 206.818,333.752 205.121,333.156 205.021,332.559 205.621,331.762 206.021,332.758 207.019,333.254 208.616,333.156 209.614,331.861 211.612,331.166 212.012,333.254 211.312,333.553 211.212,332.857 210.612,332.758 210.812,336.535 209.314,337.232 209.216,338.027 208.117,338.525 207.917,341.111 206.52,342.305 205.321,342.404 203.623,345.189 202.825,345.189 202.226,346.184 200.629,345.785 200.329,346.283 201.028,347.277 200.43,348.172 200.828,348.57 201.327,347.477 204.822,345.389 211.312,338.824 216.604,326.889 218.351,320.922 218.663,320.547 217.33,319.502"/>
        </svg>`;
        
        // City positions on the map (percentage based for 353.845x367.766 viewBox)
        const CITY_POSITIONS = {
            'São Paulo': { x: 62, y: 70, state: 'SP' },
            'Rio de Janeiro': { x: 78, y: 69, state: 'RJ' },
            'Belo Horizonte': { x: 77, y: 54, state: 'MG' },
            'Vitória': { x: 86, y: 62, state: 'ES' },
            'Curitiba': { x: 60, y: 77, state: 'PR' },
            'Florianópolis': { x: 62, y: 83, state: 'SC' },
            'Porto Alegre': { x: 55, y: 92, state: 'RS' },
            'Brasília': { x: 67, y: 51, state: 'DF' },
            'Goiânia': { x: 60, y: 56, state: 'GO' },
            'Cuiabá': { x: 42, y: 47, state: 'MT' },
            'Campo Grande': { x: 48, y: 68, state: 'MS' },
            'Salvador': { x: 88, y: 42, state: 'BA' },
            'Fortaleza': { x: 87, y: 27, state: 'CE' },
            'Recife': { x: 96, y: 33, state: 'PE' },
            'Natal': { x: 96, y: 27, state: 'RN' },
            'João Pessoa': { x: 95, y: 31, state: 'PB' },
            'Maceió': { x: 97, y: 36, state: 'AL' },
            'Aracaju': { x: 94, y: 39, state: 'SE' },
            'Teresina': { x: 79, y: 29, state: 'PI' },
            'São Luís': { x: 72, y: 20, state: 'MA' },
            'Manaus': { x: 32, y: 27, state: 'AM' },
            'Belém': { x: 62, y: 22, state: 'PA' },
            'Porto Velho': { x: 32, y: 43, state: 'RO' },
            'Rio Branco': { x: 12, y: 36, state: 'AC' },
            'Macapá': { x: 55, y: 12, state: 'AP' },
            'Boa Vista': { x: 32, y: 8, state: 'RR' },
            'Palmas': { x: 65, y: 41, state: 'TO' }
        };

        function initBrazilMap() {
            const container = document.getElementById('brazil-map-container');
            if (!container) return;
            
            // Insert SVG
            container.innerHTML = BRAZIL_SVG;
            
            // Add city dots with size based on sales volume
            Object.entries(CITY_POSITIONS).forEach(([cityName, pos]) => {
                const cityData = CONFIG.cities.find(c => c.name === cityName);
                if (!cityData) return;
                
                // Determine size class based on GMV
                let sizeClass = '';
                if (cityData.gmv >= 3000000000) sizeClass = ' size-lg';
                else if (cityData.gmv >= 1000000000) sizeClass = ' size-md';
                else sizeClass = ' size-sm';
                
                const dot = document.createElement('div');
                dot.className = 'city-dot' + (cityData.capital ? ' capital' : '') + sizeClass;
                dot.style.left = pos.x + '%';
                dot.style.top = pos.y + '%';
                dot.setAttribute('data-city', cityName);
                dot.setAttribute('data-state', pos.state);
                
                dot.addEventListener('click', (e) => {
                    e.stopPropagation();
                    hideControlsHint();
                    showCityTooltip(cityData, e.clientX, e.clientY);
                });
                
                container.appendChild(dot);
            });
            
            // Add state click handlers
            const statePaths = container.querySelectorAll('.state-path');
            statePaths.forEach(path => {
                const stateCode = path.getAttribute('data-state');
                const stateData = CONFIG.states[stateCode];
                
                if (stateData) {
                    path.addEventListener('click', (e) => {
                        // Hide hint on first interaction
                        hideControlsHint();
                        
                        // Remove active from all states
                        statePaths.forEach(p => p.classList.remove('active'));
                        // Add active to clicked state
                        path.classList.add('active');
                        
                        // Find capital city for this state
                        const capitalCity = CONFIG.cities.find(c => c.state === stateCode);
                        if (capitalCity) {
                            showCityTooltip(capitalCity, e.clientX, e.clientY);
                        }
                    });
                }
            });
            
            // Hide loading
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
            }, 800);
        }
        
        // Call initBrazilMap instead of initGlobe
        function initGlobe() {
            initBrazilMap();
            startLiveSalesAnimation();
        }
        
        // Live Sales Animation - Simulates sales happening in real-time
        function startLiveSalesAnimation() {
            const states = ['SP', 'RJ', 'MG', 'RS', 'PR', 'SC', 'BA', 'PE', 'CE', 'GO', 'DF', 'ES', 'PA', 'AM', 'MT', 'MS'];
            const weights = [30, 20, 15, 10, 8, 7, 5, 4, 4, 3, 3, 2, 2, 2, 1, 1]; // Higher weight = more likely
            
            function getWeightedRandomState() {
                const totalWeight = weights.reduce((a, b) => a + b, 0);
                let random = Math.random() * totalWeight;
                for (let i = 0; i < states.length; i++) {
                    random -= weights[i];
                    if (random <= 0) return states[i];
                }
                return states[0];
            }
            
            function triggerSalePulse() {
                const stateCode = getWeightedRandomState();
                const statePath = document.querySelector(`.state-path[data-state="${stateCode}"]`);
                
                if (statePath) {
                    statePath.classList.add('sale-pulse');
                    setTimeout(() => {
                        statePath.classList.remove('sale-pulse');
                    }, 600);
                }
                
                // Also pulse the city dot if exists
                const cityDot = document.querySelector(`.city-dot[data-state="${stateCode}"]`);
                if (cityDot) {
                    cityDot.style.transform = 'translate(-50%, -50%) scale(1.5)';
                    cityDot.style.boxShadow = '0 0 30px rgba(54, 179, 126, 0.8)';
                    setTimeout(() => {
                        cityDot.style.transform = 'translate(-50%, -50%) scale(1)';
                        cityDot.style.boxShadow = '';
                    }, 400);
                }
            }
            
            // Trigger sales at random intervals (1-3 seconds)
            function scheduleSale() {
                const delay = 1000 + Math.random() * 2000;
                setTimeout(() => {
                    if (state.currentView === 'globe') {
                        triggerSalePulse();
                    }
                    scheduleSale();
                }, delay);
            }
            
            scheduleSale();
        }
        
        // Legacy functions - no longer needed but kept for compatibility
        function zoomIn() {}
        function zoomOut() {}
        function resetCamera() { closeTooltip(); }
        function animate() {}
        function onWindowResize() {}
        function focusOnCity() { closeTooltip(); }

        // ============================================
        // CITY TOOLTIP
        // ============================================
        function showCityTooltip(city, x, y) {
            state.selectedCity = city;
            state.tooltipVisible = true;
            
            const tooltip = document.getElementById('region-tooltip');
            const stateData = CONFIG.states[city.state];
            const stateIcon = CONFIG.stateIcons[city.state] || {};
            
            // Update content - use state flag instead of Brazil flag
            document.getElementById('tooltip-flag').textContent = stateIcon.flag || '🇧🇷';
            document.getElementById('tooltip-city').textContent = city.name;
            document.getElementById('tooltip-country').textContent = stateData ? stateData.name + ' (' + city.state + ')' : city.state;
            document.getElementById('tooltip-orders').textContent = formatNumber(city.orders);
            document.getElementById('tooltip-gmv').textContent = formatCurrency(city.gmv);
            document.getElementById('tooltip-stores').textContent = city.stores.toLocaleString('pt-BR');
            document.getElementById('tooltip-ticket').textContent = 'R$ ' + city.ticket;
            
            // Update segments
            const segmentsList = document.getElementById('tooltip-segments');
            segmentsList.innerHTML = '';
            city.topSegments.forEach((segKey, i) => {
                const seg = CONFIG.segments[segKey];
                if (seg) {
                    const percent = i === 0 ? 38 : i === 1 ? 25 : 18;
                    const tag = document.createElement('span');
                    tag.className = 'region-segment-tag';
                    tag.innerHTML = `<span style="color: ${seg.color}">●</span> ${seg.name} ${percent}%`;
                    segmentsList.appendChild(tag);
                }
            });
            
            // Position tooltip - only set explicit position on desktop
            const isMobile = window.innerWidth <= 768;
            
            if (!isMobile) {
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const tooltipWidth = 320;
                const tooltipHeight = 360;
                
                let left = x + 20;
                let top = y - tooltipHeight / 2;
                
                // Adjust if off screen
                if (left + tooltipWidth > viewportWidth - 20) {
                    left = x - tooltipWidth - 20;
                }
                if (top < 80) top = 80;
                if (top + tooltipHeight > viewportHeight - 20) {
                    top = viewportHeight - tooltipHeight - 20;
                }
                
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
            }
            // On mobile, CSS handles positioning as a bottom sheet
            
            tooltip.classList.add('visible');
        }

        function closeTooltip() {
            state.tooltipVisible = false;
            state.selectedCity = null;
            document.getElementById('region-tooltip').classList.remove('visible');
            
            // Remove active state
            document.querySelectorAll('#brazil-map .state').forEach(s => s.classList.remove('active'));
        }

        function focusOnCity() {
            if (!state.selectedCity || !camera || !controls) return;
            
            // Zoom in closer
            const startDistance = camera.position.length();
            const targetDistance = 2.3;
            
            const startTime = Date.now();
            const duration = 600;
            
            function animateFocus() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                
                const currentDistance = startDistance + (targetDistance - startDistance) * eased;
                camera.position.normalize().multiplyScalar(currentDistance);
                controls.update();
                
                if (progress < 1) {
                    requestAnimationFrame(animateFocus);
                }
            }
            
            animateFocus();
            closeTooltip();
        }

        // Zoom controls for 3D globe
        function zoomIn() {
            if (!camera || !controls) return;
            const currentDistance = camera.position.length();
            const newDistance = Math.max(controls.minDistance, currentDistance - 0.3);
            camera.position.normalize().multiplyScalar(newDistance);
            controls.update();
            hideControlsHint();
        }

        function zoomOut() {
            if (!camera || !controls) return;
            const currentDistance = camera.position.length();
            const newDistance = Math.min(controls.maxDistance, currentDistance + 0.3);
            camera.position.normalize().multiplyScalar(newDistance);
            controls.update();
            hideControlsHint();
        }

        function resetCamera() {
            if (!camera || !controls) return;
            
            // Reset to default Brazil view
            const targetDistance = 3;
            
            const startPosition = camera.position.clone();
            const targetPosition = new THREE.Vector3(targetDistance, 0, 0);
            
            const startTime = Date.now();
            const duration = 800;
            
            function animateReset() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                
                camera.position.lerpVectors(startPosition, targetPosition, eased);
                camera.lookAt(0, 0, 0);
                controls.update();
                
                if (progress < 1) {
                    requestAnimationFrame(animateReset);
                }
            }
            
            animateReset();
            closeTooltip();
        }

        function hideControlsHint() {
            if (state.controlsHintShown) {
                state.controlsHintShown = false;
                document.getElementById('globe-controls-hint').classList.add('hidden');
            }
        }

        // Animation loop for 3D globe
        function animate() {
            requestAnimationFrame(animate);
            
            // Update controls
            if (controls) {
                controls.update();
            }
            
            // Render scene
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }

        function onWindowResize() {
            const container = document.querySelector('.globe-view');
            if (!container || !camera || !renderer) return;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // ============================================
        // GAME - CART RESCUE WITH PADDLE (ENHANCED)
        // ============================================
        const gameArea = document.getElementById('game-area');
        const gamePaddle = document.getElementById('game-paddle');
        let paddleX = 0, paddleY = 0;
        let activeCarts = [];
        let activePowerups = [];
        let comboTimeout = null;

        // Initialize game state extensions
        state.combo = 0;
        state.maxCombo = 0;
        state.lastRescueTime = 0;
        state.wave = 1;
        state.lives = 3;
        state.totalGMV = 0;
        state.activePowerups = {};
        
        // Cart types configuration - MORE CHALLENGING
        const CART_TYPES = {
            normal: { emoji: '🛒', points: 100, speed: 1.2, color: 'linear-gradient(135deg, var(--danger), var(--danger-light))', class: '' },
            premium: { emoji: '🛒', points: 300, speed: 1.5, color: 'linear-gradient(135deg, #ffd700, #ff9800)', class: 'premium' },
            vip: { emoji: '💎', points: 500, speed: 1.8, color: 'linear-gradient(135deg, #9c27b0, #e91e63)', class: 'vip' },
            speedy: { emoji: '🚀', points: 400, speed: 2.5, color: 'linear-gradient(135deg, #00bcd4, #03a9f4)', class: 'speedy' },
            zigzag: { emoji: '🌀', points: 350, speed: 1.4, color: 'linear-gradient(135deg, #4caf50, #8bc34a)', class: 'zigzag', movement: 'zigzag' },
            ghost: { emoji: '👻', points: 600, speed: 1.3, color: 'linear-gradient(135deg, rgba(255,255,255,0.3), rgba(200,200,200,0.5))', class: 'ghost', invisible: true },
            splitter: { emoji: '🎯', points: 200, speed: 1.1, color: 'linear-gradient(135deg, #ff5722, #ff9800)', class: 'splitter', splits: true },
            bomb: { emoji: '💣', points: -500, speed: 1.4, color: 'linear-gradient(135deg, #1a1a1a, #333)', class: 'bomb', damage: true },
            megaBomb: { emoji: '☢️', points: -1000, speed: 1.0, color: 'linear-gradient(135deg, #4a0000, #8b0000)', class: 'mega-bomb', damage: true, megaDamage: true },
            decoy: { emoji: '🛒', points: -300, speed: 1.2, color: 'linear-gradient(135deg, var(--danger), var(--danger-light))', class: 'decoy', damage: true }
        };
        
        // Power-up types - SHORTER DURATIONS
        const POWERUP_TYPES = {
            speed: { emoji: '⚡', name: 'Velocidade', duration: 5000, effect: 'speed' },
            freeze: { emoji: '❄️', name: 'Congelar', duration: 3000, effect: 'freeze' },
            multiplier: { emoji: '✨', name: '2x Pontos', duration: 6000, effect: 'multiplier' },
            shield: { emoji: '🛡️', name: 'Escudo', duration: 8000, effect: 'shield' },
            heart: { emoji: '💖', name: '+1 Vida', duration: 0, effect: 'heart', instant: true }
        };
        
        // Sound effects using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'rescue':
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.15);
                    break;
                case 'combo':
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1600, audioContext.currentTime + 0.15);
                    gainNode.gain.setValueAtTime(0.12, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'bomb':
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'powerup':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.1);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.25);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.25);
                    break;
                case 'gameover':
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.5);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
            }
        }
        
        // Create particle burst effect
        function createParticleBurst(x, y, color) {
            const burst = document.createElement('div');
            burst.className = 'particle-burst';
            burst.style.left = x + 'px';
            burst.style.top = y + 'px';
            
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.background = color;
                const angle = (i / 8) * Math.PI * 2;
                const distance = 30 + Math.random() * 30;
                particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                burst.appendChild(particle);
            }
            
            gameArea.appendChild(burst);
            setTimeout(() => burst.remove(), 800);
        }
        
        // Screen shake effect
        function screenShake() {
            gameArea.classList.add('shake');
            setTimeout(() => gameArea.classList.remove('shake'), 400);
        }

        // Paddle follows mouse
        function initGamePaddle() {
            const gameView = document.getElementById('view-game');
            let animationFrameId = null;
            let targetX = 0, targetY = 0;
            
            function updatePaddlePosition(clientX, clientY) {
                const areaRect = gameArea.getBoundingClientRect();
                // Responsive paddle size: smaller on mobile
                const paddleSize = window.innerWidth <= 768 ? 30 : 45;
                
                // Constrain paddle to game area - instant update
                paddleX = Math.max(areaRect.left + paddleSize, Math.min(areaRect.right - paddleSize, clientX));
                paddleY = Math.max(areaRect.top + paddleSize, Math.min(areaRect.bottom - paddleSize, clientY));
                
                // Use transform for GPU-accelerated positioning
                const paddleOffset = window.innerWidth <= 768 ? 30 : 45;
                gamePaddle.style.transform = `translate(${paddleX - paddleOffset}px, ${paddleY - paddleOffset}px)`;
                
                // Check collisions when moving
                if (state.gameRunning) {
                    checkPaddleCollisions();
                }
            }
            
            // Mouse move - direct update
            gameView.addEventListener('mousemove', (e) => {
                updatePaddlePosition(e.clientX, e.clientY);
            }, { passive: true });
            
            // Touch support for iOS
            gameView.addEventListener('touchmove', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const touch = e.touches[0];
                updatePaddlePosition(touch.clientX, touch.clientY);
            }, { passive: false });
            
            gameView.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                updatePaddlePosition(touch.clientX, touch.clientY);
            }, { passive: false });
            
            // Also add touch handlers directly on game area
            gameArea.addEventListener('touchmove', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const touch = e.touches[0];
                updatePaddlePosition(touch.clientX, touch.clientY);
            }, { passive: false });
            
            gameArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                updatePaddlePosition(touch.clientX, touch.clientY);
            }, { passive: false });
            
            // Hide hint after first move
            gameView.addEventListener('mousemove', () => {
                const hint = document.getElementById('game-hint');
                if (hint) hint.style.display = 'none';
            }, { once: true });
        }

        function checkPaddleCollisions() {
            const paddleRect = {
                left: paddleX - 40,
                right: paddleX + 40,
                top: paddleY - 40,
                bottom: paddleY + 40
            };
            
            activeCarts.forEach(cartData => {
                if (cartData.rescued) return;
                
                const cart = cartData.element;
                const cartRect = cart.getBoundingClientRect();
                
                // Check collision
                if (paddleRect.left < cartRect.right &&
                    paddleRect.right > cartRect.left &&
                    paddleRect.top < cartRect.bottom &&
                    paddleRect.bottom > cartRect.top) {
                    
                    rescueCart(cartData);
                }
            });
        }

        function startGame() {
            if (state.gameRunning) return;
            
            state.gameRunning = true;
            state.gameScore = 0;
            state.cartsRescued = 0;
            state.cartsLost = 0;
            state.combo = 0;
            state.maxCombo = 0;
            state.wave = 1;
            state.lives = 3;
            state.totalGMV = 0;
            state.activePowerups = {};
            activeCarts = [];
            activePowerups = [];
            updateGameStats();
            updateLivesDisplay();
            updateWaveDisplay();
            
            // Hide game over overlay
            document.getElementById('game-over-overlay').classList.remove('visible');
            
            // Show wave indicator
            document.getElementById('wave-indicator').style.display = 'flex';
            
            // Show paddle
            gamePaddle.style.display = 'block';
            
            document.getElementById('game-start-btn').innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="4" width="4" height="16"/>
                    <rect x="14" y="4" width="4" height="16"/>
                </svg>
                Pausar
            `;
            document.getElementById('game-start-btn').onclick = pauseGame;
            
            // Start wave system
            startWave();
        }
        
        function startWave() {
            updateWaveDisplay();
            
            // Wave announcement
            showWaveAnnouncement();
            
            // Calculate spawn rate based on wave (MUCH faster as waves progress)
            const baseSpawnRate = 1200; // Faster base
            const spawnRate = Math.max(350, baseSpawnRate - (state.wave - 1) * 120); // Min 350ms
            
            // Multiple carts per spawn in later waves
            const cartsPerSpawn = state.wave >= 5 ? 2 : 1;
            const additionalCartsChance = state.wave >= 8 ? 0.4 : (state.wave >= 3 ? 0.2 : 0);
            
            // Spawn initial cart after delay
            setTimeout(() => {
                if (state.gameRunning) spawnCart();
            }, 800);
            
            // Set interval for spawning
            state.gameInterval = setInterval(() => {
                if (state.gameRunning) {
                    // Spawn base carts
                    for (let i = 0; i < cartsPerSpawn; i++) {
                        setTimeout(() => spawnCart(), i * 150);
                    }
                    
                    // Chance for additional cart
                    if (Math.random() < additionalCartsChance) {
                        setTimeout(() => spawnCart(), 300);
                    }
                    
                    // Chance to spawn power-up (REDUCED)
                    if (Math.random() < 0.04) {
                        spawnPowerup();
                    }
                }
            }, spawnRate);
            
            // Wave duration: FAST waves for quicker progression
            // Base 6 seconds + 500ms per wave (was 12000 + 1500)
            state.waveTimeout = setTimeout(() => {
                if (state.gameRunning && state.lives > 0) {
                    clearInterval(state.gameInterval);
                    state.wave++;
                    startWave();
                }
            }, 6000 + state.wave * 500);
        }
        
        function showWaveAnnouncement() {
            const announcement = document.createElement('div');
            announcement.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 48px;
                font-weight: 900;
                color: white;
                text-shadow: 0 0 20px var(--primary-glow);
                z-index: 50;
                animation: fadeInOut 1.5s ease-out forwards;
            `;
            announcement.textContent = `🌊 ONDA ${state.wave}`;
            gameArea.appendChild(announcement);
            
            // Add keyframe animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                    30% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                    70% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => announcement.remove(), 1500);
        }
        
        function updateWaveDisplay() {
            document.getElementById('wave-number').textContent = state.wave;
        }
        
        function updateLivesDisplay() {
            const hearts = document.querySelectorAll('#lives-display .life-heart');
            hearts.forEach((heart, i) => {
                if (i < state.lives) {
                    heart.classList.remove('lost');
                } else {
                    heart.classList.add('lost');
                }
            });
        }

        function pauseGame() {
            state.gameRunning = false;
            clearInterval(state.gameInterval);
            clearTimeout(state.waveTimeout);
            
            document.getElementById('game-start-btn').innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
                Continuar
            `;
            document.getElementById('game-start-btn').onclick = resumeGame;
        }
        
        function resumeGame() {
            if (state.gameRunning) return;
            state.gameRunning = true;
            
            document.getElementById('game-start-btn').innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="4" width="4" height="16"/>
                    <rect x="14" y="4" width="4" height="16"/>
                </svg>
                Pausar
            `;
            document.getElementById('game-start-btn').onclick = pauseGame;
            
            // Resume wave
            startWave();
        }

        function resetGame() {
            state.gameRunning = false;
            clearInterval(state.gameInterval);
            clearTimeout(state.waveTimeout);
            
            state.gameScore = 0;
            state.cartsRescued = 0;
            state.cartsLost = 0;
            state.combo = 0;
            state.maxCombo = 0;
            state.wave = 1;
            state.lives = 3;
            state.totalGMV = 0;
            state.activePowerups = {};
            updateGameStats();
            updateLivesDisplay();
            
            // Clear all carts and powerups
            gameArea.querySelectorAll('.falling-cart, .power-up, .particle-burst').forEach(el => el.remove());
            activeCarts = [];
            activePowerups = [];
            
            // Clear active powerup indicators
            document.getElementById('active-powerups').innerHTML = '';
            
            // Hide game over and wave indicator
            document.getElementById('game-over-overlay').classList.remove('visible');
            document.getElementById('wave-indicator').style.display = 'none';
            
            // Hide paddle
            gamePaddle.style.display = 'none';
            
            // Show hint again
            const hint = document.getElementById('game-hint');
            if (hint) hint.style.display = 'flex';
            
            document.getElementById('game-start-btn').innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
                Iniciar Jogo
            `;
            document.getElementById('game-start-btn').onclick = startGame;
        }

        function spawnCart() {
            const areaRect = gameArea.getBoundingClientRect();
            
            // Determine cart type based on wave and randomness - MORE VARIETY
            let cartType = 'normal';
            const rand = Math.random();
            const waveBonus = state.wave * 0.025; // More aggressive scaling
            
            if (state.wave >= 6 && rand < 0.03 + waveBonus * 0.5) {
                cartType = 'megaBomb'; // Mega bomb from wave 6+
            } else if (rand < 0.06 + waveBonus) {
                cartType = 'bomb'; // Regular bomb
            } else if (state.wave >= 4 && rand < 0.10 + waveBonus) {
                cartType = 'decoy'; // Looks like normal but is a trap!
            } else if (state.wave >= 3 && rand < 0.15 + waveBonus) {
                cartType = 'speedy'; // Very fast cart
            } else if (state.wave >= 2 && rand < 0.20 + waveBonus) {
                cartType = 'zigzag'; // Moves side to side
            } else if (state.wave >= 5 && rand < 0.24 + waveBonus) {
                cartType = 'ghost'; // Fades in and out
            } else if (rand < 0.12 + waveBonus) {
                cartType = 'vip'; // High value
            } else if (rand < 0.28 + waveBonus) {
                cartType = 'premium'; // Medium value
            } else if (state.wave >= 4 && rand < 0.35) {
                cartType = 'splitter'; // Splits into more when missed
            }
            
            const typeConfig = CART_TYPES[cartType];
            const baseValue = typeConfig.points;
            const value = typeConfig.damage ? baseValue : baseValue + Math.floor(Math.random() * 100);
            
            // Speed increases MORE AGGRESSIVELY with each wave
            const waveSpeedMult = 1 + (state.wave - 1) * 0.35; // 35% faster per wave!
            const freezeMult = state.activePowerups.freeze ? 0.4 : 1;
            const baseDuration = 4500 / (typeConfig.speed * waveSpeedMult * freezeMult); // Faster base
            const duration = Math.max(1200, baseDuration); // Minimum 1.2s (very fast)
            
            const cart = document.createElement('div');
            cart.className = 'falling-cart ' + typeConfig.class;
            cart.innerHTML = typeConfig.emoji;
            cart.style.background = typeConfig.color;
            
            // Add value indicator (hide true nature of decoys!)
            const valueLabel = document.createElement('span');
            valueLabel.style.cssText = 'position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:10px;font-weight:700;white-space:nowrap;';
            
            if (cartType === 'bomb') {
                valueLabel.style.color = '#ff4444';
                valueLabel.textContent = '💥';
            } else if (cartType === 'megaBomb') {
                valueLabel.style.color = '#8b0000';
                valueLabel.textContent = '☢️ PERIGO';
            } else if (cartType === 'decoy') {
                // Decoy looks like a normal cart!
                valueLabel.style.color = 'white';
                valueLabel.textContent = 'R$' + Math.abs(value);
            } else if (cartType === 'ghost') {
                valueLabel.style.color = 'rgba(255,255,255,0.7)';
                valueLabel.textContent = 'R$' + value;
            } else {
                valueLabel.style.color = 'white';
                valueLabel.textContent = 'R$' + value;
            }
            cart.appendChild(valueLabel);
            
            const leftPos = Math.random() * (areaRect.width - 80) + 10;
            cart.style.left = leftPos + 'px';
            cart.style.top = '-70px';
            cart.dataset.value = value;
            cart.dataset.type = cartType;
            
            gameArea.appendChild(cart);
            
            const cartData = {
                element: cart,
                value: value,
                type: cartType,
                rescued: false,
                startTime: Date.now(),
                duration: duration,
                leftPos: leftPos,
                typeConfig: typeConfig
            };
            
            activeCarts.push(cartData);
            
            // Animate falling with special movements
            const animateCart = () => {
                if (!cart.parentNode || cartData.rescued) return;
                
                // Check if frozen
                const freezeMod = state.activePowerups.freeze ? 0.4 : 1;
                const elapsed = (Date.now() - cartData.startTime) * freezeMod;
                const progress = elapsed / cartData.duration;
                const top = -70 + (areaRect.height + 70) * progress;
                
                cart.style.top = top + 'px';
                
                // ZIGZAG MOVEMENT
                if (cartType === 'zigzag') {
                    const zigzagOffset = Math.sin(elapsed / 150) * 80; // Wide zigzag
                    const newLeft = Math.max(10, Math.min(areaRect.width - 80, leftPos + zigzagOffset));
                    cart.style.left = newLeft + 'px';
                }
                
                // GHOST VISIBILITY (handled by CSS, but add extra unpredictability)
                if (cartType === 'ghost') {
                    const phase = (elapsed / 400) % 1;
                    cart.style.opacity = phase < 0.3 ? '0.15' : phase < 0.7 ? '0.9' : '0.4';
                }
                
                // SPEEDY - add trail effect
                if (cartType === 'speedy' && elapsed % 100 < 20) {
                    cart.style.filter = 'blur(2px)';
                } else if (cartType === 'speedy') {
                    cart.style.filter = 'none';
                }
                
                if (progress >= 1) {
                    // SPLITTER - spawn 2 more carts when missed
                    if (cartType === 'splitter' && !cartData.rescued) {
                        spawnSplitCarts(leftPos);
                    }
                    loseCart(cartData);
                } else if (cart.parentNode && !cartData.rescued) {
                    requestAnimationFrame(animateCart);
                }
            };
            
            requestAnimationFrame(animateCart);
        }
        
        // Spawn split carts when splitter is missed
        function spawnSplitCarts(originalLeft) {
            const areaRect = gameArea.getBoundingClientRect();
            
            for (let i = 0; i < 2; i++) {
                const splitCart = document.createElement('div');
                splitCart.className = 'falling-cart speedy';
                splitCart.innerHTML = '🛒';
                splitCart.style.background = 'linear-gradient(135deg, #ff5722, #ff9800)';
                
                const offset = i === 0 ? -60 : 60;
                const newLeft = Math.max(10, Math.min(areaRect.width - 60, originalLeft + offset));
                splitCart.style.left = newLeft + 'px';
                splitCart.style.top = (areaRect.height * 0.6) + 'px';
                splitCart.style.width = '45px';
                splitCart.style.height = '45px';
                splitCart.style.fontSize = '22px';
                
                gameArea.appendChild(splitCart);
                
                const splitCartData = {
                    element: splitCart,
                    value: 150,
                    type: 'normal',
                    rescued: false,
                    startTime: Date.now(),
                    duration: 1800, // Fast!
                    leftPos: newLeft,
                    typeConfig: CART_TYPES.normal
                };
                
                activeCarts.push(splitCartData);
                
                const animateSplit = () => {
                    if (!splitCart.parentNode || splitCartData.rescued) return;
                    
                    const elapsed = Date.now() - splitCartData.startTime;
                    const startTop = areaRect.height * 0.6;
                    const progress = elapsed / splitCartData.duration;
                    const top = startTop + (areaRect.height * 0.4 + 70) * progress;
                    
                    splitCart.style.top = top + 'px';
                    
                    if (progress >= 1) {
                        loseCart(splitCartData);
                    } else if (splitCart.parentNode && !splitCartData.rescued) {
                        requestAnimationFrame(animateSplit);
                    }
                };
                
                setTimeout(() => requestAnimationFrame(animateSplit), i * 100);
            }
        }
        
        function spawnPowerup() {
            const areaRect = gameArea.getBoundingClientRect();
            const types = Object.keys(POWERUP_TYPES);
            const typeKey = types[Math.floor(Math.random() * types.length)];
            const typeConfig = POWERUP_TYPES[typeKey];
            
            const powerup = document.createElement('div');
            powerup.className = 'power-up ' + typeKey;
            powerup.innerHTML = typeConfig.emoji;
            powerup.dataset.type = typeKey;
            
            const leftPos = Math.random() * (areaRect.width - 60) + 10;
            powerup.style.left = leftPos + 'px';
            powerup.style.top = '-60px';
            
            gameArea.appendChild(powerup);
            
            const powerupData = {
                element: powerup,
                type: typeKey,
                collected: false,
                startTime: Date.now()
            };
            
            activePowerups.push(powerupData);
            
            // Animate falling
            const animatePowerup = () => {
                if (!powerup.parentNode || powerupData.collected) return;
                
                const elapsed = Date.now() - powerupData.startTime;
                const progress = elapsed / 4000;
                const top = -60 + (areaRect.height + 60) * progress;
                
                powerup.style.top = top + 'px';
                
                // Check collision with paddle
                const rect = powerup.getBoundingClientRect();
                if (paddleX - 45 < rect.right && paddleX + 45 > rect.left &&
                    paddleY - 45 < rect.bottom && paddleY + 45 > rect.top) {
                    collectPowerup(powerupData);
                    return;
                }
                
                if (progress >= 1) {
                    powerup.remove();
                    activePowerups = activePowerups.filter(p => p !== powerupData);
                } else if (powerup.parentNode && !powerupData.collected) {
                    requestAnimationFrame(animatePowerup);
                }
            };
            
            requestAnimationFrame(animatePowerup);
        }
        
        function collectPowerup(powerupData) {
            if (powerupData.collected) return;
            powerupData.collected = true;
            
            const typeKey = powerupData.type;
            const typeConfig = POWERUP_TYPES[typeKey];
            
            playSound('powerup');
            
            // Visual feedback
            powerupData.element.style.transform = 'scale(1.5)';
            powerupData.element.style.opacity = '0';
            setTimeout(() => powerupData.element.remove(), 300);
            
            // Handle instant power-ups (like heart)
            if (typeConfig.instant) {
                if (typeConfig.effect === 'heart') {
                    // Gain a life (max 5)
                    if (state.lives < 5) {
                        state.lives += 1;
                        updateLivesDisplay();
                        // Show floating +1 heart
                        showFloatingText('+1 ❤️', powerupData.element, '#ff69b4');
                    } else {
                        // Already max lives, give bonus points
                        state.gameScore += 500;
                        showFloatingText('+500 pts', powerupData.element, '#ffd700');
                    }
                }
            } else {
                // Apply timed power-up
                state.activePowerups[typeConfig.effect] = Date.now() + typeConfig.duration;
                
                // Show active powerup indicator
                showActivePowerup(typeKey, typeConfig);
            }
            
            // Remove from active list
            activePowerups = activePowerups.filter(p => p !== powerupData);
        }
        
        // Show floating text feedback
        function showFloatingText(text, element, color) {
            const floater = document.createElement('div');
            floater.textContent = text;
            floater.style.cssText = `
                position: absolute;
                left: ${element.offsetLeft}px;
                top: ${element.offsetTop}px;
                font-size: 18px;
                font-weight: 700;
                color: ${color};
                text-shadow: 0 0 10px ${color};
                pointer-events: none;
                z-index: 1000;
                animation: floatUp 1s ease-out forwards;
            `;
            element.parentNode.appendChild(floater);
            setTimeout(() => floater.remove(), 1000);
        }
        
        function showActivePowerup(typeKey, typeConfig) {
            const container = document.getElementById('active-powerups');
            
            const indicator = document.createElement('div');
            indicator.className = 'active-powerup';
            indicator.id = 'powerup-' + typeKey;
            indicator.innerHTML = `
                <span>${typeConfig.emoji}</span>
                <span>${typeConfig.name}</span>
                <div class="powerup-timer">
                    <div class="powerup-timer-fill" style="width: 100%"></div>
                </div>
            `;
            container.appendChild(indicator);
            
            // Animate timer
            const startTime = Date.now();
            const duration = typeConfig.duration;
            
            const updateTimer = () => {
                const elapsed = Date.now() - startTime;
                const remaining = 1 - (elapsed / duration);
                
                if (remaining <= 0) {
                    indicator.remove();
                    delete state.activePowerups[typeConfig.effect];
                } else {
                    indicator.querySelector('.powerup-timer-fill').style.width = (remaining * 100) + '%';
                    requestAnimationFrame(updateTimer);
                }
            };
            
            requestAnimationFrame(updateTimer);
        }

        function rescueCart(cartData) {
            if (cartData.rescued) return;
            
            cartData.rescued = true;
            const cart = cartData.element;
            const value = cartData.value;
            const cartType = cartData.type;
            
            // Handle bomb/decoy/megaBomb collision - all damage types
            if (cartType === 'bomb' || cartType === 'decoy' || cartType === 'megaBomb') {
                if (state.activePowerups.shield) {
                    // Shield absorbs damage (but megaBomb removes 2 lives even with shield)
                    if (cartType === 'megaBomb') {
                        state.lives--; // MegaBomb still takes 1 life through shield
                        updateLivesDisplay();
                    }
                    delete state.activePowerups.shield;
                    document.getElementById('powerup-shield')?.remove();
                    
                    // Visual feedback
                    const shieldPop = document.createElement('div');
                    shieldPop.className = 'rescue-points';
                    shieldPop.innerHTML = cartType === 'megaBomb' ? '🛡️ PARCIAL!' : '🛡️ BLOQUEADO!';
                    shieldPop.style.left = cart.style.left;
                    shieldPop.style.top = cart.style.top;
                    shieldPop.style.color = cartType === 'megaBomb' ? '#ff9800' : '#4caf50';
                    gameArea.appendChild(shieldPop);
                    setTimeout(() => shieldPop.remove(), 1000);
                    
                    if (cartType === 'megaBomb' && state.lives <= 0) {
                        gameOver();
                    }
                } else {
                    // Take damage
                    playSound('bomb');
                    screenShake();
                    
                    // MegaBomb takes 2 lives, others take 1
                    const damage = cartType === 'megaBomb' ? 2 : 1;
                    state.lives -= damage;
                    updateLivesDisplay();
                    
                    // Red flash
                    gameArea.style.boxShadow = 'inset 0 0 100px rgba(255,0,0,0.5)';
                    setTimeout(() => gameArea.style.boxShadow = '', 300);
                    
                    // Show damage popup with type-specific message
                    const damagePopup = document.createElement('div');
                    damagePopup.className = 'rescue-points';
                    
                    if (cartType === 'megaBomb') {
                        damagePopup.innerHTML = '☢️ -2 VIDAS!';
                    } else if (cartType === 'decoy') {
                        damagePopup.innerHTML = '🎭 ARMADILHA!';
                    } else {
                        damagePopup.innerHTML = '💥 -1 VIDA';
                    }
                    
                    damagePopup.style.left = cart.style.left;
                    damagePopup.style.top = cart.style.top;
                    damagePopup.style.color = cartType === 'megaBomb' ? '#8b0000' : '#ff4444';
                    damagePopup.style.fontSize = cartType === 'megaBomb' ? '28px' : '24px';
                    gameArea.appendChild(damagePopup);
                    setTimeout(() => damagePopup.remove(), 1200);
                    
                    if (state.lives <= 0) {
                        gameOver();
                    }
                }
                
                cart.style.transform = 'scale(1.5)';
                cart.style.opacity = '0';
                setTimeout(() => {
                    cart.remove();
                    activeCarts = activeCarts.filter(c => c !== cartData);
                }, 300);
                return;
            }
            
            cart.classList.add('rescued');
            
            // Play sound based on combo
            if (state.combo >= 5) {
                playSound('combo');
            } else {
                playSound('rescue');
            }
            
            // Particle burst
            const cartRect = cart.getBoundingClientRect();
            const areaRect = gameArea.getBoundingClientRect();
            createParticleBurst(cartRect.left - areaRect.left + 30, parseFloat(cart.style.top) + 30, 
                cartType === 'vip' ? '#e91e63' : cartType === 'premium' ? '#ffd700' : '#36b37e');
            
            // Paddle hit animation
            const paddleInner = gamePaddle.querySelector('.paddle-inner');
            paddleInner.classList.add('paddle-hit');
            setTimeout(() => paddleInner.classList.remove('paddle-hit'), 200);
            
            // Update combo
            const now = Date.now();
            if (now - state.lastRescueTime < 2000) {
                state.combo++;
                if (state.combo >= 5) screenShake();
            } else {
                state.combo = 1;
            }
            state.lastRescueTime = now;
            
            if (state.combo > state.maxCombo) {
                state.maxCombo = state.combo;
            }
            
            // Calculate multiplier based on combo and power-ups
            let multiplier = 1;
            if (state.combo >= 10) multiplier = 5;
            else if (state.combo >= 5) multiplier = 3;
            else if (state.combo >= 3) multiplier = 2;
            
            // Double multiplier power-up
            if (state.activePowerups.multiplier) multiplier *= 2;
            
            const finalPoints = value * multiplier;
            
            // Add points popup
            const points = document.createElement('div');
            points.className = 'rescue-points';
            points.innerHTML = `+${finalPoints}` + (multiplier > 1 ? ` <small style="font-size:14px">x${multiplier}</small>` : '');
            points.style.left = cart.style.left;
            points.style.top = cart.style.top;
            if (cartType === 'vip') points.style.color = '#e91e63';
            else if (cartType === 'premium') points.style.color = '#ffd700';
            gameArea.appendChild(points);
            
            setTimeout(() => points.remove(), 1000);
            setTimeout(() => {
                cart.remove();
                activeCarts = activeCarts.filter(c => c !== cartData);
            }, 500);
            
            state.gameScore += finalPoints;
            state.cartsRescued += 1;
            state.totalGMV += value;
            
            // Reset combo timeout
            clearTimeout(comboTimeout);
            comboTimeout = setTimeout(() => {
                state.combo = 0;
                updateGameStats();
            }, 2500);
            
            updateGameStats();
        }

        function loseCart(cartData) {
            if (cartData.rescued) return;
            
            const cart = cartData.element;
            const cartType = cartData.type;
            
            // Bombs that fall through don't hurt you
            if (cartType === 'bomb') {
                cart.style.opacity = '0';
                setTimeout(() => {
                    cart.remove();
                    activeCarts = activeCarts.filter(c => c !== cartData);
                }, 300);
                return;
            }
            
            cart.style.opacity = '0.3';
            cart.style.transform = 'scale(0.8)';
            
            // Red flash effect
            screenShake();
            
            setTimeout(() => {
                cart.remove();
                activeCarts = activeCarts.filter(c => c !== cartData);
            }, 300);
            
            state.cartsLost += 1;
            state.combo = 0; // Reset combo on miss
            
            // Lose life when cart escapes
            state.lives--;
            updateLivesDisplay();
            
            // Show life lost message
            const lostMsg = document.createElement('div');
            lostMsg.className = 'rescue-points';
            lostMsg.innerHTML = '💔 -1 VIDA';
            lostMsg.style.left = cart.style.left;
            lostMsg.style.top = (parseFloat(cart.style.top) - 30) + 'px';
            lostMsg.style.color = '#ff4444';
            gameArea.appendChild(lostMsg);
            setTimeout(() => lostMsg.remove(), 1000);
            
            if (state.lives <= 0) {
                gameOver();
            }
            
            updateGameStats();
        }
        
        function gameOver() {
            state.gameRunning = false;
            clearInterval(state.gameInterval);
            clearTimeout(state.waveTimeout);
            
            playSound('gameover');
            
            // Update game over screen
            document.getElementById('final-wave').textContent = state.wave;
            document.getElementById('final-score').textContent = state.gameScore.toLocaleString('pt-BR');
            document.getElementById('final-rescued').textContent = state.cartsRescued;
            document.getElementById('final-max-combo').textContent = state.maxCombo + 'x';
            document.getElementById('final-gmv').textContent = 'R$ ' + state.totalGMV.toLocaleString('pt-BR');
            
            // Reset form state
            document.getElementById('ranking-form').style.display = 'block';
            document.getElementById('ranking-success').style.display = 'none';
            document.getElementById('game-over-buttons').style.display = 'none';
            document.getElementById('ranking-error').style.display = 'none';
            document.getElementById('player-name').value = '';
            document.getElementById('player-email').value = '';
            document.getElementById('player-brand').value = '';
            
            // Show game over overlay
            document.getElementById('game-over-overlay').classList.add('visible');
            
            // Focus on name input
            setTimeout(() => {
                document.getElementById('player-name').focus();
            }, 500);
            
            // Hide paddle
            gamePaddle.style.display = 'none';
        }
        
        // COMPREHENSIVE Profanity filter - blocks inappropriate content
        const BLOCKED_WORDS = [
            // === PORTUGUESE PROFANITY & SLANG ===
            'porra', 'caralho', 'merda', 'foda', 'fodase', 'fodasse', 'foder', 'puta', 'putaria',
            'viado', 'viadu', 'bicha', 'bichona', 'cuzao', 'cuzão', 'cu', 'cuzinho',
            'arrombado', 'arrombada', 'otario', 'otário', 'otaria', 'buceta', 'xoxota', 'xana',
            'piroca', 'pica', 'cacete', 'desgraça', 'desgraçado', 'vagabundo', 'vagabunda',
            'vadia', 'vadio', 'safado', 'safada', 'corno', 'cornudo', 'corna',
            'bosta', 'bostinha', 'cocô', 'cagar', 'cagado', 'mijado', 'mijar',
            'putinha', 'putão', 'putona', 'puteiro', 'prostituta', 'prostituto',
            'babaca', 'idiota', 'imbecil', 'retardado', 'retardada', 'mongoloide',
            'lazarento', 'maldito', 'maldita', 'inferno', 'diabo', 'demonio', 'demônio',
            'filho da puta', 'filha da puta', 'filhodaputa', 'fdp', 'pqp', 'vsf', 'tnc', 
            'krl', 'pnc', 'vtnc', 'tmj', 'lixo', 'escoria', 'escória', 'nojento', 'nojenta',
            
            // === SEXUAL TERMS (PT) ===
            'penis', 'pênis', 'pinto', 'pintinho', 'rola', 'roludo', 'pau', 'pauzudo', 'pauzao',
            'vagina', 'pepeka', 'ppk', 'xereca', 'perseguida', 'periquita', 'rachada',
            'testiculo', 'testículo', 'saco', 'bolas', 'ovo', 'ovos', 'culhao', 'culhão',
            'seio', 'seios', 'peito', 'peitos', 'teta', 'tetas', 'mamilo', 'mama',
            'bunda', 'bundao', 'bundão', 'bunduda', 'rabo', 'traseiro', 'popozuda',
            'sexo', 'transar', 'trepar', 'fudendo', 'comendo', 'mamando', 'chupando',
            'gozar', 'gozando', 'gozada', 'ejacular', 'orgasmo', 'tesao', 'tesão',
            'punheta', 'siririca', 'masturbando', 'masturbar', 'masturba',
            'anal', 'oral', 'boquete', 'chupar', 'engolir', 'cuspir',
            'safadeza', 'sacanagem', 'putaria', 'suruba', 'orgia', 'swing',
            'fetiche', 'bdsm', 'dominadora', 'submissa', 'escravo', 'escrava',
            'stripper', 'striptease', 'garota de programa', 'gp', 'acompanhante',
            'pornô', 'porno', 'xvideos', 'pornhub', 'xhamster', 'redtube',
            
            // === PREJUDICIAL & DISCRIMINATORY (PT) ===
            'preto', 'preta', 'nego', 'nega', 'crioulo', 'crioula', 'macaco', 'macaca',
            'favelado', 'favelada', 'pobre', 'pobretao', 'mendigo', 'mendiga', 'vagal',
            'gordo', 'gorda', 'gordola', 'baleia', 'porco', 'porca', 'elefante',
            'aleijado', 'aleijada', 'deficiente', 'manco', 'cego', 'surdo', 'mudo',
            'gay', 'lesbica', 'lésbica', 'sapatao', 'sapatão', 'travesti', 'traveco',
            'transsexual', 'transexual', 'hermafrodita', 'afeminado', 'afeminada',
            'judeu', 'judia', 'nazista', 'nazi', 'hitler', 'fascista', 'comunista',
            'terrorista', 'muçulmano', 'arabe', 'árabe', 'indio', 'índio', 'indigena',
            'chinês', 'japones', 'coreano', 'amarelo', 'amarela', 'olho puxado',
            'nordestino', 'baiano', 'paraiba', 'paraíba', 'cearense', 'sulista',
            
            // === ENGLISH PROFANITY ===
            'fuck', 'fucker', 'fucking', 'fucked', 'motherfucker', 'mf',
            'shit', 'shitty', 'bullshit', 'horseshit', 'dipshit',
            'ass', 'asshole', 'arse', 'arsehole', 'butthole', 'butt',
            'bitch', 'bitchy', 'bitches', 'son of a bitch', 'sob',
            'dick', 'dickhead', 'dicks', 'cock', 'cocks', 'cocksucker',
            'pussy', 'pussies', 'cunt', 'cunts', 'twat', 'twats',
            'bastard', 'bastards', 'whore', 'whores', 'slut', 'sluts', 'hoe', 'ho',
            'damn', 'dammit', 'goddamn', 'hell', 'hellhole',
            
            // === ENGLISH SEXUAL ===
            'penis', 'penises', 'vagina', 'vaginas', 'testicle', 'testicles', 'scrotum',
            'boob', 'boobs', 'tit', 'tits', 'titty', 'titties', 'nipple', 'nipples',
            'sex', 'sexy', 'sexual', 'orgasm', 'cum', 'cumming', 'cumshot', 'jizz',
            'masturbate', 'masturbation', 'jerk off', 'jack off', 'wank', 'wanker',
            'blowjob', 'handjob', 'rimjob', 'fingering', 'dildo', 'vibrator',
            'porn', 'porno', 'pornography', 'xxx', 'nsfw', 'nude', 'nudes', 'naked',
            'stripper', 'escort', 'hooker', 'prostitute',
            
            // === ENGLISH PREJUDICIAL ===
            'nigger', 'nigga', 'negro', 'spic', 'chink', 'gook', 'jap', 'wetback',
            'beaner', 'cracker', 'honky', 'whitey', 'redneck', 'hillbilly',
            'faggot', 'fag', 'homo', 'queer', 'dyke', 'tranny', 'shemale',
            'retard', 'retarded', 'tard', 'spaz', 'spastic', 'cripple',
            'kike', 'hebe', 'jew', 'gypsy', 'raghead', 'towelhead', 'terrorist',
            
            // === SPAM/MALICIOUS PATTERNS ===
            'http', 'https', 'www.', '.com', '.br', '.net', '.org', 'bit.ly', 'tinyurl',
            'script', 'onclick', 'javascript', 'onerror', 'onload',
            '<', '>', 'iframe', 'eval(', 'alert(', 'document.', 'window.', 'cookie',
            
            // === COMMON FAKE/TEST ENTRIES ===
            'teste', 'test', 'testing', 'asdf', 'qwer', 'zxcv', 'aaa', 'bbb', 'ccc',
            '123', '1234', '12345', '123456', 'abcd', 'admin', 'null', 'undefined',
            'lorem', 'ipsum', 'foo', 'bar', 'blah', 'aaaa', 'bbbb', 'sample'
        ];
        
        // Normalize text for comparison (remove accents, spaces, leetspeak)
        function normalizeText(text) {
            if (!text) return '';
            return text
                .toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // Remove accents
                .replace(/\s+/g, '') // Remove spaces
                .replace(/0/g, 'o').replace(/1/g, 'i').replace(/3/g, 'e')
                .replace(/4/g, 'a').replace(/5/g, 's').replace(/7/g, 't')
                .replace(/8/g, 'b').replace(/@/g, 'a').replace(/\$/g, 's')
                .replace(/[!1|]/g, 'i').replace(/[*]/g, '');
        }
        
        function containsProfanity(text) {
            if (!text) return false;
            
            const normalizedText = normalizeText(text);
            const originalLower = text.toLowerCase().replace(/\s+/g, '');
            
            for (const word of BLOCKED_WORDS) {
                const normalizedWord = normalizeText(word);
                // Check both original and normalized versions
                if (normalizedText.includes(normalizedWord) || originalLower.includes(word.toLowerCase())) {
                    return true;
                }
            }
            
            // Check for repeated characters (spam) - 3+ repetitions
            if (/(.)\1{2,}/.test(text.replace(/\s/g, ''))) return true;
            
            // Check for excessive special characters
            const specialChars = (text.match(/[^a-zA-ZÀ-ÿ0-9\s]/g) || []).length;
            if (specialChars > text.length * 0.25) return true;
            
            // Check for suspicious patterns (all consonants, no vowels)
            const vowels = (text.match(/[aeiouáéíóúâêîôûãõ]/gi) || []).length;
            if (text.length > 4 && vowels === 0) return true;
            
            return false;
        }
        
        function sanitizeInput(text) {
            if (!text) return '';
            // Remove HTML tags and dangerous characters
            return text
                .replace(/<[^>]*>/g, '')
                .replace(/[<>\"\'`;]/g, '')
                .trim()
                .substring(0, 50);
        }
        
        // ============================================
        // GLOBAL RANKING SYSTEM (LIVE)
        // ============================================
        const GLOBAL_RANKING_KEY = 'nuvemshop-global-ranking-v1';
        const OLD_RANKING_KEY = 'nuvemshop-game-rankings'; // Historical data key
        const MIGRATION_FLAG_KEY = 'nuvemshop-ranking-migrated-v1';
        let globalRankingUpdateInterval = null;
        let lastGlobalRankingUpdate = Date.now();
        let lastPlayerAdded = null; // Track last player added to highlight them

        // Migrate historical ranking data to global ranking
        function migrateHistoricalRankingData() {
            // Check if already migrated
            if (localStorage.getItem(MIGRATION_FLAG_KEY)) {
                return;
            }
            
            const globalRanking = JSON.parse(localStorage.getItem(GLOBAL_RANKING_KEY) || '[]');
            const existingPlayers = new Set();
            
            // Create set of existing players (name + score) to avoid duplicates
            globalRanking.forEach(player => {
                existingPlayers.add(`${player.name}|${player.score}`);
            });
            
            let migratedCount = 0;
            const possibleKeys = [
                'nuvemshop-game-rankings',
                'game-rankings',
                'ranking-data',
                'player-rankings'
            ];
            
            // Try to find historical data in different possible keys
            for (const key of possibleKeys) {
                try {
                    const historicalData = localStorage.getItem(key);
                    if (historicalData) {
                        const historicalRanking = JSON.parse(historicalData);
                        
                        if (Array.isArray(historicalRanking) && historicalRanking.length > 0) {
                            historicalRanking.forEach(player => {
                                // Validate player data
                                if (player && player.name && typeof player.score === 'number') {
                                    const playerKey = `${player.name}|${player.score}`;
                                    
                                    // Only add if not already in global ranking
                                    if (!existingPlayers.has(playerKey)) {
                                        // Normalize player data structure
                                        const normalizedPlayer = {
                                            name: player.name,
                                            email: player.email || null,
                                            brand: player.brand || player.store || null,
                                            score: player.score,
                                            wave: player.wave || null,
                                            rescued: player.rescued || null,
                                            maxCombo: player.maxCombo || null,
                                            gmv: player.gmv || null,
                                            date: player.date || new Date(Date.now() - Math.random() * 86400000 * 30).toISOString() // Random date in last 30 days
                                        };
                                        
                                        globalRanking.push(normalizedPlayer);
                                        existingPlayers.add(playerKey);
                                        migratedCount++;
                                    }
                                }
                            });
                        }
                    }
                } catch (e) {
                    console.warn(`Failed to migrate data from ${key}:`, e);
                }
            }
            
            // Also check for any localStorage keys that might contain ranking data
            try {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.includes('ranking') || key.includes('leaderboard') || key.includes('game'))) {
                        // Skip if it's the global ranking key or migration flag
                        if (key === GLOBAL_RANKING_KEY || key === MIGRATION_FLAG_KEY) continue;
                        
                        try {
                            const data = localStorage.getItem(key);
                            if (data && data.startsWith('[')) {
                                const parsed = JSON.parse(data);
                                if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].score !== undefined) {
                                    parsed.forEach(player => {
                                        if (player && player.name && typeof player.score === 'number') {
                                            const playerKey = `${player.name}|${player.score}`;
                                            if (!existingPlayers.has(playerKey)) {
                                                const normalizedPlayer = {
                                                    name: player.name,
                                                    email: player.email || null,
                                                    brand: player.brand || player.store || null,
                                                    score: player.score,
                                                    wave: player.wave || null,
                                                    rescued: player.rescued || null,
                                                    maxCombo: player.maxCombo || null,
                                                    gmv: player.gmv || null,
                                                    date: player.date || new Date(Date.now() - Math.random() * 86400000 * 30).toISOString()
                                                };
                                                globalRanking.push(normalizedPlayer);
                                                existingPlayers.add(playerKey);
                                                migratedCount++;
                                            }
                                        }
                                    });
                                }
                            }
                        } catch (e) {
                            // Skip invalid data
                        }
                    }
                }
            } catch (e) {
                console.warn('Error scanning localStorage:', e);
            }
            
            // Sort and save if we found any historical data
            if (migratedCount > 0) {
                globalRanking.sort((a, b) => b.score - a.score);
                const top100 = globalRanking.slice(0, 100);
                localStorage.setItem(GLOBAL_RANKING_KEY, JSON.stringify(top100));
                console.log(`✅ Migrated ${migratedCount} historical players to global ranking`);
            }
            
            // Mark as migrated
            localStorage.setItem(MIGRATION_FLAG_KEY, 'true');
        }

        // Force add specific players that should be in ranking
        function ensureSpecificPlayers() {
            let ranking = JSON.parse(localStorage.getItem(GLOBAL_RANKING_KEY) || '[]');
            let updated = false;
            
            // List of players that must be in ranking
            // NOTE: If the score is wrong, you can update it using: updatePlayerScore("Lombo @lombo CRIA 44.411", NEW_SCORE)
            const requiredPlayers = [
                {
                    name: 'Lombo @lombo CRIA 44.411',
                    brand: 'CRIA 44.411',
                    score: 44411, // Default score - can be updated via updatePlayerScore() function
                    wave: 10,
                    rescued: 500,
                    maxCombo: 15,
                    date: new Date(Date.now() - 86400000).toISOString() // 1 day ago
                }
            ];
            
            requiredPlayers.forEach(requiredPlayer => {
                // Check if player exists (by name match, case insensitive, or partial match)
                const exists = ranking.some(p => {
                    if (!p || !p.name) return false;
                    const pName = p.name.toLowerCase().trim();
                    const rName = requiredPlayer.name.toLowerCase().trim();
                    // Exact match or contains both "lombo" and "cria"
                    return pName === rName || 
                           (pName.includes('lombo') && pName.includes('cria')) ||
                           (pName.includes('lombo') && pName.includes('44'));
                });
                
                if (!exists) {
                    ranking.push(requiredPlayer);
                    updated = true;
                    console.log(`✅ Added required player: ${requiredPlayer.name} with score ${requiredPlayer.score}`);
                } else {
                    console.log(`ℹ️ Player "${requiredPlayer.name}" already exists in ranking`);
                }
            });
            
            if (updated) {
                ranking.sort((a, b) => (b.score || 0) - (a.score || 0));
                const top100 = ranking.slice(0, 100);
                localStorage.setItem(GLOBAL_RANKING_KEY, JSON.stringify(top100));
                updateGlobalLeaderboard(false);
                console.log('✅ Ranking updated with required players');
            }
            
            return ranking;
        }

        // Force add Lombo player (more aggressive)
        function forceAddLombo() {
            console.log('🔧 Force adding Lombo player...');
            let ranking = JSON.parse(localStorage.getItem(GLOBAL_RANKING_KEY) || '[]');
            
            // Remove any existing Lombo entries first
            ranking = ranking.filter(p => {
                if (!p || !p.name) return true;
                const name = p.name.toLowerCase();
                return !(name.includes('lombo') && name.includes('cria'));
            });
            
            // Add Lombo player
            const lomboPlayer = {
                name: 'Lombo @lombo CRIA 44.411',
                brand: 'CRIA 44.411',
                score: 44411,
                wave: 10,
                rescued: 500,
                maxCombo: 15,
                date: new Date(Date.now() - 86400000).toISOString()
            };
            
            ranking.push(lomboPlayer);
            ranking.sort((a, b) => (b.score || 0) - (a.score || 0));
            const top100 = ranking.slice(0, 100);
            localStorage.setItem(GLOBAL_RANKING_KEY, JSON.stringify(top100));
            
            updateGlobalLeaderboard(false);
            
            const position = ranking.findIndex(p => p.name === lomboPlayer.name) + 1;
            console.log(`✅ Lombo player force-added! Position: #${position}`);
            console.log('📊 Current ranking:', ranking.slice(0, 10).map((p, i) => `${i+1}. ${p.name} - ${p.score}`));
            
            return ranking;
        }

        // Get or initialize global ranking
        function getGlobalRanking() {
            // First, try to migrate historical data
            migrateHistoricalRankingData();
            
            let ranking = JSON.parse(localStorage.getItem(GLOBAL_RANKING_KEY) || '[]');
            
            // Ensure specific players are in ranking
            ensureSpecificPlayers();
            
            // Re-read after ensuring players
            ranking = JSON.parse(localStorage.getItem(GLOBAL_RANKING_KEY) || '[]');
            
            // Initialize with some default players if empty (including Lombo)
            if (ranking.length === 0) {
                ranking = [
                    { name: 'Lombo @lombo CRIA 44.411', brand: 'CRIA 44.411', score: 44411, wave: 10, rescued: 500, maxCombo: 15, date: new Date(Date.now() - 86400000).toISOString() },
                    { name: 'Ana Silva', brand: 'Moda Elegance', score: 15420, wave: 8, rescued: 342, date: new Date(Date.now() - 3600000).toISOString() },
                    { name: 'Carlos Mendes', brand: 'TechStore BR', score: 12350, wave: 7, rescued: 298, date: new Date(Date.now() - 7200000).toISOString() },
                    { name: 'Julia Santos', brand: 'Beauty Box', score: 11890, wave: 6, rescued: 287, date: new Date(Date.now() - 10800000).toISOString() },
                    { name: 'Roberto Lima', brand: 'Casa Decor', score: 9540, wave: 5, rescued: 234, date: new Date(Date.now() - 14400000).toISOString() },
                    { name: 'Maria Oliveira', brand: 'Pet Paradise', score: 8720, wave: 5, rescued: 221, date: new Date(Date.now() - 18000000).toISOString() }
                ];
                ranking.sort((a, b) => (b.score || 0) - (a.score || 0));
                localStorage.setItem(GLOBAL_RANKING_KEY, JSON.stringify(ranking));
            }
            
            return ranking;
        }

        // Add player to global ranking
        function addToGlobalRanking(playerEntry) {
            let ranking = getGlobalRanking();
            
            // Add new entry
            ranking.push(playerEntry);
            
            // Sort by score descending
            ranking.sort((a, b) => b.score - a.score);
            
            // Keep only top 100
            ranking = ranking.slice(0, 100);
            
            // Save to "global" storage
            localStorage.setItem(GLOBAL_RANKING_KEY, JSON.stringify(ranking));
            
            return ranking;
        }

        // Manual function to add a player directly (for fixing missing players)
        function addPlayerManually(name, score, brand = null, email = null, wave = null, rescued = null, maxCombo = null, gmv = null) {
            const playerEntry = {
                name: name,
                email: email || null,
                brand: brand || null,
                score: score,
                wave: wave || null,
                rescued: rescued || null,
                maxCombo: maxCombo || null,
                gmv: gmv || null,
                date: new Date().toISOString()
            };
            
            const updatedRanking = addToGlobalRanking(playerEntry);
            updateGlobalLeaderboard(false);
            
            const position = updatedRanking.findIndex(p => p.name === name && p.score === score) + 1;
            console.log(`✅ Player "${name}" with score ${score} added to ranking. Position: #${position}`);
            
            return updatedRanking;
        }

        // Debug function to search for players in localStorage
        function searchPlayerInStorage(searchTerm) {
            console.log('🔍 Searching for players containing:', searchTerm);
            const results = [];
            
            // Search in global ranking
            const globalRanking = JSON.parse(localStorage.getItem(GLOBAL_RANKING_KEY) || '[]');
            globalRanking.forEach((player, index) => {
                if (player.name && player.name.toLowerCase().includes(searchTerm.toLowerCase())) {
                    results.push({ source: 'global-ranking', position: index + 1, player });
                }
            });
            
            // Search in all localStorage keys
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.includes('ranking') || key.includes('game') || key.includes('player'))) {
                    try {
                        const data = localStorage.getItem(key);
                        if (data && data.startsWith('[')) {
                            const parsed = JSON.parse(data);
                            if (Array.isArray(parsed)) {
                                parsed.forEach((player, index) => {
                                    if (player && player.name && player.name.toLowerCase().includes(searchTerm.toLowerCase())) {
                                        results.push({ source: key, position: index + 1, player });
                                    }
                                });
                            }
                        }
                    } catch (e) {
                        // Skip invalid data
                    }
                }
            }
            
            if (results.length > 0) {
                console.log(`✅ Found ${results.length} result(s):`, results);
                return results;
            } else {
                console.log('❌ No players found with that name');
                return [];
            }
        }

        // Update player score if exists
        function updatePlayerScore(playerName, newScore) {
            let ranking = getGlobalRanking();
            const playerIndex = ranking.findIndex(p => {
                const pName = (p.name || '').toLowerCase();
                const searchName = (playerName || '').toLowerCase();
                return pName === searchName || (pName.includes('lombo') && pName.includes('cria'));
            });
            
            if (playerIndex >= 0) {
                ranking[playerIndex].score = newScore;
                ranking.sort((a, b) => b.score - a.score);
                localStorage.setItem(GLOBAL_RANKING_KEY, JSON.stringify(ranking));
                updateGlobalLeaderboard(false);
                const newPosition = ranking.findIndex(p => p.name === ranking[playerIndex].name) + 1;
                console.log(`✅ Updated ${playerName} score to ${newScore}. New position: #${newPosition}`);
                return true;
            } else {
                console.log(`❌ Player "${playerName}" not found in ranking`);
                return false;
            }
        }

        // Make functions available globally for console access
        window.addPlayerManually = addPlayerManually;
        window.searchPlayerInStorage = searchPlayerInStorage;
        window.updatePlayerScore = updatePlayerScore;
        window.ensureSpecificPlayers = ensureSpecificPlayers;
        window.forceAddLombo = forceAddLombo;

        // Simulate new players joining (for live effect)
        function simulateNewGlobalPlayers() {
            const names = CONFIG.brazilianNames.firstNames;
            const lastNames = CONFIG.brazilianNames.lastNames;
            const stores = CONFIG.storeNames;
            
            // Random chance to add a new player (5% chance every update)
            if (Math.random() < 0.05) {
                const firstName = names[Math.floor(Math.random() * names.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const storeName = stores[Math.floor(Math.random() * stores.length)];
                
                const newPlayer = {
                    name: `${firstName} ${lastName}`,
                    brand: storeName,
                    score: Math.floor(Math.random() * 15000) + 1000,
                    wave: Math.floor(Math.random() * 8) + 1,
                    rescued: Math.floor(Math.random() * 300) + 50,
                    date: new Date().toISOString()
                };
                
                let ranking = getGlobalRanking();
                ranking.push(newPlayer);
                ranking.sort((a, b) => b.score - a.score);
                ranking = ranking.slice(0, 100);
                localStorage.setItem(GLOBAL_RANKING_KEY, JSON.stringify(ranking));
                
                // Update display with animation
                updateGlobalLeaderboard(true);
            }
        }

        // Start live ranking updates
        function startGlobalRankingUpdates() {
            if (globalRankingUpdateInterval) return;
            
            // Update every 3-5 seconds
            globalRankingUpdateInterval = setInterval(() => {
                simulateNewGlobalPlayers();
                updateGlobalLeaderboard(false);
            }, 3000 + Math.random() * 2000);
        }

        // Stop live ranking updates
        function stopGlobalRankingUpdates() {
            if (globalRankingUpdateInterval) {
                clearInterval(globalRankingUpdateInterval);
                globalRankingUpdateInterval = null;
            }
        }

        function submitToRanking() {
            const nameInput = document.getElementById('player-name');
            const emailInput = document.getElementById('player-email');
            const brandInput = document.getElementById('player-brand');
            const submitBtn = document.getElementById('ranking-submit');
            const errorDiv = document.getElementById('ranking-error');
            
            const name = sanitizeInput(nameInput.value);
            const email = emailInput.value.trim();
            const brand = sanitizeInput(brandInput.value);
            
            // Hide previous errors
            errorDiv.style.display = 'none';
            
            // Validate inputs
            if (!name) {
                nameInput.style.borderColor = '#ff4444';
                nameInput.focus();
                return;
            }
            
            if (!email || !email.includes('@') || !email.includes('.')) {
                emailInput.style.borderColor = '#ff4444';
                emailInput.focus();
                return;
            }
            
            // Check for profanity/malicious content
            if (containsProfanity(name)) {
                errorDiv.textContent = '⚠️ O nome contém palavras não permitidas. Por favor, use outro nome.';
                errorDiv.style.display = 'block';
                nameInput.style.borderColor = '#ff4444';
                nameInput.focus();
                return;
            }
            
            if (containsProfanity(brand)) {
                errorDiv.textContent = '⚠️ O nome da marca contém palavras não permitidas. Por favor, use outro nome.';
                errorDiv.style.display = 'block';
                brandInput.style.borderColor = '#ff4444';
                brandInput.focus();
                return;
            }
            
            // Validate email domain (basic check for fake emails)
            const emailDomain = email.split('@')[1];
            if (!emailDomain || emailDomain.length < 3 || !emailDomain.includes('.')) {
                errorDiv.textContent = '⚠️ Por favor, insira um email válido.';
                errorDiv.style.display = 'block';
                emailInput.style.borderColor = '#ff4444';
                emailInput.focus();
                return;
            }
            
            // Reset border colors
            nameInput.style.borderColor = '';
            emailInput.style.borderColor = '';
            brandInput.style.borderColor = '';
            
            // Disable button while saving
            submitBtn.disabled = true;
            submitBtn.textContent = 'Salvando...';
            
            // Create player entry
            const playerEntry = {
                name: name,
                email: email,
                brand: brand || null,
                score: state.gameScore,
                wave: state.wave,
                rescued: state.cartsRescued,
                maxCombo: state.maxCombo,
                gmv: state.totalGMV,
                date: new Date().toISOString()
            };
            
            // Add to GLOBAL ranking
            const updatedRanking = addToGlobalRanking(playerEntry);
            
            // Store player name to highlight them
            lastPlayerAdded = name;
            
            // Find player's position in ranking
            const playerPosition = updatedRanking.findIndex(p => p.name === name && p.score === state.gameScore) + 1;
            
            // Update leaderboard display IMMEDIATELY with animation
            updateGlobalLeaderboard(true);
            
            // Scroll to player position if they're in top 10
            if (playerPosition <= 10) {
                setTimeout(() => {
                    const leaderboardList = document.getElementById('leaderboard-list');
                    if (leaderboardList) {
                        const playerItem = leaderboardList.children[playerPosition - 1];
                        if (playerItem) {
                            playerItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                }, 100);
            }
            
            // Update success message with position
            const successMsg = document.getElementById('ranking-success');
            if (successMsg) {
                if (playerPosition <= 10) {
                    successMsg.innerHTML = `✅ Você entrou no ranking global! <strong>#${playerPosition}</strong> 🎉`;
                } else {
                    successMsg.innerHTML = `✅ Você foi adicionado ao ranking global! <br><small>Posição: #${playerPosition}</small>`;
                }
            }
            
            // Simulate slight delay for UX
            setTimeout(() => {
                // Hide form, show success message and buttons
                document.getElementById('ranking-form').style.display = 'none';
                document.getElementById('ranking-success').style.display = 'block';
                document.getElementById('game-over-buttons').style.display = 'flex';
                
                // Reset button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Salvar no Ranking';
                
                // Clear highlight after 5 seconds
                setTimeout(() => {
                    lastPlayerAdded = null;
                    updateGlobalLeaderboard(false);
                }, 5000);
            }, 300);
        }
        
        function skipRanking() {
            // Hide form and show buttons directly
            document.getElementById('ranking-form').style.display = 'none';
            document.getElementById('game-over-buttons').style.display = 'flex';
        }
        
        // Update global leaderboard display
        function updateGlobalLeaderboard(showNewPlayerAnimation = false) {
            const rankings = getGlobalRanking();
            
            // Get top 10 for display
            const topPlayers = rankings.slice(0, 10);
            
            const leaderboardList = document.getElementById('leaderboard-list');
            if (!leaderboardList) return;
            
            // Store current top player names to detect new entries
            const currentTopNames = Array.from(leaderboardList.children).map(item => {
                const nameEl = item.querySelector('.lb-name');
                return nameEl ? nameEl.textContent.replace(/<small[^>]*>.*?<\/small>/g, '').trim() : null;
            }).filter(Boolean);
            
            leaderboardList.innerHTML = '';
            
            topPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                const isNewPlayer = showNewPlayerAnimation && !currentTopNames.includes(player.name);
                const isJustAdded = lastPlayerAdded && player.name === lastPlayerAdded;
                item.className = 'leaderboard-item' + 
                    (index < 3 ? ' top-3' : '') + 
                    (isNewPlayer ? ' new-player' : '') +
                    (isJustAdded ? ' just-added' : '');
                
                const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : (index + 1);
                const displayName = player.brand ? `${player.name} <small style="opacity:0.7">@ ${player.brand}</small>` : player.name;
                const waveDisplay = player.wave ? `<span class="lb-wave">🌊${player.wave}</span>` : '';
                const justAddedBadge = isJustAdded ? '<span class="just-added-badge">✨ VOCÊ!</span>' : '';
                
                item.innerHTML = `
                    <span class="lb-rank">${medal}</span>
                    <span class="lb-name">${displayName} ${justAddedBadge}</span>
                    ${waveDisplay}
                    <span class="lb-score">${player.score.toLocaleString('pt-BR')}</span>
                `;
                
                leaderboardList.appendChild(item);
            });
            
            // If no rankings yet, show placeholder
            if (topPlayers.length === 0) {
                leaderboardList.innerHTML = '<div style="text-align: center; color: var(--neutral-text-low); padding: 20px; font-size: 13px;">Seja o primeiro a entrar no ranking!</div>';
            }
        }
        
        // Keep old function name for compatibility
        function updateLeaderboardFromStorage() {
            updateGlobalLeaderboard(false);
        }
        
        function playAgain() {
            resetGame();
            setTimeout(startGame, 300);
        }
        
        function shareScore() {
            const text = `🛒 CAÇA AOS CARRINHOS 🛒
━━━━━━━━━━━━━━━━━━━━━━
🏆 Pontuação: ${state.gameScore.toLocaleString('pt-BR')} pts
🛒 Carrinhos: ${state.cartsRescued} resgatados
🔥 Maior Combo: ${state.maxCombo}x
🌊 Ondas: ${state.wave} sobrevividas
💰 GMV: R$ ${state.totalGMV.toLocaleString('pt-BR')}
━━━━━━━━━━━━━━━━━━━━━━
Consegue me superar?
${window.location.href}`;

            if (navigator.share) {
                navigator.share({
                    title: 'Caça aos Carrinhos - Nuvemshop',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Resultado copiado para a área de transferência!');
                });
            }
        }

        function updateGameStats() {
            document.getElementById('game-score').textContent = state.gameScore.toLocaleString('pt-BR');
            document.getElementById('carts-rescued').textContent = state.cartsRescued;
            document.getElementById('carts-lost').textContent = state.cartsLost;
            
            // Update combo display
            const comboValue = document.getElementById('combo-value');
            const comboMultiplier = document.getElementById('combo-multiplier');
            
            if (comboValue) {
                comboValue.textContent = state.combo;
                comboValue.classList.remove('hot', 'fire');
                if (state.combo >= 10) comboValue.classList.add('fire');
                else if (state.combo >= 5) comboValue.classList.add('hot');
            }
            
            if (comboMultiplier) {
                let mult = 1;
                if (state.combo >= 10) mult = 5;
                else if (state.combo >= 5) mult = 3;
                else if (state.combo >= 3) mult = 2;
                
                comboMultiplier.textContent = 'x' + mult;
                comboMultiplier.classList.remove('x3', 'x5');
                if (mult >= 5) comboMultiplier.classList.add('x5');
                else if (mult >= 3) comboMultiplier.classList.add('x3');
            }
            
            // Update success rate
            const successRate = document.getElementById('success-rate');
            if (successRate) {
                const total = state.cartsRescued + state.cartsLost;
                const rate = total > 0 ? Math.round((state.cartsRescued / total) * 100) : 0;
                successRate.textContent = rate + '%';
            }
            
            // Update max combo
            const maxCombo = document.getElementById('max-combo');
            if (maxCombo) {
                maxCombo.textContent = state.maxCombo;
            }
        }

        function loadInitialLeaderboard() {
            // Load global ranking
            updateGlobalLeaderboard(false);
            
            // Start live updates when game view is active
            if (state.currentView === 'game') {
                startGlobalRankingUpdates();
            }
        }
        
        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            
            CONFIG.leaderboard.forEach((player, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : 'default';
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.innerHTML = `
                    <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${player.name}</div>
                        <div class="leaderboard-store">${player.store}</div>
                    </div>
                    <div class="leaderboard-score">${player.score.toLocaleString('pt-BR')}</div>
                `;
                list.appendChild(item);
            });
        }

        function clearRankingHistory() {
            if (confirm('Tem certeza que deseja apagar todo o histórico do ranking GLOBAL?')) {
                localStorage.removeItem(GLOBAL_RANKING_KEY);
                // Reinitialize with default players
                getGlobalRanking();
                updateGlobalLeaderboard(false);
                alert('Histórico do ranking global apagado com sucesso!');
            }
        }

        // ============================================
        // STATS VIEW
        // ============================================
        function renderSegmentBreakdown() {
            const container = document.getElementById('segment-breakdown');
            container.innerHTML = '';
            
            Object.entries(CONFIG.segments).forEach(([key, segment]) => {
                const row = document.createElement('div');
                row.className = 'segment-row';
                row.innerHTML = `
                    <div class="segment-color" style="background: ${segment.color}"></div>
                    <div class="segment-name">${segment.name}</div>
                    <div class="segment-value">${segment.percent}%</div>
                    <div class="segment-bar-container">
                        <div class="segment-bar-fill" style="width: ${segment.percent * 3}%; background: ${segment.color}"></div>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function renderGMVChart() {
            const container = document.getElementById('gmv-chart');
            const months = [65, 72, 68, 80, 75, 88, 92, 85, 95, 100, 110, 105];
            container.innerHTML = '';
            
            months.forEach((height) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = height * 0.6 + '%';
                container.appendChild(bar);
            });
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Migrate historical ranking data FIRST (before anything else)
            migrateHistoricalRankingData();
            
            // Force ensure specific players (like Lombo) are in ranking
            ensureSpecificPlayers();
            
            // Force add Lombo after a short delay to ensure it's added
            setTimeout(() => {
                const ranking = getGlobalRanking();
                const hasLombo = ranking.some(p => {
                    const name = (p.name || '').toLowerCase();
                    return name.includes('lombo') && (name.includes('cria') || name.includes('44'));
                });
                
                if (!hasLombo) {
                    console.log('⚠️ Lombo not found, force adding...');
                    forceAddLombo();
                } else {
                    console.log('✅ Lombo found in ranking');
                }
            }, 500);
            
            createParticles();
            initGlobe();
            initGamePaddle();
            updateStats();
            updateGMVRealtime(); // Initial GMV display
            // Load rankings from storage first, fallback to config
            loadInitialLeaderboard();
            renderSegmentBreakdown();
            renderGMVChart();
            
            // Initial sales
            for (let i = 0; i < 5; i++) {
                setTimeout(() => addSale(), i * 400);
            }
            
            // Continuous sales
            setInterval(addSale, 2500);
            
            // Update stats periodically
            setInterval(updateStats, 5000);
            
            // Real-time GMV counter (updates every 50ms for smooth animation)
            setInterval(updateGMVRealtime, 50);
        });
    </script>
</body>
</html>
